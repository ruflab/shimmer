<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.4.0"/>
    <title>shimmer.modules.global_workspace API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style><script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']]
        }
    };
</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
    /* Re-invoke MathJax when DOM content changes, for example during search. */
    document.addEventListener("DOMContentLoaded", () => {
        new MutationObserver(() => MathJax.typeset()).observe(
            document.querySelector("main.pdoc").parentNode,
            {childList: true}
        );
    })
</script>
<style>
    mjx-container {
        overflow-x: auto;
    }
</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../../index.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;
                Module Index
            </a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#SchedulerArgs">SchedulerArgs</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#SchedulerArgs.max_lr">max_lr</a>
                        </li>
                        <li>
                                <a class="variable" href="#SchedulerArgs.total_steps">total_steps</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#GWPredictionsBase">GWPredictionsBase</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#GWPredictionsBase.states">states</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#GlobalWorkspaceBase">GlobalWorkspaceBase</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#GlobalWorkspaceBase.gw_mod">gw_mod</a>
                        </li>
                        <li>
                                <a class="variable" href="#GlobalWorkspaceBase.selection_mod">selection_mod</a>
                        </li>
                        <li>
                                <a class="variable" href="#GlobalWorkspaceBase.loss_mod">loss_mod</a>
                        </li>
                        <li>
                                <a class="variable" href="#GlobalWorkspaceBase.optim_lr">optim_lr</a>
                        </li>
                        <li>
                                <a class="variable" href="#GlobalWorkspaceBase.optim_weight_decay">optim_weight_decay</a>
                        </li>
                        <li>
                                <a class="variable" href="#GlobalWorkspaceBase.scheduler_args">scheduler_args</a>
                        </li>
                        <li>
                                <a class="variable" href="#GlobalWorkspaceBase.domain_mods">domain_mods</a>
                        </li>
                        <li>
                                <a class="variable" href="#GlobalWorkspaceBase.workspace_dim">workspace_dim</a>
                        </li>
                        <li>
                                <a class="function" href="#GlobalWorkspaceBase.encode_and_fuse">encode_and_fuse</a>
                        </li>
                        <li>
                                <a class="function" href="#GlobalWorkspaceBase.encode">encode</a>
                        </li>
                        <li>
                                <a class="function" href="#GlobalWorkspaceBase.fuse">fuse</a>
                        </li>
                        <li>
                                <a class="function" href="#GlobalWorkspaceBase.decode">decode</a>
                        </li>
                        <li>
                                <a class="function" href="#GlobalWorkspaceBase.batch_gw_states">batch_gw_states</a>
                        </li>
                        <li>
                                <a class="function" href="#GlobalWorkspaceBase.encode_domain">encode_domain</a>
                        </li>
                        <li>
                                <a class="function" href="#GlobalWorkspaceBase.encode_domains">encode_domains</a>
                        </li>
                        <li>
                                <a class="function" href="#GlobalWorkspaceBase.decode_domain">decode_domain</a>
                        </li>
                        <li>
                                <a class="function" href="#GlobalWorkspaceBase.decode_domains">decode_domains</a>
                        </li>
                        <li>
                                <a class="function" href="#GlobalWorkspaceBase.generic_step">generic_step</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#freeze_domain_modules">freeze_domain_modules</a>
            </li>
            <li>
                    <a class="class" href="#GWPredictions">GWPredictions</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#GWPredictions.demi_cycles">demi_cycles</a>
                        </li>
                        <li>
                                <a class="variable" href="#GWPredictions.cycles">cycles</a>
                        </li>
                        <li>
                                <a class="variable" href="#GWPredictions.translations">translations</a>
                        </li>
                        <li>
                                <a class="variable" href="#GWPredictions.states">states</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#GlobalWorkspace2Domains">GlobalWorkspace2Domains</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#GlobalWorkspace2Domains.__init__">GlobalWorkspace2Domains</a>
                        </li>
                        <li>
                                <a class="function" href="#GlobalWorkspace2Domains.forward">forward</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#GlobalWorkspace">GlobalWorkspace</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#GlobalWorkspace.__init__">GlobalWorkspace</a>
                        </li>
                        <li>
                                <a class="function" href="#GlobalWorkspace.forward">forward</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#GlobalWorkspaceBayesian">GlobalWorkspaceBayesian</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#GlobalWorkspaceBayesian.__init__">GlobalWorkspaceBayesian</a>
                        </li>
                        <li>
                                <a class="function" href="#GlobalWorkspaceBayesian.forward">forward</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#pretrained_global_workspace">pretrained_global_workspace</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
shimmer<wbr>.modules<wbr>.global_workspace    </h1>

                
                        <input id="mod-global_workspace-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-global_workspace-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Mapping</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Generic</span><span class="p">,</span> <span class="n">TypedDict</span><span class="p">,</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">cast</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="kn">import</span> <span class="nn">torch</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">from</span> <span class="nn">lightning.pytorch</span> <span class="kn">import</span> <span class="n">LightningModule</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="kn">from</span> <span class="nn">lightning.pytorch.utilities.types</span> <span class="kn">import</span> <span class="n">OptimizerLRSchedulerConfig</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">from</span> <span class="nn">torch.nn</span> <span class="kn">import</span> <span class="n">Module</span><span class="p">,</span> <span class="n">ModuleDict</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="kn">from</span> <span class="nn">torch.optim.lr_scheduler</span> <span class="kn">import</span> <span class="n">OneCycleLR</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="kn">from</span> <span class="nn">shimmer.modules.contrastive_loss</span> <span class="kn">import</span> <span class="n">ContrastiveLoss</span><span class="p">,</span> <span class="n">ContrastiveLossType</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="kn">from</span> <span class="nn">shimmer.modules.domain</span> <span class="kn">import</span> <span class="n">DomainModule</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="kn">from</span> <span class="nn">shimmer.modules.gw_module</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a>    <span class="n">GWModule</span><span class="p">,</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a>    <span class="n">GWModuleBase</span><span class="p">,</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a>    <span class="n">GWModuleBayesian</span><span class="p">,</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="p">)</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="kn">from</span> <span class="nn">shimmer.modules.losses</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a>    <span class="n">BroadcastLossCoefs</span><span class="p">,</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a>    <span class="n">GWLosses</span><span class="p">,</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a>    <span class="n">GWLosses2Domains</span><span class="p">,</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a>    <span class="n">GWLossesBase</span><span class="p">,</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a>    <span class="n">GWLossesBayesian</span><span class="p">,</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a>    <span class="n">LossCoefs</span><span class="p">,</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="p">)</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="kn">from</span> <span class="nn">shimmer.modules.selection</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>    <span class="n">FixedSharedSelection</span><span class="p">,</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a>    <span class="n">RandomSelection</span><span class="p">,</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>    <span class="n">SelectionBase</span><span class="p">,</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>    <span class="n">SingleDomainSelection</span><span class="p">,</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="p">)</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="kn">from</span> <span class="nn">shimmer.modules.utils</span> <span class="kn">import</span> <span class="n">batch_cycles</span><span class="p">,</span> <span class="n">batch_demi_cycles</span><span class="p">,</span> <span class="n">batch_translations</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="kn">from</span> <span class="nn">shimmer.types</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>    <span class="n">LatentsDomainGroupsDT</span><span class="p">,</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>    <span class="n">LatentsDomainGroupsT</span><span class="p">,</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>    <span class="n">ModelModeT</span><span class="p">,</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>    <span class="n">RawDomainGroupsDT</span><span class="p">,</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a>    <span class="n">RawDomainGroupsT</span><span class="p">,</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>    <span class="n">RawDomainGroupT</span><span class="p">,</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="p">)</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="kn">from</span> <span class="nn">shimmer.utils</span> <span class="kn">import</span> <span class="n">groups_batch_size</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="k">class</span> <span class="nc">SchedulerArgs</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;TypedDict of arguments passed to the OneCycle scheduler&quot;&quot;&quot;</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>    <span class="n">max_lr</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Maximum learning rate&quot;&quot;&quot;</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>    <span class="n">total_steps</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Total number of steps&quot;&quot;&quot;</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="k">class</span> <span class="nc">GWPredictionsBase</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;TypedDict of the output given when calling `GlobalWorkspaceBase.predict`&quot;&quot;&quot;</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>    <span class="n">states</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">    GW state representation from domain groups with only one domain.</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">    The key represent the domain&#39;s name.</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="n">_T_gw_mod</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_T_gw_mod&quot;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="n">GWModuleBase</span><span class="p">)</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="n">_T_selection_mod</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_T_selection_mod&quot;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="n">SelectionBase</span><span class="p">)</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a><span class="n">_T_loss_mod</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_T_loss_mod&quot;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="n">GWLossesBase</span><span class="p">)</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="k">class</span> <span class="nc">GlobalWorkspaceBase</span><span class="p">(</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>    <span class="n">Generic</span><span class="p">[</span><span class="n">_T_gw_mod</span><span class="p">,</span> <span class="n">_T_selection_mod</span><span class="p">,</span> <span class="n">_T_loss_mod</span><span class="p">],</span> <span class="n">LightningModule</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="p">):</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="sd">    Global Workspace Lightning Module.</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="sd">    This is the base class to build the Global Workspace.</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>        <span class="n">gw_mod</span><span class="p">:</span> <span class="n">_T_gw_mod</span><span class="p">,</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>        <span class="n">selection_mod</span><span class="p">:</span> <span class="n">_T_selection_mod</span><span class="p">,</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>        <span class="n">loss_mod</span><span class="p">:</span> <span class="n">_T_loss_mod</span><span class="p">,</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>        <span class="n">optim_lr</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">,</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>        <span class="n">optim_weight_decay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>        <span class="n">scheduler_args</span><span class="p">:</span> <span class="n">SchedulerArgs</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="sd">        Initializes a GW</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="sd">        Args:</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">            gw_mod (`GWModuleBase`): the GWModule</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="sd">            selection_mod (`SelectionBase`): selection module</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">            loss_mod (`GWLossesBase`): module to compute the GW losses.</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="sd">            optim_lr (`float`): learning rate</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">            optim_weight_decay (`float`): weight decay</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="sd">            scheduler_args (`SchedulerArgs`): `SchedulerArgs` instance to define</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="sd">                scheduler parameters.</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">save_hyperparameters</span><span class="p">(</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>            <span class="n">ignore</span><span class="o">=</span><span class="p">[</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>                <span class="s2">&quot;gw_mod&quot;</span><span class="p">,</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>                <span class="s2">&quot;selection_mod&quot;</span><span class="p">,</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>                <span class="s2">&quot;domain_mods&quot;</span><span class="p">,</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>                <span class="s2">&quot;loss_mod&quot;</span><span class="p">,</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>                <span class="s2">&quot;domain_descriptions&quot;</span><span class="p">,</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>                <span class="s2">&quot;contrastive_loss&quot;</span><span class="p">,</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>                <span class="s2">&quot;cont_loss_bayesian&quot;</span><span class="p">,</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>                <span class="s2">&quot;gw_encoders&quot;</span><span class="p">,</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>                <span class="s2">&quot;gw_decoders&quot;</span><span class="p">,</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>            <span class="p">]</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>        <span class="p">)</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span> <span class="o">=</span> <span class="n">gw_mod</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; a `GWModuleBase` implementation.&quot;&quot;&quot;</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">selection_mod</span> <span class="o">=</span> <span class="n">selection_mod</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;A `SelectionBase` implementation.&quot;&quot;&quot;</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">loss_mod</span> <span class="o">=</span> <span class="n">loss_mod</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The module that computes losses of the GW&quot;&quot;&quot;</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">optim_lr</span> <span class="o">=</span> <span class="n">optim_lr</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">optim_weight_decay</span> <span class="o">=</span> <span class="n">optim_weight_decay</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scheduler_args</span> <span class="o">=</span> <span class="n">SchedulerArgs</span><span class="p">(</span><span class="n">max_lr</span><span class="o">=</span><span class="n">optim_lr</span><span class="p">,</span> <span class="n">total_steps</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>        <span class="k">if</span> <span class="n">scheduler_args</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">scheduler_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">scheduler_args</span><span class="p">)</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>    <span class="nd">@property</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>    <span class="k">def</span> <span class="nf">domain_mods</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DomainModule</span><span class="p">]:</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="o">.</span><span class="n">domain_mods</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>    <span class="nd">@property</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>    <span class="k">def</span> <span class="nf">workspace_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Dimension of the GW.&quot;&quot;&quot;</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="o">.</span><span class="n">workspace_dim</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>    <span class="k">def</span> <span class="nf">encode_and_fuse</span><span class="p">(</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">LatentsDomainGroupsT</span><span class="p">,</span> <span class="n">selection_module</span><span class="p">:</span> <span class="n">SelectionBase</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a><span class="sd">        Encode a group of latent representations into the GW representation.</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a><span class="sd">        Args:</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a><span class="sd">            x (`LatentsDomainGroupsT`): the input domain representations.</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a><span class="sd">            selection_scores (`Mapping[str, torch.Tensor]`):</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a><span class="sd">        Returns:</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a><span class="sd">            `dict[frozenset[str], torch.Tensor]`: the GW representations.</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>            <span class="n">domains</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="o">.</span><span class="n">encode_and_fuse</span><span class="p">(</span><span class="n">latents</span><span class="p">,</span> <span class="n">selection_module</span><span class="p">)</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>            <span class="k">for</span> <span class="n">domains</span><span class="p">,</span> <span class="n">latents</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>        <span class="p">}</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>    <span class="k">def</span> <span class="nf">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">LatentsDomainGroupsT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LatentsDomainGroupsDT</span><span class="p">:</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a><span class="sd">        Encode a group of latent representations into the pre-fusion GW representation.</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a><span class="sd">        Args:</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a><span class="sd">            x (`LatentsDomainGroupsT`): the input domain representations.</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a><span class="sd">        Returns:</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a><span class="sd">            `LatensDomainGroupsDT`: the GW representations.</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>        <span class="k">return</span> <span class="p">{</span><span class="n">domains</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">latents</span><span class="p">)</span> <span class="k">for</span> <span class="n">domains</span><span class="p">,</span> <span class="n">latents</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>    <span class="k">def</span> <span class="nf">fuse</span><span class="p">(</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>        <span class="n">x</span><span class="p">:</span> <span class="n">LatentsDomainGroupsT</span><span class="p">,</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>        <span class="n">selection_scores</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]],</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a><span class="sd">        Fuses a group of latent representations into the GW representation.</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a><span class="sd">        Args:</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a><span class="sd">            x (`LatentsDomainGroupsT`): the pre-fusion latent representations</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a><span class="sd">            selection_scores (`Mapping[frozenset[str], Mapping[str, torch.Tensor]]`):</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a><span class="sd">                selection scores for each group</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a><span class="sd">        Returns:</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a><span class="sd">            `dict[frozenset[str], torch.Tensor]`: GW representation of each group</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>            <span class="n">domains</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="o">.</span><span class="n">fuse</span><span class="p">(</span><span class="n">latents</span><span class="p">,</span> <span class="n">selection_scores</span><span class="p">[</span><span class="n">domains</span><span class="p">])</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>            <span class="k">for</span> <span class="n">domains</span><span class="p">,</span> <span class="n">latents</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>        <span class="p">}</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>    <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>        <span class="n">z</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>        <span class="n">domains</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LatentsDomainGroupsDT</span><span class="p">:</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a><span class="sd">        Decode the group GW representation into given `domains`.</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a><span class="sd">        Args:</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a><span class="sd">            z (`torch.Tensor`): the GW representation.</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a><span class="sd">            domains (`Iterable[str]`): iterable of domains to decode.</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a><span class="sd">        Returns:</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a><span class="sd">            `dict[str, torch.Tensor]`: the decoded unimodal representations.</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>            <span class="n">domain_names</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">gw_rep</span><span class="p">,</span> <span class="n">domains</span><span class="p">)</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>            <span class="k">for</span> <span class="n">domain_names</span><span class="p">,</span> <span class="n">gw_rep</span> <span class="ow">in</span> <span class="n">z</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>        <span class="p">}</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>        <span class="n">latent_domains</span><span class="p">:</span> <span class="n">LatentsDomainGroupsT</span><span class="p">,</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GWPredictionsBase</span><span class="p">:</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a><span class="sd">        Computes demi-cycles, cycles, and translations.</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a><span class="sd">        Args:</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a><span class="sd">            latent_domains (`LatentsT`): Groups of domains for the computation.</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a><span class="sd">        Returns:</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a><span class="sd">            `GWPredictionsBase`: the predictions on the batch.</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>        <span class="k">return</span> <span class="n">GWPredictionsBase</span><span class="p">(</span><span class="n">states</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_gw_states</span><span class="p">(</span><span class="n">latent_domains</span><span class="p">))</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>    <span class="k">def</span> <span class="nf">batch_gw_states</span><span class="p">(</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">latent_domains</span><span class="p">:</span> <span class="n">LatentsDomainGroupsT</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a><span class="sd">        Comptues GW states of a batch of groups of domains.</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a><span class="sd">        Args:</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a><span class="sd">            latent_domains (`LatentsT`): the batch of groups of domains</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a><span class="sd">        Returns:</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a><span class="sd">            `dict[str, torch.Tensor]`: states for each domain.</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>        <span class="n">predictions</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>        <span class="k">for</span> <span class="n">domains</span><span class="p">,</span> <span class="n">latents</span> <span class="ow">in</span> <span class="n">latent_domains</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">domains</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>                <span class="k">continue</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>            <span class="n">domain_name</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">domains</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>            <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="o">.</span><span class="n">encode_and_fuse</span><span class="p">(</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>                <span class="n">latents</span><span class="p">,</span> <span class="n">selection_module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">selection_mod</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>            <span class="p">)</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>            <span class="n">predictions</span><span class="p">[</span><span class="n">domain_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>        <span class="k">return</span> <span class="n">predictions</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>    <span class="k">def</span> <span class="nf">encode_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a><span class="sd">        Encodes a domain from the domain data into the unimodal representation.</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a><span class="sd">        This is a convenient proxy for the `DomainModule.encode` method and is</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a><span class="sd">        equivalent to:</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a><span class="sd">        ```python</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a><span class="sd">        self.domain_mods[name].encode(domain)</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a><span class="sd">        ```</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a><span class="sd">        Args:</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a><span class="sd">            domain (`Any`): the domain data</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a><span class="sd">            name (`str`): domain name to encode</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a><span class="sd">        Returns:</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a><span class="sd">            `torch.Tensor`: the domain&#39;s unimodal representation.</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_mods</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>    <span class="k">def</span> <span class="nf">encode_domains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">RawDomainGroupsT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LatentsDomainGroupsDT</span><span class="p">:</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a><span class="sd">        Encode all domains in the batch.</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a><span class="sd">        Args:</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a><span class="sd">            batch (`RawDomainGroupsT`): the batch of</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a><span class="sd">                domain groups with raw unimodal data to encode into groups of latent</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a><span class="sd">                representations.</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a><span class="sd">        Returns:</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a><span class="sd">            `LatentsDomainGroupsDT`: the domains&#39; unimodal representations.</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>            <span class="n">domains</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>                <span class="n">name</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_mods</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">domain</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>            <span class="p">}</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>            <span class="k">for</span> <span class="n">domains</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">batch</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>        <span class="p">}</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>    <span class="k">def</span> <span class="nf">decode_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a><span class="sd">        Decodes a domain from the unimodal representation into the domain data.</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a><span class="sd">        This is a convenient proxy for the `DomainModule.encode` method and is</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a><span class="sd">        equivalent to:</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a><span class="sd">        ```python</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a><span class="sd">        self.domain_mods[name].decode(domain)</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a><span class="sd">        ```</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a><span class="sd">        Args:</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a><span class="sd">            domain (`torch.Tensor`): the domain data</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a><span class="sd">            name (`str`): domain name to encode</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a><span class="sd">        Returns:</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a><span class="sd">            `Any`: the domain&#39;s raw data.</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_mods</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>    <span class="k">def</span> <span class="nf">decode_domains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">latents_domain</span><span class="p">:</span> <span class="n">LatentsDomainGroupsT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RawDomainGroupsDT</span><span class="p">:</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a><span class="sd">        Decodes all domains in the batch.</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a><span class="sd">        Args:</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a><span class="sd">            batch (`LatentsDomainGroupsT`): the batch of</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a><span class="sd">                domain groups with unimodal latent representation to decode into</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a><span class="sd">                groups of raw data.</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a><span class="sd">        Returns:</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a><span class="sd">            `LatentsDomainGroupsDT`: the domains&#39; raw data.</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>            <span class="n">domains</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>                <span class="n">name</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_mods</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">domain</span> <span class="ow">in</span> <span class="n">latents</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>            <span class="p">}</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>            <span class="k">for</span> <span class="n">domains</span><span class="p">,</span> <span class="n">latents</span> <span class="ow">in</span> <span class="n">latents_domain</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>        <span class="p">}</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>    <span class="k">def</span> <span class="nf">generic_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">RawDomainGroupsT</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="n">ModelModeT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a><span class="sd">        The generic step used in `training_step`, `validation_step` and</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a><span class="sd">        `test_step`.</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a><span class="sd">        Args:</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a><span class="sd">            batch (`RawDomainGroupsT`): the batch of groups of raw unimodal data.</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a><span class="sd">            mode (`ModelModeT`):</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a><span class="sd">        Returns:</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a><span class="sd">            `torch.Tensor`: the loss to train on.</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>        <span class="n">domain_latents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode_domains</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>        <span class="n">batch_size</span> <span class="o">=</span> <span class="n">groups_batch_size</span><span class="p">(</span><span class="n">domain_latents</span><span class="p">)</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>        <span class="n">loss_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loss_mod</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">domain_latents</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">loss_output</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>                <span class="n">metric</span><span class="p">,</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>                <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>                <span class="n">add_dataloader_idx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>            <span class="p">)</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>        <span class="k">return</span> <span class="n">loss_output</span><span class="o">.</span><span class="n">loss</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>    <span class="k">def</span> <span class="nf">validation_step</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">RawDomainGroupT</span><span class="p">,</span> <span class="n">batch_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">dataloader_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Validation step used by lightning&quot;&quot;&quot;</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>        <span class="n">batch</span> <span class="o">=</span> <span class="p">{</span><span class="nb">frozenset</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="n">data</span><span class="p">}</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>        <span class="k">for</span> <span class="n">domain</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>            <span class="n">batch</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">([</span><span class="n">domain</span><span class="p">])]</span> <span class="o">=</span> <span class="p">{</span><span class="n">domain</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="n">domain</span><span class="p">]}</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>        <span class="k">if</span> <span class="n">dataloader_idx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_step</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;val&quot;</span><span class="p">)</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_step</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;val/ood&quot;</span><span class="p">)</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>    <span class="k">def</span> <span class="nf">test_step</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">batch_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">dataloader_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Test step used by lightning&quot;&quot;&quot;</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>        <span class="n">batch</span> <span class="o">=</span> <span class="p">{</span><span class="nb">frozenset</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="n">data</span><span class="p">}</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>        <span class="k">for</span> <span class="n">domain</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>            <span class="n">batch</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">([</span><span class="n">domain</span><span class="p">])]</span> <span class="o">=</span> <span class="p">{</span><span class="n">domain</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="n">domain</span><span class="p">]}</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>        <span class="k">if</span> <span class="n">dataloader_idx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_step</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_step</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;test/ood&quot;</span><span class="p">)</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>    <span class="k">def</span> <span class="nf">training_step</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">batch_idx</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Training step used by lightning&quot;&quot;&quot;</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_step</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">)</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>    <span class="k">def</span> <span class="nf">predict_step</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">batch_idx</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GWPredictionsBase</span><span class="p">:</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Predict step used by lightning&quot;&quot;&quot;</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>        <span class="n">batch</span> <span class="o">=</span> <span class="p">{</span><span class="nb">frozenset</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="n">data</span><span class="p">}</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>        <span class="k">for</span> <span class="n">domain</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>            <span class="n">batch</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">([</span><span class="n">domain</span><span class="p">])]</span> <span class="o">=</span> <span class="p">{</span><span class="n">domain</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="n">domain</span><span class="p">]}</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>        <span class="n">domain_latents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode_domains</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">domain_latents</span><span class="p">)</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>    <span class="k">def</span> <span class="nf">configure_optimizers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OptimizerLRSchedulerConfig</span><span class="p">:</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a><span class="sd">        Configure models optimizers.</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a><span class="sd">        Here we use `AdamW` for the optimizer and `OneCycleLR` for the learning-rate</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a><span class="sd">        scheduler.</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">AdamW</span><span class="p">(</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>            <span class="n">lr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">optim_lr</span><span class="p">,</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>            <span class="n">weight_decay</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">optim_weight_decay</span><span class="p">,</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>        <span class="p">)</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>        <span class="n">lr_scheduler</span> <span class="o">=</span> <span class="n">OneCycleLR</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">scheduler_args</span><span class="p">)</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>            <span class="s2">&quot;optimizer&quot;</span><span class="p">:</span> <span class="n">optimizer</span><span class="p">,</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>            <span class="s2">&quot;lr_scheduler&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>                <span class="s2">&quot;scheduler&quot;</span><span class="p">:</span> <span class="n">lr_scheduler</span><span class="p">,</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>                <span class="s2">&quot;interval&quot;</span><span class="p">:</span> <span class="s2">&quot;step&quot;</span><span class="p">,</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>            <span class="p">},</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>        <span class="p">}</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a><span class="k">def</span> <span class="nf">freeze_domain_modules</span><span class="p">(</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>    <span class="n">domain_mods</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DomainModule</span><span class="p">],</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DomainModule</span><span class="p">]:</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a><span class="sd">    Freezes weights and set to eval mode the domain modules.</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a><span class="sd">    .. note::</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a><span class="sd">        The output is casted as `dict[str, DomainModule]` type for better</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a><span class="sd">        auto-completion, but is actually a torch `ModuleDict`.</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a><span class="sd">    Args:</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a><span class="sd">        domain_mods (`Mapping[str, DomainModule]`): mapping of domain modules to freeze</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a><span class="sd">    Returns:</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a><span class="sd">        `ModuleDict`: frozen modules.</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>    <span class="k">for</span> <span class="n">mod</span> <span class="ow">in</span> <span class="n">domain_mods</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>        <span class="n">mod</span><span class="o">.</span><span class="n">freeze</span><span class="p">()</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>    <span class="c1"># Cast for better auto-completion at the expense of ModuleDict</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>    <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DomainModule</span><span class="p">],</span> <span class="n">ModuleDict</span><span class="p">(</span><span class="n">domain_mods</span><span class="p">))</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a><span class="k">class</span> <span class="nc">GWPredictions</span><span class="p">(</span><span class="n">GWPredictionsBase</span><span class="p">):</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;TypedDict of the output given when calling `GlobalWorkspaceBase.predict`&quot;&quot;&quot;</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>    <span class="n">demi_cycles</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a><span class="sd">    Demi-cycle predictions of the model for each domain. Only computed on domain</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a><span class="sd">    groups with only one domain.</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>    <span class="n">cycles</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a><span class="sd">    Cycle predictions of the model from one domain through another one.</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a><span class="sd">    Only computed on domain groups with more than one domain.</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a><span class="sd">    The keys are tuple with start domain and intermediary domain.</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>    <span class="n">translations</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a><span class="sd">    Translation predictions of the model from one domain through another one.</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a><span class="sd">    Only computed on domain groups with more than one domain.</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a><span class="sd">    The keys are tuples with start domain and target domain.</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a><span class="k">class</span> <span class="nc">GlobalWorkspace2Domains</span><span class="p">(</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>    <span class="n">GlobalWorkspaceBase</span><span class="p">[</span><span class="n">GWModule</span><span class="p">,</span> <span class="n">SingleDomainSelection</span><span class="p">,</span> <span class="n">GWLosses2Domains</span><span class="p">]</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a><span class="p">):</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a><span class="sd">    A simple 2-domains max flavor of GlobalWorkspaceBase.</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a><span class="sd">    This is used to simplify a Global Workspace instanciation and only overrides the</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a><span class="sd">    `__init__` method.</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a>        <span class="n">domain_mods</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DomainModule</span><span class="p">],</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>        <span class="n">gw_encoders</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Module</span><span class="p">],</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>        <span class="n">gw_decoders</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Module</span><span class="p">],</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>        <span class="n">workspace_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a>        <span class="n">loss_coefs</span><span class="p">:</span> <span class="n">LossCoefs</span><span class="p">,</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>        <span class="n">optim_lr</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">,</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>        <span class="n">optim_weight_decay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>        <span class="n">scheduler_args</span><span class="p">:</span> <span class="n">SchedulerArgs</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>        <span class="n">learn_logit_scale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>        <span class="n">contrastive_loss</span><span class="p">:</span> <span class="n">ContrastiveLossType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a><span class="sd">        Initializes a Global Workspace</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a><span class="sd">        Args:</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a><span class="sd">            domain_mods (`Mapping[str, DomainModule]`): mapping of the domains</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a><span class="sd">                connected to the GW. Keys are domain names, values are the</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a><span class="sd">                `DomainModule`.</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a><span class="sd">            gw_encoders (`Mapping[str, torch.nn.Module]`): mapping for each domain</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a><span class="sd">                name to a `torch.nn.Module` class which role is to encode a</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a><span class="sd">                unimodal latent representations into a GW representation (pre fusion).</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a><span class="sd">            gw_decoders (`Mapping[str, torch.nn.Module]`): mapping for each domain</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a><span class="sd">                name to a `torch.nn.Module` class which role is to decode a</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a><span class="sd">                GW representation into a unimodal latent representations.</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a><span class="sd">            workspace_dim (`int`): dimension of the GW.</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a><span class="sd">            loss_coefs (`LossCoefs`): loss coefficients</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a><span class="sd">            optim_lr (`float`): learning rate</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a><span class="sd">            optim_weight_decay (`float`): weight decay</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a><span class="sd">            scheduler_args (`SchedulerArgs | None`): optimization scheduler&#39;s arguments</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a><span class="sd">            learn_logit_scale (`bool`): whether to learn the contrastive learning</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a><span class="sd">                contrastive loss when using the default contrastive loss.</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a><span class="sd">            contrastive_loss (`ContrastiveLossType | None`): a contrastive loss</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a><span class="sd">                function used for alignment. `learn_logit_scale` will not affect custom</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a><span class="sd">                contrastive losses.</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a>        <span class="n">domain_mods</span> <span class="o">=</span> <span class="n">freeze_domain_modules</span><span class="p">(</span><span class="n">domain_mods</span><span class="p">)</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>        <span class="n">gw_mod</span> <span class="o">=</span> <span class="n">GWModule</span><span class="p">(</span><span class="n">domain_mods</span><span class="p">,</span> <span class="n">workspace_dim</span><span class="p">,</span> <span class="n">gw_encoders</span><span class="p">,</span> <span class="n">gw_decoders</span><span class="p">)</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a>        <span class="k">if</span> <span class="n">contrastive_loss</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a>            <span class="n">contrastive_loss</span> <span class="o">=</span> <span class="n">ContrastiveLoss</span><span class="p">(</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a>                <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">1</span> <span class="o">/</span> <span class="mf">0.07</span><span class="p">])</span><span class="o">.</span><span class="n">log</span><span class="p">(),</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="n">learn_logit_scale</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a>            <span class="p">)</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a>        <span class="n">selection_mod</span> <span class="o">=</span> <span class="n">SingleDomainSelection</span><span class="p">()</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a>        <span class="n">loss_mod</span> <span class="o">=</span> <span class="n">GWLosses2Domains</span><span class="p">(</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a>            <span class="n">gw_mod</span><span class="p">,</span> <span class="n">selection_mod</span><span class="p">,</span> <span class="n">domain_mods</span><span class="p">,</span> <span class="n">loss_coefs</span><span class="p">,</span> <span class="n">contrastive_loss</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a>        <span class="p">)</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>            <span class="n">gw_mod</span><span class="p">,</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>            <span class="n">selection_mod</span><span class="p">,</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a>            <span class="n">loss_mod</span><span class="p">,</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a>            <span class="n">optim_lr</span><span class="p">,</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>            <span class="n">optim_weight_decay</span><span class="p">,</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a>            <span class="n">scheduler_args</span><span class="p">,</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a>        <span class="p">)</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a>        <span class="n">latent_domains</span><span class="p">:</span> <span class="n">LatentsDomainGroupsT</span><span class="p">,</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GWPredictions</span><span class="p">:</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a><span class="sd">        Computes demi-cycles, cycles, and translations.</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a><span class="sd">        Args:</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a><span class="sd">            latent_domains (`LatentsT`): Groups of domains for the computation.</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a><span class="sd">        Returns:</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a><span class="sd">            `GWPredictions`: the predictions on the batch.</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a>        <span class="k">return</span> <span class="n">GWPredictions</span><span class="p">(</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a>            <span class="n">demi_cycles</span><span class="o">=</span><span class="n">batch_demi_cycles</span><span class="p">(</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_mod</span><span class="p">,</span> <span class="n">latent_domains</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a>            <span class="p">),</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a>            <span class="n">cycles</span><span class="o">=</span><span class="n">batch_cycles</span><span class="p">(</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_mod</span><span class="p">,</span> <span class="n">latent_domains</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_mods</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a>            <span class="p">),</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a>            <span class="n">translations</span><span class="o">=</span><span class="n">batch_translations</span><span class="p">(</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_mod</span><span class="p">,</span> <span class="n">latent_domains</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a>            <span class="p">),</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a>            <span class="o">**</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">latent_domains</span><span class="p">),</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>        <span class="p">)</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a><span class="k">class</span> <span class="nc">GlobalWorkspace</span><span class="p">(</span><span class="n">GlobalWorkspaceBase</span><span class="p">[</span><span class="n">GWModule</span><span class="p">,</span> <span class="n">RandomSelection</span><span class="p">,</span> <span class="n">GWLosses</span><span class="p">]):</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The 2-domain fusion (with broadcast loss) flavor of GlobalWorkspaceBase.</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a><span class="sd">    This is used to simplify a Global Workspace instanciation and only overrides the</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a><span class="sd">    `__init__` method.</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a>        <span class="n">domain_mods</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DomainModule</span><span class="p">],</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a>        <span class="n">gw_encoders</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Module</span><span class="p">],</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a>        <span class="n">gw_decoders</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Module</span><span class="p">],</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a>        <span class="n">workspace_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a>        <span class="n">loss_coefs</span><span class="p">:</span> <span class="n">BroadcastLossCoefs</span><span class="p">,</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a>        <span class="n">selection_temperature</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a>        <span class="n">optim_lr</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">,</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a>        <span class="n">optim_weight_decay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a>        <span class="n">scheduler_args</span><span class="p">:</span> <span class="n">SchedulerArgs</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a>        <span class="n">learn_logit_scale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a>        <span class="n">contrastive_loss</span><span class="p">:</span> <span class="n">ContrastiveLossType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a><span class="sd">        Initializes a Global Workspace</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a><span class="sd">        Args:</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a><span class="sd">            domain_mods (`Mapping[str, DomainModule]`): mapping of the domains</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a><span class="sd">                connected to the GW. Keys are domain names, values are the</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a><span class="sd">                `DomainModule`.</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos">592</span></a><span class="sd">            gw_encoders (`Mapping[str, torch.nn.Module]`): mapping for each domain</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos">593</span></a><span class="sd">                name to a `torch.nn.Module` class which role is to encode a</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos">594</span></a><span class="sd">                unimodal latent representations into a GW representation (pre fusion).</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos">595</span></a><span class="sd">            gw_decoders (`Mapping[str, torch.nn.Module]`): mapping for each domain</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos">596</span></a><span class="sd">                name to a `torch.nn.Module` class which role is to decode a</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos">597</span></a><span class="sd">                GW representation into a unimodal latent representations.</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos">598</span></a><span class="sd">            workspace_dim (`int`): dimension of the GW.</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos">599</span></a><span class="sd">            loss_coefs (`BroadcastLossCoefs`): loss coefs for the losses.</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos">600</span></a><span class="sd">            selection_temperature (`float`): temperature value for the RandomSelection</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos">601</span></a><span class="sd">                module.</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos">602</span></a><span class="sd">            optim_lr (`float`): learning rate</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos">603</span></a><span class="sd">            optim_weight_decay (`float`): weight decay</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos">604</span></a><span class="sd">            scheduler_args (`SchedulerArgs | None`): optimization scheduler&#39;s arguments</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos">605</span></a><span class="sd">            learn_logit_scale (`bool`): whether to learn the contrastive learning</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos">606</span></a><span class="sd">                contrastive loss when using the default contrastive loss.</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos">607</span></a><span class="sd">            contrastive_loss (`ContrastiveLossType | None`): a contrastive loss</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos">608</span></a><span class="sd">                function used for alignment. `learn_logit_scale` will not affect custom</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos">609</span></a><span class="sd">                contrastive losses.</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos">610</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos">611</span></a>        <span class="n">domain_mods</span> <span class="o">=</span> <span class="n">freeze_domain_modules</span><span class="p">(</span><span class="n">domain_mods</span><span class="p">)</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos">612</span></a>        <span class="n">gw_mod</span> <span class="o">=</span> <span class="n">GWModule</span><span class="p">(</span><span class="n">domain_mods</span><span class="p">,</span> <span class="n">workspace_dim</span><span class="p">,</span> <span class="n">gw_encoders</span><span class="p">,</span> <span class="n">gw_decoders</span><span class="p">)</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos">613</span></a>
</span><span id="L-614"><a href="#L-614"><span class="linenos">614</span></a>        <span class="k">if</span> <span class="n">contrastive_loss</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos">615</span></a>            <span class="n">contrastive_loss</span> <span class="o">=</span> <span class="n">ContrastiveLoss</span><span class="p">(</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos">616</span></a>                <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">1</span> <span class="o">/</span> <span class="mf">0.07</span><span class="p">])</span><span class="o">.</span><span class="n">log</span><span class="p">(),</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="n">learn_logit_scale</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos">617</span></a>            <span class="p">)</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos">618</span></a>
</span><span id="L-619"><a href="#L-619"><span class="linenos">619</span></a>        <span class="n">selection_mod</span> <span class="o">=</span> <span class="n">RandomSelection</span><span class="p">(</span><span class="n">selection_temperature</span><span class="p">)</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos">620</span></a>        <span class="n">loss_mod</span> <span class="o">=</span> <span class="n">GWLosses</span><span class="p">(</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos">621</span></a>            <span class="n">gw_mod</span><span class="p">,</span> <span class="n">selection_mod</span><span class="p">,</span> <span class="n">domain_mods</span><span class="p">,</span> <span class="n">loss_coefs</span><span class="p">,</span> <span class="n">contrastive_loss</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos">622</span></a>        <span class="p">)</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos">623</span></a>
</span><span id="L-624"><a href="#L-624"><span class="linenos">624</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos">625</span></a>            <span class="n">gw_mod</span><span class="p">,</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos">626</span></a>            <span class="n">selection_mod</span><span class="p">,</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos">627</span></a>            <span class="n">loss_mod</span><span class="p">,</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos">628</span></a>            <span class="n">optim_lr</span><span class="p">,</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos">629</span></a>            <span class="n">optim_weight_decay</span><span class="p">,</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos">630</span></a>            <span class="n">scheduler_args</span><span class="p">,</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos">631</span></a>        <span class="p">)</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos">632</span></a>
</span><span id="L-633"><a href="#L-633"><span class="linenos">633</span></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos">634</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos">635</span></a>        <span class="n">latent_domains</span><span class="p">:</span> <span class="n">LatentsDomainGroupsT</span><span class="p">,</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos">636</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GWPredictions</span><span class="p">:</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos">637</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos">638</span></a><span class="sd">        Computes demi-cycles, cycles, and translations.</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos">639</span></a>
</span><span id="L-640"><a href="#L-640"><span class="linenos">640</span></a><span class="sd">        Args:</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos">641</span></a><span class="sd">            latent_domains (`LatentsT`): Groups of domains for the computation.</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos">642</span></a>
</span><span id="L-643"><a href="#L-643"><span class="linenos">643</span></a><span class="sd">        Returns:</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos">644</span></a><span class="sd">            `GWPredictions`: the predictions on the batch.</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos">645</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos">646</span></a>        <span class="k">return</span> <span class="n">GWPredictions</span><span class="p">(</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos">647</span></a>            <span class="n">demi_cycles</span><span class="o">=</span><span class="n">batch_demi_cycles</span><span class="p">(</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos">648</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_mod</span><span class="p">,</span> <span class="n">latent_domains</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos">649</span></a>            <span class="p">),</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos">650</span></a>            <span class="n">cycles</span><span class="o">=</span><span class="n">batch_cycles</span><span class="p">(</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos">651</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_mod</span><span class="p">,</span> <span class="n">latent_domains</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_mods</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos">652</span></a>            <span class="p">),</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos">653</span></a>            <span class="n">translations</span><span class="o">=</span><span class="n">batch_translations</span><span class="p">(</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos">654</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_mod</span><span class="p">,</span> <span class="n">latent_domains</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos">655</span></a>            <span class="p">),</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos">656</span></a>            <span class="c1"># TODO: add other combinations</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos">657</span></a>            <span class="o">**</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">latent_domains</span><span class="p">),</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos">658</span></a>        <span class="p">)</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos">659</span></a>
</span><span id="L-660"><a href="#L-660"><span class="linenos">660</span></a>
</span><span id="L-661"><a href="#L-661"><span class="linenos">661</span></a><span class="k">class</span> <span class="nc">GlobalWorkspaceBayesian</span><span class="p">(</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos">662</span></a>    <span class="n">GlobalWorkspaceBase</span><span class="p">[</span><span class="n">GWModuleBayesian</span><span class="p">,</span> <span class="n">FixedSharedSelection</span><span class="p">,</span> <span class="n">GWLossesBayesian</span><span class="p">]</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos">663</span></a><span class="p">):</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos">664</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos">665</span></a><span class="sd">    A simple 2-domains max GlobalWorkspaceBase with a Bayesian base uncertainty</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos">666</span></a><span class="sd">    prediction.</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos">667</span></a>
</span><span id="L-668"><a href="#L-668"><span class="linenos">668</span></a><span class="sd">    This is used to simplify a Global Workspace instanciation and only overrides the</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos">669</span></a><span class="sd">    `__init__` method.</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos">670</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos">671</span></a>
</span><span id="L-672"><a href="#L-672"><span class="linenos">672</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos">673</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos">674</span></a>        <span class="n">domain_mods</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DomainModule</span><span class="p">],</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos">675</span></a>        <span class="n">gw_encoders</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Module</span><span class="p">],</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos">676</span></a>        <span class="n">gw_decoders</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Module</span><span class="p">],</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos">677</span></a>        <span class="n">workspace_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos">678</span></a>        <span class="n">loss_coefs</span><span class="p">:</span> <span class="n">BroadcastLossCoefs</span><span class="p">,</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos">679</span></a>        <span class="n">sensitivity_selection</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos">680</span></a>        <span class="n">sensitivity_precision</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos">681</span></a>        <span class="n">optim_lr</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">,</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos">682</span></a>        <span class="n">optim_weight_decay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos">683</span></a>        <span class="n">scheduler_args</span><span class="p">:</span> <span class="n">SchedulerArgs</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos">684</span></a>        <span class="n">learn_logit_scale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos">685</span></a>        <span class="n">use_normalized_constrastive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos">686</span></a>        <span class="n">contrastive_loss</span><span class="p">:</span> <span class="n">ContrastiveLossType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos">687</span></a>        <span class="n">precision_softmax_temp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos">688</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos">689</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos">690</span></a><span class="sd">        Initializes a Global Workspace</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos">691</span></a>
</span><span id="L-692"><a href="#L-692"><span class="linenos">692</span></a><span class="sd">        Args:</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos">693</span></a><span class="sd">            domain_mods (`Mapping[str, DomainModule]`): mapping of the domains</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos">694</span></a><span class="sd">                connected to the GW. Keys are domain names, values are the</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos">695</span></a><span class="sd">                `DomainModule`.</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos">696</span></a><span class="sd">            gw_encoders (`Mapping[str, torch.nn.Module]`): mapping for each domain</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos">697</span></a><span class="sd">                name to a `torch.nn.Module` class which role is to encode a</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos">698</span></a><span class="sd">                unimodal latent representations into a GW representation (pre fusion).</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos">699</span></a><span class="sd">            gw_decoders (`Mapping[str, torch.nn.Module]`): mapping for each domain</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos">700</span></a><span class="sd">                name to a `torch.nn.Module` class which role is to decode a</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos">701</span></a><span class="sd">                GW representation into a unimodal latent representations.</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos">702</span></a><span class="sd">            workspace_dim (`int`): dimension of the GW.</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos">703</span></a><span class="sd">            loss_coefs (`LossCoefs`): loss coefficients</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos">704</span></a><span class="sd">            sensitivity_selection (`float`): sensivity coef $c&#39;_1$</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos">705</span></a><span class="sd">            sensitivity_precision (`float`): sensitivity coef $c&#39;_2$</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos">706</span></a><span class="sd">            optim_lr (`float`): learning rate</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos">707</span></a><span class="sd">            optim_weight_decay (`float`): weight decay</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos">708</span></a><span class="sd">            scheduler_args (`SchedulerArgs | None`): optimization scheduler&#39;s arguments</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos">709</span></a><span class="sd">            learn_logit_scale (`bool`): whether to learn the contrastive learning</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos">710</span></a><span class="sd">                contrastive loss when using the default contrastive loss.</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos">711</span></a><span class="sd">            use_normalized_constrastive (`bool`): whether to use the normalized cont</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos">712</span></a><span class="sd">                loss by the precision coefs</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos">713</span></a><span class="sd">            contrastive_loss (`ContrastiveLossType | None`): a contrastive loss</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos">714</span></a><span class="sd">                function used for alignment. `learn_logit_scale` will not affect custom</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos">715</span></a><span class="sd">                contrastive losses.</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos">716</span></a><span class="sd">            precision_softmax_temp (`float`): temperature to use in softmax of</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos">717</span></a><span class="sd">                precision</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos">718</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos">719</span></a>        <span class="n">domain_mods</span> <span class="o">=</span> <span class="n">freeze_domain_modules</span><span class="p">(</span><span class="n">domain_mods</span><span class="p">)</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos">720</span></a>
</span><span id="L-721"><a href="#L-721"><span class="linenos">721</span></a>        <span class="n">gw_mod</span> <span class="o">=</span> <span class="n">GWModuleBayesian</span><span class="p">(</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos">722</span></a>            <span class="n">domain_mods</span><span class="p">,</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos">723</span></a>            <span class="n">workspace_dim</span><span class="p">,</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos">724</span></a>            <span class="n">gw_encoders</span><span class="p">,</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos">725</span></a>            <span class="n">gw_decoders</span><span class="p">,</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos">726</span></a>            <span class="n">sensitivity_selection</span><span class="p">,</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos">727</span></a>            <span class="n">sensitivity_precision</span><span class="p">,</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos">728</span></a>            <span class="n">precision_softmax_temp</span><span class="p">,</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos">729</span></a>        <span class="p">)</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos">730</span></a>
</span><span id="L-731"><a href="#L-731"><span class="linenos">731</span></a>        <span class="n">selection_mod</span> <span class="o">=</span> <span class="n">FixedSharedSelection</span><span class="p">()</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos">732</span></a>
</span><span id="L-733"><a href="#L-733"><span class="linenos">733</span></a>        <span class="n">contrastive_loss</span> <span class="o">=</span> <span class="n">ContrastiveLoss</span><span class="p">(</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos">734</span></a>            <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">log</span><span class="p">(),</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="n">learn_logit_scale</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos">735</span></a>        <span class="p">)</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos">736</span></a>
</span><span id="L-737"><a href="#L-737"><span class="linenos">737</span></a>        <span class="n">loss_mod</span> <span class="o">=</span> <span class="n">GWLossesBayesian</span><span class="p">(</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos">738</span></a>            <span class="n">gw_mod</span><span class="p">,</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos">739</span></a>            <span class="n">selection_mod</span><span class="p">,</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos">740</span></a>            <span class="n">domain_mods</span><span class="p">,</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos">741</span></a>            <span class="n">loss_coefs</span><span class="p">,</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos">742</span></a>            <span class="n">contrastive_loss</span><span class="p">,</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos">743</span></a>            <span class="n">use_normalized_constrastive</span><span class="p">,</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos">744</span></a>        <span class="p">)</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos">745</span></a>
</span><span id="L-746"><a href="#L-746"><span class="linenos">746</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos">747</span></a>            <span class="n">gw_mod</span><span class="p">,</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos">748</span></a>            <span class="n">selection_mod</span><span class="p">,</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos">749</span></a>            <span class="n">loss_mod</span><span class="p">,</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos">750</span></a>            <span class="n">optim_lr</span><span class="p">,</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos">751</span></a>            <span class="n">optim_weight_decay</span><span class="p">,</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos">752</span></a>            <span class="n">scheduler_args</span><span class="p">,</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos">753</span></a>        <span class="p">)</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos">754</span></a>
</span><span id="L-755"><a href="#L-755"><span class="linenos">755</span></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos">756</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos">757</span></a>        <span class="n">latent_domains</span><span class="p">:</span> <span class="n">LatentsDomainGroupsT</span><span class="p">,</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos">758</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GWPredictions</span><span class="p">:</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos">759</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos">760</span></a><span class="sd">        Computes demi-cycles, cycles, and translations.</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos">761</span></a>
</span><span id="L-762"><a href="#L-762"><span class="linenos">762</span></a><span class="sd">        Args:</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos">763</span></a><span class="sd">            latent_domains (`LatentsT`): Groups of domains for the computation.</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos">764</span></a>
</span><span id="L-765"><a href="#L-765"><span class="linenos">765</span></a><span class="sd">        Returns:</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos">766</span></a><span class="sd">            `GWPredictions`: the predictions on the batch.</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos">767</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos">768</span></a>        <span class="k">return</span> <span class="n">GWPredictions</span><span class="p">(</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos">769</span></a>            <span class="n">demi_cycles</span><span class="o">=</span><span class="n">batch_demi_cycles</span><span class="p">(</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos">770</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_mod</span><span class="p">,</span> <span class="n">latent_domains</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos">771</span></a>            <span class="p">),</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos">772</span></a>            <span class="n">cycles</span><span class="o">=</span><span class="n">batch_cycles</span><span class="p">(</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos">773</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_mod</span><span class="p">,</span> <span class="n">latent_domains</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_mods</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos">774</span></a>            <span class="p">),</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos">775</span></a>            <span class="n">translations</span><span class="o">=</span><span class="n">batch_translations</span><span class="p">(</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos">776</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_mod</span><span class="p">,</span> <span class="n">latent_domains</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos">777</span></a>            <span class="p">),</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos">778</span></a>            <span class="o">**</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">latent_domains</span><span class="p">),</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos">779</span></a>        <span class="p">)</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos">780</span></a>
</span><span id="L-781"><a href="#L-781"><span class="linenos">781</span></a>
</span><span id="L-782"><a href="#L-782"><span class="linenos">782</span></a><span class="k">def</span> <span class="nf">pretrained_global_workspace</span><span class="p">(</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos">783</span></a>    <span class="n">checkpoint_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos">784</span></a>    <span class="n">domain_mods</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DomainModule</span><span class="p">],</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos">785</span></a>    <span class="n">gw_encoders</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Module</span><span class="p">],</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos">786</span></a>    <span class="n">gw_decoders</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Module</span><span class="p">],</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos">787</span></a>    <span class="n">workspace_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos">788</span></a>    <span class="n">loss_coefs</span><span class="p">:</span> <span class="n">LossCoefs</span><span class="p">,</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos">789</span></a>    <span class="n">contrastive_fn</span><span class="p">:</span> <span class="n">ContrastiveLossType</span><span class="p">,</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos">790</span></a>    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos">791</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GlobalWorkspace2Domains</span><span class="p">:</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos">792</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos">793</span></a><span class="sd">    Load a `GlobalWorkspace` flavor of `GlobalWorkspaceBase` from a checkpoint.</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos">794</span></a>
</span><span id="L-795"><a href="#L-795"><span class="linenos">795</span></a><span class="sd">    Args:</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos">796</span></a><span class="sd">        checkpoint_path (`str | Path`): path to checkpoint</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos">797</span></a><span class="sd">        domain_mods (`Mapping[str, DomainModule]`): mapping of the domains</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos">798</span></a><span class="sd">            connected to the GW. Keys are domain names, values are the</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos">799</span></a><span class="sd">            `DomainModule`.</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos">800</span></a><span class="sd">        gw_encoders (`Mapping[str, torch.nn.Module]`): mapping for each domain</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos">801</span></a><span class="sd">            name to a `torch.nn.Module` class which role is to encode a</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos">802</span></a><span class="sd">            unimodal latent representations into a GW representation (pre fusion).</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos">803</span></a><span class="sd">        gw_decoders (`Mapping[str, torch.nn.Module]`): mapping for each domain</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos">804</span></a><span class="sd">            name to a `torch.nn.Module` class which role is to decode a</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos">805</span></a><span class="sd">            GW representation into a unimodal latent representations.</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos">806</span></a><span class="sd">        workspace_dim (`int`): dimension of the GW.</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos">807</span></a><span class="sd">        loss_coefs (`LossCoefs`): loss coefficients</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos">808</span></a><span class="sd">        contrastive_loss (`ContrastiveLossType`): a contrastive loss</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos">809</span></a><span class="sd">            function used for alignment. `learn_logit_scale` will not affect custom</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos">810</span></a><span class="sd">            contrastive losses.</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos">811</span></a><span class="sd">        **kwargs: additional arguments to pass to</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos">812</span></a><span class="sd">            `GlobalWorkspace.load_from_checkpoint`.</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos">813</span></a>
</span><span id="L-814"><a href="#L-814"><span class="linenos">814</span></a><span class="sd">    Returns:</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos">815</span></a><span class="sd">        `GlobalWorkspace`: the pretrained `GlobalWorkspace`.</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos">816</span></a>
</span><span id="L-817"><a href="#L-817"><span class="linenos">817</span></a><span class="sd">    Raises:</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos">818</span></a><span class="sd">        `TypeError`: if loaded type is not `GlobalWorkspace`.</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos">819</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos">820</span></a>    <span class="n">domain_mods</span> <span class="o">=</span> <span class="n">freeze_domain_modules</span><span class="p">(</span><span class="n">domain_mods</span><span class="p">)</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos">821</span></a>    <span class="n">gw_mod</span> <span class="o">=</span> <span class="n">GWModule</span><span class="p">(</span><span class="n">domain_mods</span><span class="p">,</span> <span class="n">workspace_dim</span><span class="p">,</span> <span class="n">gw_encoders</span><span class="p">,</span> <span class="n">gw_decoders</span><span class="p">)</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos">822</span></a>    <span class="n">selection_mod</span> <span class="o">=</span> <span class="n">SingleDomainSelection</span><span class="p">()</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos">823</span></a>    <span class="n">loss_mod</span> <span class="o">=</span> <span class="n">GWLosses2Domains</span><span class="p">(</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos">824</span></a>        <span class="n">gw_mod</span><span class="p">,</span> <span class="n">selection_mod</span><span class="p">,</span> <span class="n">domain_mods</span><span class="p">,</span> <span class="n">loss_coefs</span><span class="p">,</span> <span class="n">contrastive_fn</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos">825</span></a>    <span class="p">)</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos">826</span></a>
</span><span id="L-827"><a href="#L-827"><span class="linenos">827</span></a>    <span class="n">gw</span> <span class="o">=</span> <span class="n">GlobalWorkspace2Domains</span><span class="o">.</span><span class="n">load_from_checkpoint</span><span class="p">(</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos">828</span></a>        <span class="n">checkpoint_path</span><span class="p">,</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos">829</span></a>        <span class="n">gw_mod</span><span class="o">=</span><span class="n">gw_mod</span><span class="p">,</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos">830</span></a>        <span class="n">selection_mid</span><span class="o">=</span><span class="n">selection_mod</span><span class="p">,</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos">831</span></a>        <span class="n">loss_coefs</span><span class="o">=</span><span class="n">loss_coefs</span><span class="p">,</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos">832</span></a>        <span class="n">loss_mod</span><span class="o">=</span><span class="n">loss_mod</span><span class="p">,</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos">833</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos">834</span></a>    <span class="p">)</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos">835</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gw</span><span class="p">,</span> <span class="n">GlobalWorkspace2Domains</span><span class="p">):</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos">836</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;model should be of type GlobalWorkspace&quot;</span><span class="p">)</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos">837</span></a>    <span class="k">return</span> <span class="n">gw</span>
</span></pre></div>


            </section>
                <section id="SchedulerArgs">
                            <input id="SchedulerArgs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SchedulerArgs</span><wbr>(<span class="base">typing.TypedDict</span>):

                <label class="view-source-button" for="SchedulerArgs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SchedulerArgs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SchedulerArgs-45"><a href="#SchedulerArgs-45"><span class="linenos">45</span></a><span class="k">class</span> <span class="nc">SchedulerArgs</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="SchedulerArgs-46"><a href="#SchedulerArgs-46"><span class="linenos">46</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;TypedDict of arguments passed to the OneCycle scheduler&quot;&quot;&quot;</span>
</span><span id="SchedulerArgs-47"><a href="#SchedulerArgs-47"><span class="linenos">47</span></a>
</span><span id="SchedulerArgs-48"><a href="#SchedulerArgs-48"><span class="linenos">48</span></a>    <span class="n">max_lr</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="SchedulerArgs-49"><a href="#SchedulerArgs-49"><span class="linenos">49</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Maximum learning rate&quot;&quot;&quot;</span>
</span><span id="SchedulerArgs-50"><a href="#SchedulerArgs-50"><span class="linenos">50</span></a>
</span><span id="SchedulerArgs-51"><a href="#SchedulerArgs-51"><span class="linenos">51</span></a>    <span class="n">total_steps</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="SchedulerArgs-52"><a href="#SchedulerArgs-52"><span class="linenos">52</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Total number of steps&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>TypedDict of arguments passed to the OneCycle scheduler</p>
</div>


                            <div id="SchedulerArgs.max_lr" class="classattr">
                                <div class="attr variable">
            <span class="name">max_lr</span><span class="annotation">: float</span>

        
    </div>
    <a class="headerlink" href="#SchedulerArgs.max_lr"></a>
    
            <div class="docstring"><p>Maximum learning rate</p>
</div>


                            </div>
                            <div id="SchedulerArgs.total_steps" class="classattr">
                                <div class="attr variable">
            <span class="name">total_steps</span><span class="annotation">: int</span>

        
    </div>
    <a class="headerlink" href="#SchedulerArgs.total_steps"></a>
    
            <div class="docstring"><p>Total number of steps</p>
</div>


                            </div>
                </section>
                <section id="GWPredictionsBase">
                            <input id="GWPredictionsBase-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">GWPredictionsBase</span><wbr>(<span class="base">typing.TypedDict</span>):

                <label class="view-source-button" for="GWPredictionsBase-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GWPredictionsBase"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GWPredictionsBase-55"><a href="#GWPredictionsBase-55"><span class="linenos">55</span></a><span class="k">class</span> <span class="nc">GWPredictionsBase</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
</span><span id="GWPredictionsBase-56"><a href="#GWPredictionsBase-56"><span class="linenos">56</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;TypedDict of the output given when calling `GlobalWorkspaceBase.predict`&quot;&quot;&quot;</span>
</span><span id="GWPredictionsBase-57"><a href="#GWPredictionsBase-57"><span class="linenos">57</span></a>
</span><span id="GWPredictionsBase-58"><a href="#GWPredictionsBase-58"><span class="linenos">58</span></a>    <span class="n">states</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span>
</span><span id="GWPredictionsBase-59"><a href="#GWPredictionsBase-59"><span class="linenos">59</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GWPredictionsBase-60"><a href="#GWPredictionsBase-60"><span class="linenos">60</span></a><span class="sd">    GW state representation from domain groups with only one domain.</span>
</span><span id="GWPredictionsBase-61"><a href="#GWPredictionsBase-61"><span class="linenos">61</span></a><span class="sd">    The key represent the domain&#39;s name.</span>
</span><span id="GWPredictionsBase-62"><a href="#GWPredictionsBase-62"><span class="linenos">62</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>TypedDict of the output given when calling <code>GlobalWorkspaceBase.predict</code></p>
</div>


                            <div id="GWPredictionsBase.states" class="classattr">
                                <div class="attr variable">
            <span class="name">states</span><span class="annotation">: dict[str, torch.Tensor]</span>

        
    </div>
    <a class="headerlink" href="#GWPredictionsBase.states"></a>
    
            <div class="docstring"><p>GW state representation from domain groups with only one domain.
The key represent the domain's name.</p>
</div>


                            </div>
                </section>
                <section id="GlobalWorkspaceBase">
                            <input id="GlobalWorkspaceBase-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">GlobalWorkspaceBase</span><wbr>(<span class="base">typing.Generic[~_T_gw_mod, ~_T_selection_mod, ~_T_loss_mod]</span>, <span class="base">lightning.pytorch.core.module.LightningModule</span>):

                <label class="view-source-button" for="GlobalWorkspaceBase-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GlobalWorkspaceBase"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GlobalWorkspaceBase-70"><a href="#GlobalWorkspaceBase-70"><span class="linenos"> 70</span></a><span class="k">class</span> <span class="nc">GlobalWorkspaceBase</span><span class="p">(</span>
</span><span id="GlobalWorkspaceBase-71"><a href="#GlobalWorkspaceBase-71"><span class="linenos"> 71</span></a>    <span class="n">Generic</span><span class="p">[</span><span class="n">_T_gw_mod</span><span class="p">,</span> <span class="n">_T_selection_mod</span><span class="p">,</span> <span class="n">_T_loss_mod</span><span class="p">],</span> <span class="n">LightningModule</span>
</span><span id="GlobalWorkspaceBase-72"><a href="#GlobalWorkspaceBase-72"><span class="linenos"> 72</span></a><span class="p">):</span>
</span><span id="GlobalWorkspaceBase-73"><a href="#GlobalWorkspaceBase-73"><span class="linenos"> 73</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase-74"><a href="#GlobalWorkspaceBase-74"><span class="linenos"> 74</span></a><span class="sd">    Global Workspace Lightning Module.</span>
</span><span id="GlobalWorkspaceBase-75"><a href="#GlobalWorkspaceBase-75"><span class="linenos"> 75</span></a>
</span><span id="GlobalWorkspaceBase-76"><a href="#GlobalWorkspaceBase-76"><span class="linenos"> 76</span></a><span class="sd">    This is the base class to build the Global Workspace.</span>
</span><span id="GlobalWorkspaceBase-77"><a href="#GlobalWorkspaceBase-77"><span class="linenos"> 77</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase-78"><a href="#GlobalWorkspaceBase-78"><span class="linenos"> 78</span></a>
</span><span id="GlobalWorkspaceBase-79"><a href="#GlobalWorkspaceBase-79"><span class="linenos"> 79</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="GlobalWorkspaceBase-80"><a href="#GlobalWorkspaceBase-80"><span class="linenos"> 80</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBase-81"><a href="#GlobalWorkspaceBase-81"><span class="linenos"> 81</span></a>        <span class="n">gw_mod</span><span class="p">:</span> <span class="n">_T_gw_mod</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBase-82"><a href="#GlobalWorkspaceBase-82"><span class="linenos"> 82</span></a>        <span class="n">selection_mod</span><span class="p">:</span> <span class="n">_T_selection_mod</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBase-83"><a href="#GlobalWorkspaceBase-83"><span class="linenos"> 83</span></a>        <span class="n">loss_mod</span><span class="p">:</span> <span class="n">_T_loss_mod</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBase-84"><a href="#GlobalWorkspaceBase-84"><span class="linenos"> 84</span></a>        <span class="n">optim_lr</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBase-85"><a href="#GlobalWorkspaceBase-85"><span class="linenos"> 85</span></a>        <span class="n">optim_weight_decay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBase-86"><a href="#GlobalWorkspaceBase-86"><span class="linenos"> 86</span></a>        <span class="n">scheduler_args</span><span class="p">:</span> <span class="n">SchedulerArgs</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBase-87"><a href="#GlobalWorkspaceBase-87"><span class="linenos"> 87</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GlobalWorkspaceBase-88"><a href="#GlobalWorkspaceBase-88"><span class="linenos"> 88</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase-89"><a href="#GlobalWorkspaceBase-89"><span class="linenos"> 89</span></a><span class="sd">        Initializes a GW</span>
</span><span id="GlobalWorkspaceBase-90"><a href="#GlobalWorkspaceBase-90"><span class="linenos"> 90</span></a>
</span><span id="GlobalWorkspaceBase-91"><a href="#GlobalWorkspaceBase-91"><span class="linenos"> 91</span></a><span class="sd">        Args:</span>
</span><span id="GlobalWorkspaceBase-92"><a href="#GlobalWorkspaceBase-92"><span class="linenos"> 92</span></a><span class="sd">            gw_mod (`GWModuleBase`): the GWModule</span>
</span><span id="GlobalWorkspaceBase-93"><a href="#GlobalWorkspaceBase-93"><span class="linenos"> 93</span></a><span class="sd">            selection_mod (`SelectionBase`): selection module</span>
</span><span id="GlobalWorkspaceBase-94"><a href="#GlobalWorkspaceBase-94"><span class="linenos"> 94</span></a><span class="sd">            loss_mod (`GWLossesBase`): module to compute the GW losses.</span>
</span><span id="GlobalWorkspaceBase-95"><a href="#GlobalWorkspaceBase-95"><span class="linenos"> 95</span></a><span class="sd">            optim_lr (`float`): learning rate</span>
</span><span id="GlobalWorkspaceBase-96"><a href="#GlobalWorkspaceBase-96"><span class="linenos"> 96</span></a><span class="sd">            optim_weight_decay (`float`): weight decay</span>
</span><span id="GlobalWorkspaceBase-97"><a href="#GlobalWorkspaceBase-97"><span class="linenos"> 97</span></a><span class="sd">            scheduler_args (`SchedulerArgs`): `SchedulerArgs` instance to define</span>
</span><span id="GlobalWorkspaceBase-98"><a href="#GlobalWorkspaceBase-98"><span class="linenos"> 98</span></a><span class="sd">                scheduler parameters.</span>
</span><span id="GlobalWorkspaceBase-99"><a href="#GlobalWorkspaceBase-99"><span class="linenos"> 99</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase-100"><a href="#GlobalWorkspaceBase-100"><span class="linenos">100</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="GlobalWorkspaceBase-101"><a href="#GlobalWorkspaceBase-101"><span class="linenos">101</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">save_hyperparameters</span><span class="p">(</span>
</span><span id="GlobalWorkspaceBase-102"><a href="#GlobalWorkspaceBase-102"><span class="linenos">102</span></a>            <span class="n">ignore</span><span class="o">=</span><span class="p">[</span>
</span><span id="GlobalWorkspaceBase-103"><a href="#GlobalWorkspaceBase-103"><span class="linenos">103</span></a>                <span class="s2">&quot;gw_mod&quot;</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBase-104"><a href="#GlobalWorkspaceBase-104"><span class="linenos">104</span></a>                <span class="s2">&quot;selection_mod&quot;</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBase-105"><a href="#GlobalWorkspaceBase-105"><span class="linenos">105</span></a>                <span class="s2">&quot;domain_mods&quot;</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBase-106"><a href="#GlobalWorkspaceBase-106"><span class="linenos">106</span></a>                <span class="s2">&quot;loss_mod&quot;</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBase-107"><a href="#GlobalWorkspaceBase-107"><span class="linenos">107</span></a>                <span class="s2">&quot;domain_descriptions&quot;</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBase-108"><a href="#GlobalWorkspaceBase-108"><span class="linenos">108</span></a>                <span class="s2">&quot;contrastive_loss&quot;</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBase-109"><a href="#GlobalWorkspaceBase-109"><span class="linenos">109</span></a>                <span class="s2">&quot;cont_loss_bayesian&quot;</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBase-110"><a href="#GlobalWorkspaceBase-110"><span class="linenos">110</span></a>                <span class="s2">&quot;gw_encoders&quot;</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBase-111"><a href="#GlobalWorkspaceBase-111"><span class="linenos">111</span></a>                <span class="s2">&quot;gw_decoders&quot;</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBase-112"><a href="#GlobalWorkspaceBase-112"><span class="linenos">112</span></a>            <span class="p">]</span>
</span><span id="GlobalWorkspaceBase-113"><a href="#GlobalWorkspaceBase-113"><span class="linenos">113</span></a>        <span class="p">)</span>
</span><span id="GlobalWorkspaceBase-114"><a href="#GlobalWorkspaceBase-114"><span class="linenos">114</span></a>
</span><span id="GlobalWorkspaceBase-115"><a href="#GlobalWorkspaceBase-115"><span class="linenos">115</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span> <span class="o">=</span> <span class="n">gw_mod</span>
</span><span id="GlobalWorkspaceBase-116"><a href="#GlobalWorkspaceBase-116"><span class="linenos">116</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; a `GWModuleBase` implementation.&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase-117"><a href="#GlobalWorkspaceBase-117"><span class="linenos">117</span></a>
</span><span id="GlobalWorkspaceBase-118"><a href="#GlobalWorkspaceBase-118"><span class="linenos">118</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">selection_mod</span> <span class="o">=</span> <span class="n">selection_mod</span>
</span><span id="GlobalWorkspaceBase-119"><a href="#GlobalWorkspaceBase-119"><span class="linenos">119</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;A `SelectionBase` implementation.&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase-120"><a href="#GlobalWorkspaceBase-120"><span class="linenos">120</span></a>
</span><span id="GlobalWorkspaceBase-121"><a href="#GlobalWorkspaceBase-121"><span class="linenos">121</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">loss_mod</span> <span class="o">=</span> <span class="n">loss_mod</span>
</span><span id="GlobalWorkspaceBase-122"><a href="#GlobalWorkspaceBase-122"><span class="linenos">122</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The module that computes losses of the GW&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase-123"><a href="#GlobalWorkspaceBase-123"><span class="linenos">123</span></a>
</span><span id="GlobalWorkspaceBase-124"><a href="#GlobalWorkspaceBase-124"><span class="linenos">124</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">optim_lr</span> <span class="o">=</span> <span class="n">optim_lr</span>
</span><span id="GlobalWorkspaceBase-125"><a href="#GlobalWorkspaceBase-125"><span class="linenos">125</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">optim_weight_decay</span> <span class="o">=</span> <span class="n">optim_weight_decay</span>
</span><span id="GlobalWorkspaceBase-126"><a href="#GlobalWorkspaceBase-126"><span class="linenos">126</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scheduler_args</span> <span class="o">=</span> <span class="n">SchedulerArgs</span><span class="p">(</span><span class="n">max_lr</span><span class="o">=</span><span class="n">optim_lr</span><span class="p">,</span> <span class="n">total_steps</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="GlobalWorkspaceBase-127"><a href="#GlobalWorkspaceBase-127"><span class="linenos">127</span></a>        <span class="k">if</span> <span class="n">scheduler_args</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GlobalWorkspaceBase-128"><a href="#GlobalWorkspaceBase-128"><span class="linenos">128</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">scheduler_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">scheduler_args</span><span class="p">)</span>
</span><span id="GlobalWorkspaceBase-129"><a href="#GlobalWorkspaceBase-129"><span class="linenos">129</span></a>
</span><span id="GlobalWorkspaceBase-130"><a href="#GlobalWorkspaceBase-130"><span class="linenos">130</span></a>    <span class="nd">@property</span>
</span><span id="GlobalWorkspaceBase-131"><a href="#GlobalWorkspaceBase-131"><span class="linenos">131</span></a>    <span class="k">def</span> <span class="nf">domain_mods</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DomainModule</span><span class="p">]:</span>
</span><span id="GlobalWorkspaceBase-132"><a href="#GlobalWorkspaceBase-132"><span class="linenos">132</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="o">.</span><span class="n">domain_mods</span>
</span><span id="GlobalWorkspaceBase-133"><a href="#GlobalWorkspaceBase-133"><span class="linenos">133</span></a>
</span><span id="GlobalWorkspaceBase-134"><a href="#GlobalWorkspaceBase-134"><span class="linenos">134</span></a>    <span class="nd">@property</span>
</span><span id="GlobalWorkspaceBase-135"><a href="#GlobalWorkspaceBase-135"><span class="linenos">135</span></a>    <span class="k">def</span> <span class="nf">workspace_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="GlobalWorkspaceBase-136"><a href="#GlobalWorkspaceBase-136"><span class="linenos">136</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Dimension of the GW.&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase-137"><a href="#GlobalWorkspaceBase-137"><span class="linenos">137</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="o">.</span><span class="n">workspace_dim</span>
</span><span id="GlobalWorkspaceBase-138"><a href="#GlobalWorkspaceBase-138"><span class="linenos">138</span></a>
</span><span id="GlobalWorkspaceBase-139"><a href="#GlobalWorkspaceBase-139"><span class="linenos">139</span></a>    <span class="k">def</span> <span class="nf">encode_and_fuse</span><span class="p">(</span>
</span><span id="GlobalWorkspaceBase-140"><a href="#GlobalWorkspaceBase-140"><span class="linenos">140</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">LatentsDomainGroupsT</span><span class="p">,</span> <span class="n">selection_module</span><span class="p">:</span> <span class="n">SelectionBase</span>
</span><span id="GlobalWorkspaceBase-141"><a href="#GlobalWorkspaceBase-141"><span class="linenos">141</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
</span><span id="GlobalWorkspaceBase-142"><a href="#GlobalWorkspaceBase-142"><span class="linenos">142</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase-143"><a href="#GlobalWorkspaceBase-143"><span class="linenos">143</span></a><span class="sd">        Encode a group of latent representations into the GW representation.</span>
</span><span id="GlobalWorkspaceBase-144"><a href="#GlobalWorkspaceBase-144"><span class="linenos">144</span></a>
</span><span id="GlobalWorkspaceBase-145"><a href="#GlobalWorkspaceBase-145"><span class="linenos">145</span></a><span class="sd">        Args:</span>
</span><span id="GlobalWorkspaceBase-146"><a href="#GlobalWorkspaceBase-146"><span class="linenos">146</span></a><span class="sd">            x (`LatentsDomainGroupsT`): the input domain representations.</span>
</span><span id="GlobalWorkspaceBase-147"><a href="#GlobalWorkspaceBase-147"><span class="linenos">147</span></a><span class="sd">            selection_scores (`Mapping[str, torch.Tensor]`):</span>
</span><span id="GlobalWorkspaceBase-148"><a href="#GlobalWorkspaceBase-148"><span class="linenos">148</span></a>
</span><span id="GlobalWorkspaceBase-149"><a href="#GlobalWorkspaceBase-149"><span class="linenos">149</span></a><span class="sd">        Returns:</span>
</span><span id="GlobalWorkspaceBase-150"><a href="#GlobalWorkspaceBase-150"><span class="linenos">150</span></a><span class="sd">            `dict[frozenset[str], torch.Tensor]`: the GW representations.</span>
</span><span id="GlobalWorkspaceBase-151"><a href="#GlobalWorkspaceBase-151"><span class="linenos">151</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase-152"><a href="#GlobalWorkspaceBase-152"><span class="linenos">152</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="GlobalWorkspaceBase-153"><a href="#GlobalWorkspaceBase-153"><span class="linenos">153</span></a>            <span class="n">domains</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="o">.</span><span class="n">encode_and_fuse</span><span class="p">(</span><span class="n">latents</span><span class="p">,</span> <span class="n">selection_module</span><span class="p">)</span>
</span><span id="GlobalWorkspaceBase-154"><a href="#GlobalWorkspaceBase-154"><span class="linenos">154</span></a>            <span class="k">for</span> <span class="n">domains</span><span class="p">,</span> <span class="n">latents</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="GlobalWorkspaceBase-155"><a href="#GlobalWorkspaceBase-155"><span class="linenos">155</span></a>        <span class="p">}</span>
</span><span id="GlobalWorkspaceBase-156"><a href="#GlobalWorkspaceBase-156"><span class="linenos">156</span></a>
</span><span id="GlobalWorkspaceBase-157"><a href="#GlobalWorkspaceBase-157"><span class="linenos">157</span></a>    <span class="k">def</span> <span class="nf">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">LatentsDomainGroupsT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LatentsDomainGroupsDT</span><span class="p">:</span>
</span><span id="GlobalWorkspaceBase-158"><a href="#GlobalWorkspaceBase-158"><span class="linenos">158</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase-159"><a href="#GlobalWorkspaceBase-159"><span class="linenos">159</span></a><span class="sd">        Encode a group of latent representations into the pre-fusion GW representation.</span>
</span><span id="GlobalWorkspaceBase-160"><a href="#GlobalWorkspaceBase-160"><span class="linenos">160</span></a>
</span><span id="GlobalWorkspaceBase-161"><a href="#GlobalWorkspaceBase-161"><span class="linenos">161</span></a><span class="sd">        Args:</span>
</span><span id="GlobalWorkspaceBase-162"><a href="#GlobalWorkspaceBase-162"><span class="linenos">162</span></a><span class="sd">            x (`LatentsDomainGroupsT`): the input domain representations.</span>
</span><span id="GlobalWorkspaceBase-163"><a href="#GlobalWorkspaceBase-163"><span class="linenos">163</span></a>
</span><span id="GlobalWorkspaceBase-164"><a href="#GlobalWorkspaceBase-164"><span class="linenos">164</span></a><span class="sd">        Returns:</span>
</span><span id="GlobalWorkspaceBase-165"><a href="#GlobalWorkspaceBase-165"><span class="linenos">165</span></a><span class="sd">            `LatensDomainGroupsDT`: the GW representations.</span>
</span><span id="GlobalWorkspaceBase-166"><a href="#GlobalWorkspaceBase-166"><span class="linenos">166</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase-167"><a href="#GlobalWorkspaceBase-167"><span class="linenos">167</span></a>        <span class="k">return</span> <span class="p">{</span><span class="n">domains</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">latents</span><span class="p">)</span> <span class="k">for</span> <span class="n">domains</span><span class="p">,</span> <span class="n">latents</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="GlobalWorkspaceBase-168"><a href="#GlobalWorkspaceBase-168"><span class="linenos">168</span></a>
</span><span id="GlobalWorkspaceBase-169"><a href="#GlobalWorkspaceBase-169"><span class="linenos">169</span></a>    <span class="k">def</span> <span class="nf">fuse</span><span class="p">(</span>
</span><span id="GlobalWorkspaceBase-170"><a href="#GlobalWorkspaceBase-170"><span class="linenos">170</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBase-171"><a href="#GlobalWorkspaceBase-171"><span class="linenos">171</span></a>        <span class="n">x</span><span class="p">:</span> <span class="n">LatentsDomainGroupsT</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBase-172"><a href="#GlobalWorkspaceBase-172"><span class="linenos">172</span></a>        <span class="n">selection_scores</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]],</span>
</span><span id="GlobalWorkspaceBase-173"><a href="#GlobalWorkspaceBase-173"><span class="linenos">173</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
</span><span id="GlobalWorkspaceBase-174"><a href="#GlobalWorkspaceBase-174"><span class="linenos">174</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase-175"><a href="#GlobalWorkspaceBase-175"><span class="linenos">175</span></a><span class="sd">        Fuses a group of latent representations into the GW representation.</span>
</span><span id="GlobalWorkspaceBase-176"><a href="#GlobalWorkspaceBase-176"><span class="linenos">176</span></a>
</span><span id="GlobalWorkspaceBase-177"><a href="#GlobalWorkspaceBase-177"><span class="linenos">177</span></a><span class="sd">        Args:</span>
</span><span id="GlobalWorkspaceBase-178"><a href="#GlobalWorkspaceBase-178"><span class="linenos">178</span></a><span class="sd">            x (`LatentsDomainGroupsT`): the pre-fusion latent representations</span>
</span><span id="GlobalWorkspaceBase-179"><a href="#GlobalWorkspaceBase-179"><span class="linenos">179</span></a><span class="sd">            selection_scores (`Mapping[frozenset[str], Mapping[str, torch.Tensor]]`):</span>
</span><span id="GlobalWorkspaceBase-180"><a href="#GlobalWorkspaceBase-180"><span class="linenos">180</span></a><span class="sd">                selection scores for each group</span>
</span><span id="GlobalWorkspaceBase-181"><a href="#GlobalWorkspaceBase-181"><span class="linenos">181</span></a>
</span><span id="GlobalWorkspaceBase-182"><a href="#GlobalWorkspaceBase-182"><span class="linenos">182</span></a><span class="sd">        Returns:</span>
</span><span id="GlobalWorkspaceBase-183"><a href="#GlobalWorkspaceBase-183"><span class="linenos">183</span></a><span class="sd">            `dict[frozenset[str], torch.Tensor]`: GW representation of each group</span>
</span><span id="GlobalWorkspaceBase-184"><a href="#GlobalWorkspaceBase-184"><span class="linenos">184</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase-185"><a href="#GlobalWorkspaceBase-185"><span class="linenos">185</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="GlobalWorkspaceBase-186"><a href="#GlobalWorkspaceBase-186"><span class="linenos">186</span></a>            <span class="n">domains</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="o">.</span><span class="n">fuse</span><span class="p">(</span><span class="n">latents</span><span class="p">,</span> <span class="n">selection_scores</span><span class="p">[</span><span class="n">domains</span><span class="p">])</span>
</span><span id="GlobalWorkspaceBase-187"><a href="#GlobalWorkspaceBase-187"><span class="linenos">187</span></a>            <span class="k">for</span> <span class="n">domains</span><span class="p">,</span> <span class="n">latents</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="GlobalWorkspaceBase-188"><a href="#GlobalWorkspaceBase-188"><span class="linenos">188</span></a>        <span class="p">}</span>
</span><span id="GlobalWorkspaceBase-189"><a href="#GlobalWorkspaceBase-189"><span class="linenos">189</span></a>
</span><span id="GlobalWorkspaceBase-190"><a href="#GlobalWorkspaceBase-190"><span class="linenos">190</span></a>    <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span>
</span><span id="GlobalWorkspaceBase-191"><a href="#GlobalWorkspaceBase-191"><span class="linenos">191</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBase-192"><a href="#GlobalWorkspaceBase-192"><span class="linenos">192</span></a>        <span class="n">z</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span>
</span><span id="GlobalWorkspaceBase-193"><a href="#GlobalWorkspaceBase-193"><span class="linenos">193</span></a>        <span class="n">domains</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBase-194"><a href="#GlobalWorkspaceBase-194"><span class="linenos">194</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LatentsDomainGroupsDT</span><span class="p">:</span>
</span><span id="GlobalWorkspaceBase-195"><a href="#GlobalWorkspaceBase-195"><span class="linenos">195</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase-196"><a href="#GlobalWorkspaceBase-196"><span class="linenos">196</span></a><span class="sd">        Decode the group GW representation into given `domains`.</span>
</span><span id="GlobalWorkspaceBase-197"><a href="#GlobalWorkspaceBase-197"><span class="linenos">197</span></a>
</span><span id="GlobalWorkspaceBase-198"><a href="#GlobalWorkspaceBase-198"><span class="linenos">198</span></a><span class="sd">        Args:</span>
</span><span id="GlobalWorkspaceBase-199"><a href="#GlobalWorkspaceBase-199"><span class="linenos">199</span></a><span class="sd">            z (`torch.Tensor`): the GW representation.</span>
</span><span id="GlobalWorkspaceBase-200"><a href="#GlobalWorkspaceBase-200"><span class="linenos">200</span></a><span class="sd">            domains (`Iterable[str]`): iterable of domains to decode.</span>
</span><span id="GlobalWorkspaceBase-201"><a href="#GlobalWorkspaceBase-201"><span class="linenos">201</span></a>
</span><span id="GlobalWorkspaceBase-202"><a href="#GlobalWorkspaceBase-202"><span class="linenos">202</span></a><span class="sd">        Returns:</span>
</span><span id="GlobalWorkspaceBase-203"><a href="#GlobalWorkspaceBase-203"><span class="linenos">203</span></a><span class="sd">            `dict[str, torch.Tensor]`: the decoded unimodal representations.</span>
</span><span id="GlobalWorkspaceBase-204"><a href="#GlobalWorkspaceBase-204"><span class="linenos">204</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase-205"><a href="#GlobalWorkspaceBase-205"><span class="linenos">205</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="GlobalWorkspaceBase-206"><a href="#GlobalWorkspaceBase-206"><span class="linenos">206</span></a>            <span class="n">domain_names</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">gw_rep</span><span class="p">,</span> <span class="n">domains</span><span class="p">)</span>
</span><span id="GlobalWorkspaceBase-207"><a href="#GlobalWorkspaceBase-207"><span class="linenos">207</span></a>            <span class="k">for</span> <span class="n">domain_names</span><span class="p">,</span> <span class="n">gw_rep</span> <span class="ow">in</span> <span class="n">z</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="GlobalWorkspaceBase-208"><a href="#GlobalWorkspaceBase-208"><span class="linenos">208</span></a>        <span class="p">}</span>
</span><span id="GlobalWorkspaceBase-209"><a href="#GlobalWorkspaceBase-209"><span class="linenos">209</span></a>
</span><span id="GlobalWorkspaceBase-210"><a href="#GlobalWorkspaceBase-210"><span class="linenos">210</span></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="GlobalWorkspaceBase-211"><a href="#GlobalWorkspaceBase-211"><span class="linenos">211</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBase-212"><a href="#GlobalWorkspaceBase-212"><span class="linenos">212</span></a>        <span class="n">latent_domains</span><span class="p">:</span> <span class="n">LatentsDomainGroupsT</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBase-213"><a href="#GlobalWorkspaceBase-213"><span class="linenos">213</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GWPredictionsBase</span><span class="p">:</span>
</span><span id="GlobalWorkspaceBase-214"><a href="#GlobalWorkspaceBase-214"><span class="linenos">214</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase-215"><a href="#GlobalWorkspaceBase-215"><span class="linenos">215</span></a><span class="sd">        Computes demi-cycles, cycles, and translations.</span>
</span><span id="GlobalWorkspaceBase-216"><a href="#GlobalWorkspaceBase-216"><span class="linenos">216</span></a>
</span><span id="GlobalWorkspaceBase-217"><a href="#GlobalWorkspaceBase-217"><span class="linenos">217</span></a><span class="sd">        Args:</span>
</span><span id="GlobalWorkspaceBase-218"><a href="#GlobalWorkspaceBase-218"><span class="linenos">218</span></a><span class="sd">            latent_domains (`LatentsT`): Groups of domains for the computation.</span>
</span><span id="GlobalWorkspaceBase-219"><a href="#GlobalWorkspaceBase-219"><span class="linenos">219</span></a>
</span><span id="GlobalWorkspaceBase-220"><a href="#GlobalWorkspaceBase-220"><span class="linenos">220</span></a><span class="sd">        Returns:</span>
</span><span id="GlobalWorkspaceBase-221"><a href="#GlobalWorkspaceBase-221"><span class="linenos">221</span></a><span class="sd">            `GWPredictionsBase`: the predictions on the batch.</span>
</span><span id="GlobalWorkspaceBase-222"><a href="#GlobalWorkspaceBase-222"><span class="linenos">222</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase-223"><a href="#GlobalWorkspaceBase-223"><span class="linenos">223</span></a>
</span><span id="GlobalWorkspaceBase-224"><a href="#GlobalWorkspaceBase-224"><span class="linenos">224</span></a>        <span class="k">return</span> <span class="n">GWPredictionsBase</span><span class="p">(</span><span class="n">states</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_gw_states</span><span class="p">(</span><span class="n">latent_domains</span><span class="p">))</span>
</span><span id="GlobalWorkspaceBase-225"><a href="#GlobalWorkspaceBase-225"><span class="linenos">225</span></a>
</span><span id="GlobalWorkspaceBase-226"><a href="#GlobalWorkspaceBase-226"><span class="linenos">226</span></a>    <span class="k">def</span> <span class="nf">batch_gw_states</span><span class="p">(</span>
</span><span id="GlobalWorkspaceBase-227"><a href="#GlobalWorkspaceBase-227"><span class="linenos">227</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">latent_domains</span><span class="p">:</span> <span class="n">LatentsDomainGroupsT</span>
</span><span id="GlobalWorkspaceBase-228"><a href="#GlobalWorkspaceBase-228"><span class="linenos">228</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
</span><span id="GlobalWorkspaceBase-229"><a href="#GlobalWorkspaceBase-229"><span class="linenos">229</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase-230"><a href="#GlobalWorkspaceBase-230"><span class="linenos">230</span></a><span class="sd">        Comptues GW states of a batch of groups of domains.</span>
</span><span id="GlobalWorkspaceBase-231"><a href="#GlobalWorkspaceBase-231"><span class="linenos">231</span></a>
</span><span id="GlobalWorkspaceBase-232"><a href="#GlobalWorkspaceBase-232"><span class="linenos">232</span></a><span class="sd">        Args:</span>
</span><span id="GlobalWorkspaceBase-233"><a href="#GlobalWorkspaceBase-233"><span class="linenos">233</span></a><span class="sd">            latent_domains (`LatentsT`): the batch of groups of domains</span>
</span><span id="GlobalWorkspaceBase-234"><a href="#GlobalWorkspaceBase-234"><span class="linenos">234</span></a>
</span><span id="GlobalWorkspaceBase-235"><a href="#GlobalWorkspaceBase-235"><span class="linenos">235</span></a><span class="sd">        Returns:</span>
</span><span id="GlobalWorkspaceBase-236"><a href="#GlobalWorkspaceBase-236"><span class="linenos">236</span></a><span class="sd">            `dict[str, torch.Tensor]`: states for each domain.</span>
</span><span id="GlobalWorkspaceBase-237"><a href="#GlobalWorkspaceBase-237"><span class="linenos">237</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase-238"><a href="#GlobalWorkspaceBase-238"><span class="linenos">238</span></a>        <span class="n">predictions</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="GlobalWorkspaceBase-239"><a href="#GlobalWorkspaceBase-239"><span class="linenos">239</span></a>        <span class="k">for</span> <span class="n">domains</span><span class="p">,</span> <span class="n">latents</span> <span class="ow">in</span> <span class="n">latent_domains</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="GlobalWorkspaceBase-240"><a href="#GlobalWorkspaceBase-240"><span class="linenos">240</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">domains</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="GlobalWorkspaceBase-241"><a href="#GlobalWorkspaceBase-241"><span class="linenos">241</span></a>                <span class="k">continue</span>
</span><span id="GlobalWorkspaceBase-242"><a href="#GlobalWorkspaceBase-242"><span class="linenos">242</span></a>            <span class="n">domain_name</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">domains</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GlobalWorkspaceBase-243"><a href="#GlobalWorkspaceBase-243"><span class="linenos">243</span></a>            <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="o">.</span><span class="n">encode_and_fuse</span><span class="p">(</span>
</span><span id="GlobalWorkspaceBase-244"><a href="#GlobalWorkspaceBase-244"><span class="linenos">244</span></a>                <span class="n">latents</span><span class="p">,</span> <span class="n">selection_module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">selection_mod</span>
</span><span id="GlobalWorkspaceBase-245"><a href="#GlobalWorkspaceBase-245"><span class="linenos">245</span></a>            <span class="p">)</span>
</span><span id="GlobalWorkspaceBase-246"><a href="#GlobalWorkspaceBase-246"><span class="linenos">246</span></a>            <span class="n">predictions</span><span class="p">[</span><span class="n">domain_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span>
</span><span id="GlobalWorkspaceBase-247"><a href="#GlobalWorkspaceBase-247"><span class="linenos">247</span></a>        <span class="k">return</span> <span class="n">predictions</span>
</span><span id="GlobalWorkspaceBase-248"><a href="#GlobalWorkspaceBase-248"><span class="linenos">248</span></a>
</span><span id="GlobalWorkspaceBase-249"><a href="#GlobalWorkspaceBase-249"><span class="linenos">249</span></a>    <span class="k">def</span> <span class="nf">encode_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="GlobalWorkspaceBase-250"><a href="#GlobalWorkspaceBase-250"><span class="linenos">250</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase-251"><a href="#GlobalWorkspaceBase-251"><span class="linenos">251</span></a><span class="sd">        Encodes a domain from the domain data into the unimodal representation.</span>
</span><span id="GlobalWorkspaceBase-252"><a href="#GlobalWorkspaceBase-252"><span class="linenos">252</span></a>
</span><span id="GlobalWorkspaceBase-253"><a href="#GlobalWorkspaceBase-253"><span class="linenos">253</span></a><span class="sd">        This is a convenient proxy for the `DomainModule.encode` method and is</span>
</span><span id="GlobalWorkspaceBase-254"><a href="#GlobalWorkspaceBase-254"><span class="linenos">254</span></a><span class="sd">        equivalent to:</span>
</span><span id="GlobalWorkspaceBase-255"><a href="#GlobalWorkspaceBase-255"><span class="linenos">255</span></a><span class="sd">        ```python</span>
</span><span id="GlobalWorkspaceBase-256"><a href="#GlobalWorkspaceBase-256"><span class="linenos">256</span></a><span class="sd">        self.domain_mods[name].encode(domain)</span>
</span><span id="GlobalWorkspaceBase-257"><a href="#GlobalWorkspaceBase-257"><span class="linenos">257</span></a><span class="sd">        ```</span>
</span><span id="GlobalWorkspaceBase-258"><a href="#GlobalWorkspaceBase-258"><span class="linenos">258</span></a>
</span><span id="GlobalWorkspaceBase-259"><a href="#GlobalWorkspaceBase-259"><span class="linenos">259</span></a><span class="sd">        Args:</span>
</span><span id="GlobalWorkspaceBase-260"><a href="#GlobalWorkspaceBase-260"><span class="linenos">260</span></a><span class="sd">            domain (`Any`): the domain data</span>
</span><span id="GlobalWorkspaceBase-261"><a href="#GlobalWorkspaceBase-261"><span class="linenos">261</span></a><span class="sd">            name (`str`): domain name to encode</span>
</span><span id="GlobalWorkspaceBase-262"><a href="#GlobalWorkspaceBase-262"><span class="linenos">262</span></a>
</span><span id="GlobalWorkspaceBase-263"><a href="#GlobalWorkspaceBase-263"><span class="linenos">263</span></a><span class="sd">        Returns:</span>
</span><span id="GlobalWorkspaceBase-264"><a href="#GlobalWorkspaceBase-264"><span class="linenos">264</span></a><span class="sd">            `torch.Tensor`: the domain&#39;s unimodal representation.</span>
</span><span id="GlobalWorkspaceBase-265"><a href="#GlobalWorkspaceBase-265"><span class="linenos">265</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase-266"><a href="#GlobalWorkspaceBase-266"><span class="linenos">266</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_mods</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
</span><span id="GlobalWorkspaceBase-267"><a href="#GlobalWorkspaceBase-267"><span class="linenos">267</span></a>
</span><span id="GlobalWorkspaceBase-268"><a href="#GlobalWorkspaceBase-268"><span class="linenos">268</span></a>    <span class="k">def</span> <span class="nf">encode_domains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">RawDomainGroupsT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LatentsDomainGroupsDT</span><span class="p">:</span>
</span><span id="GlobalWorkspaceBase-269"><a href="#GlobalWorkspaceBase-269"><span class="linenos">269</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase-270"><a href="#GlobalWorkspaceBase-270"><span class="linenos">270</span></a><span class="sd">        Encode all domains in the batch.</span>
</span><span id="GlobalWorkspaceBase-271"><a href="#GlobalWorkspaceBase-271"><span class="linenos">271</span></a>
</span><span id="GlobalWorkspaceBase-272"><a href="#GlobalWorkspaceBase-272"><span class="linenos">272</span></a><span class="sd">        Args:</span>
</span><span id="GlobalWorkspaceBase-273"><a href="#GlobalWorkspaceBase-273"><span class="linenos">273</span></a><span class="sd">            batch (`RawDomainGroupsT`): the batch of</span>
</span><span id="GlobalWorkspaceBase-274"><a href="#GlobalWorkspaceBase-274"><span class="linenos">274</span></a><span class="sd">                domain groups with raw unimodal data to encode into groups of latent</span>
</span><span id="GlobalWorkspaceBase-275"><a href="#GlobalWorkspaceBase-275"><span class="linenos">275</span></a><span class="sd">                representations.</span>
</span><span id="GlobalWorkspaceBase-276"><a href="#GlobalWorkspaceBase-276"><span class="linenos">276</span></a>
</span><span id="GlobalWorkspaceBase-277"><a href="#GlobalWorkspaceBase-277"><span class="linenos">277</span></a><span class="sd">        Returns:</span>
</span><span id="GlobalWorkspaceBase-278"><a href="#GlobalWorkspaceBase-278"><span class="linenos">278</span></a><span class="sd">            `LatentsDomainGroupsDT`: the domains&#39; unimodal representations.</span>
</span><span id="GlobalWorkspaceBase-279"><a href="#GlobalWorkspaceBase-279"><span class="linenos">279</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase-280"><a href="#GlobalWorkspaceBase-280"><span class="linenos">280</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="GlobalWorkspaceBase-281"><a href="#GlobalWorkspaceBase-281"><span class="linenos">281</span></a>            <span class="n">domains</span><span class="p">:</span> <span class="p">{</span>
</span><span id="GlobalWorkspaceBase-282"><a href="#GlobalWorkspaceBase-282"><span class="linenos">282</span></a>                <span class="n">name</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_mods</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
</span><span id="GlobalWorkspaceBase-283"><a href="#GlobalWorkspaceBase-283"><span class="linenos">283</span></a>                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">domain</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="GlobalWorkspaceBase-284"><a href="#GlobalWorkspaceBase-284"><span class="linenos">284</span></a>            <span class="p">}</span>
</span><span id="GlobalWorkspaceBase-285"><a href="#GlobalWorkspaceBase-285"><span class="linenos">285</span></a>            <span class="k">for</span> <span class="n">domains</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">batch</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="GlobalWorkspaceBase-286"><a href="#GlobalWorkspaceBase-286"><span class="linenos">286</span></a>        <span class="p">}</span>
</span><span id="GlobalWorkspaceBase-287"><a href="#GlobalWorkspaceBase-287"><span class="linenos">287</span></a>
</span><span id="GlobalWorkspaceBase-288"><a href="#GlobalWorkspaceBase-288"><span class="linenos">288</span></a>    <span class="k">def</span> <span class="nf">decode_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="GlobalWorkspaceBase-289"><a href="#GlobalWorkspaceBase-289"><span class="linenos">289</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase-290"><a href="#GlobalWorkspaceBase-290"><span class="linenos">290</span></a><span class="sd">        Decodes a domain from the unimodal representation into the domain data.</span>
</span><span id="GlobalWorkspaceBase-291"><a href="#GlobalWorkspaceBase-291"><span class="linenos">291</span></a>
</span><span id="GlobalWorkspaceBase-292"><a href="#GlobalWorkspaceBase-292"><span class="linenos">292</span></a><span class="sd">        This is a convenient proxy for the `DomainModule.encode` method and is</span>
</span><span id="GlobalWorkspaceBase-293"><a href="#GlobalWorkspaceBase-293"><span class="linenos">293</span></a><span class="sd">        equivalent to:</span>
</span><span id="GlobalWorkspaceBase-294"><a href="#GlobalWorkspaceBase-294"><span class="linenos">294</span></a><span class="sd">        ```python</span>
</span><span id="GlobalWorkspaceBase-295"><a href="#GlobalWorkspaceBase-295"><span class="linenos">295</span></a><span class="sd">        self.domain_mods[name].decode(domain)</span>
</span><span id="GlobalWorkspaceBase-296"><a href="#GlobalWorkspaceBase-296"><span class="linenos">296</span></a><span class="sd">        ```</span>
</span><span id="GlobalWorkspaceBase-297"><a href="#GlobalWorkspaceBase-297"><span class="linenos">297</span></a>
</span><span id="GlobalWorkspaceBase-298"><a href="#GlobalWorkspaceBase-298"><span class="linenos">298</span></a><span class="sd">        Args:</span>
</span><span id="GlobalWorkspaceBase-299"><a href="#GlobalWorkspaceBase-299"><span class="linenos">299</span></a><span class="sd">            domain (`torch.Tensor`): the domain data</span>
</span><span id="GlobalWorkspaceBase-300"><a href="#GlobalWorkspaceBase-300"><span class="linenos">300</span></a><span class="sd">            name (`str`): domain name to encode</span>
</span><span id="GlobalWorkspaceBase-301"><a href="#GlobalWorkspaceBase-301"><span class="linenos">301</span></a>
</span><span id="GlobalWorkspaceBase-302"><a href="#GlobalWorkspaceBase-302"><span class="linenos">302</span></a><span class="sd">        Returns:</span>
</span><span id="GlobalWorkspaceBase-303"><a href="#GlobalWorkspaceBase-303"><span class="linenos">303</span></a><span class="sd">            `Any`: the domain&#39;s raw data.</span>
</span><span id="GlobalWorkspaceBase-304"><a href="#GlobalWorkspaceBase-304"><span class="linenos">304</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase-305"><a href="#GlobalWorkspaceBase-305"><span class="linenos">305</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_mods</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
</span><span id="GlobalWorkspaceBase-306"><a href="#GlobalWorkspaceBase-306"><span class="linenos">306</span></a>
</span><span id="GlobalWorkspaceBase-307"><a href="#GlobalWorkspaceBase-307"><span class="linenos">307</span></a>    <span class="k">def</span> <span class="nf">decode_domains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">latents_domain</span><span class="p">:</span> <span class="n">LatentsDomainGroupsT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RawDomainGroupsDT</span><span class="p">:</span>
</span><span id="GlobalWorkspaceBase-308"><a href="#GlobalWorkspaceBase-308"><span class="linenos">308</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase-309"><a href="#GlobalWorkspaceBase-309"><span class="linenos">309</span></a><span class="sd">        Decodes all domains in the batch.</span>
</span><span id="GlobalWorkspaceBase-310"><a href="#GlobalWorkspaceBase-310"><span class="linenos">310</span></a>
</span><span id="GlobalWorkspaceBase-311"><a href="#GlobalWorkspaceBase-311"><span class="linenos">311</span></a><span class="sd">        Args:</span>
</span><span id="GlobalWorkspaceBase-312"><a href="#GlobalWorkspaceBase-312"><span class="linenos">312</span></a><span class="sd">            batch (`LatentsDomainGroupsT`): the batch of</span>
</span><span id="GlobalWorkspaceBase-313"><a href="#GlobalWorkspaceBase-313"><span class="linenos">313</span></a><span class="sd">                domain groups with unimodal latent representation to decode into</span>
</span><span id="GlobalWorkspaceBase-314"><a href="#GlobalWorkspaceBase-314"><span class="linenos">314</span></a><span class="sd">                groups of raw data.</span>
</span><span id="GlobalWorkspaceBase-315"><a href="#GlobalWorkspaceBase-315"><span class="linenos">315</span></a>
</span><span id="GlobalWorkspaceBase-316"><a href="#GlobalWorkspaceBase-316"><span class="linenos">316</span></a><span class="sd">        Returns:</span>
</span><span id="GlobalWorkspaceBase-317"><a href="#GlobalWorkspaceBase-317"><span class="linenos">317</span></a><span class="sd">            `LatentsDomainGroupsDT`: the domains&#39; raw data.</span>
</span><span id="GlobalWorkspaceBase-318"><a href="#GlobalWorkspaceBase-318"><span class="linenos">318</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase-319"><a href="#GlobalWorkspaceBase-319"><span class="linenos">319</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="GlobalWorkspaceBase-320"><a href="#GlobalWorkspaceBase-320"><span class="linenos">320</span></a>            <span class="n">domains</span><span class="p">:</span> <span class="p">{</span>
</span><span id="GlobalWorkspaceBase-321"><a href="#GlobalWorkspaceBase-321"><span class="linenos">321</span></a>                <span class="n">name</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_mods</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
</span><span id="GlobalWorkspaceBase-322"><a href="#GlobalWorkspaceBase-322"><span class="linenos">322</span></a>                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">domain</span> <span class="ow">in</span> <span class="n">latents</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="GlobalWorkspaceBase-323"><a href="#GlobalWorkspaceBase-323"><span class="linenos">323</span></a>            <span class="p">}</span>
</span><span id="GlobalWorkspaceBase-324"><a href="#GlobalWorkspaceBase-324"><span class="linenos">324</span></a>            <span class="k">for</span> <span class="n">domains</span><span class="p">,</span> <span class="n">latents</span> <span class="ow">in</span> <span class="n">latents_domain</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="GlobalWorkspaceBase-325"><a href="#GlobalWorkspaceBase-325"><span class="linenos">325</span></a>        <span class="p">}</span>
</span><span id="GlobalWorkspaceBase-326"><a href="#GlobalWorkspaceBase-326"><span class="linenos">326</span></a>
</span><span id="GlobalWorkspaceBase-327"><a href="#GlobalWorkspaceBase-327"><span class="linenos">327</span></a>    <span class="k">def</span> <span class="nf">generic_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">RawDomainGroupsT</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="n">ModelModeT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="GlobalWorkspaceBase-328"><a href="#GlobalWorkspaceBase-328"><span class="linenos">328</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase-329"><a href="#GlobalWorkspaceBase-329"><span class="linenos">329</span></a><span class="sd">        The generic step used in `training_step`, `validation_step` and</span>
</span><span id="GlobalWorkspaceBase-330"><a href="#GlobalWorkspaceBase-330"><span class="linenos">330</span></a><span class="sd">        `test_step`.</span>
</span><span id="GlobalWorkspaceBase-331"><a href="#GlobalWorkspaceBase-331"><span class="linenos">331</span></a>
</span><span id="GlobalWorkspaceBase-332"><a href="#GlobalWorkspaceBase-332"><span class="linenos">332</span></a><span class="sd">        Args:</span>
</span><span id="GlobalWorkspaceBase-333"><a href="#GlobalWorkspaceBase-333"><span class="linenos">333</span></a><span class="sd">            batch (`RawDomainGroupsT`): the batch of groups of raw unimodal data.</span>
</span><span id="GlobalWorkspaceBase-334"><a href="#GlobalWorkspaceBase-334"><span class="linenos">334</span></a><span class="sd">            mode (`ModelModeT`):</span>
</span><span id="GlobalWorkspaceBase-335"><a href="#GlobalWorkspaceBase-335"><span class="linenos">335</span></a>
</span><span id="GlobalWorkspaceBase-336"><a href="#GlobalWorkspaceBase-336"><span class="linenos">336</span></a><span class="sd">        Returns:</span>
</span><span id="GlobalWorkspaceBase-337"><a href="#GlobalWorkspaceBase-337"><span class="linenos">337</span></a><span class="sd">            `torch.Tensor`: the loss to train on.</span>
</span><span id="GlobalWorkspaceBase-338"><a href="#GlobalWorkspaceBase-338"><span class="linenos">338</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase-339"><a href="#GlobalWorkspaceBase-339"><span class="linenos">339</span></a>        <span class="n">domain_latents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode_domains</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
</span><span id="GlobalWorkspaceBase-340"><a href="#GlobalWorkspaceBase-340"><span class="linenos">340</span></a>        <span class="n">batch_size</span> <span class="o">=</span> <span class="n">groups_batch_size</span><span class="p">(</span><span class="n">domain_latents</span><span class="p">)</span>
</span><span id="GlobalWorkspaceBase-341"><a href="#GlobalWorkspaceBase-341"><span class="linenos">341</span></a>
</span><span id="GlobalWorkspaceBase-342"><a href="#GlobalWorkspaceBase-342"><span class="linenos">342</span></a>        <span class="n">loss_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loss_mod</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">domain_latents</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
</span><span id="GlobalWorkspaceBase-343"><a href="#GlobalWorkspaceBase-343"><span class="linenos">343</span></a>
</span><span id="GlobalWorkspaceBase-344"><a href="#GlobalWorkspaceBase-344"><span class="linenos">344</span></a>        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">loss_output</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="GlobalWorkspaceBase-345"><a href="#GlobalWorkspaceBase-345"><span class="linenos">345</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
</span><span id="GlobalWorkspaceBase-346"><a href="#GlobalWorkspaceBase-346"><span class="linenos">346</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBase-347"><a href="#GlobalWorkspaceBase-347"><span class="linenos">347</span></a>                <span class="n">metric</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBase-348"><a href="#GlobalWorkspaceBase-348"><span class="linenos">348</span></a>                <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBase-349"><a href="#GlobalWorkspaceBase-349"><span class="linenos">349</span></a>                <span class="n">add_dataloader_idx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBase-350"><a href="#GlobalWorkspaceBase-350"><span class="linenos">350</span></a>            <span class="p">)</span>
</span><span id="GlobalWorkspaceBase-351"><a href="#GlobalWorkspaceBase-351"><span class="linenos">351</span></a>
</span><span id="GlobalWorkspaceBase-352"><a href="#GlobalWorkspaceBase-352"><span class="linenos">352</span></a>        <span class="k">return</span> <span class="n">loss_output</span><span class="o">.</span><span class="n">loss</span>
</span><span id="GlobalWorkspaceBase-353"><a href="#GlobalWorkspaceBase-353"><span class="linenos">353</span></a>
</span><span id="GlobalWorkspaceBase-354"><a href="#GlobalWorkspaceBase-354"><span class="linenos">354</span></a>    <span class="k">def</span> <span class="nf">validation_step</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="GlobalWorkspaceBase-355"><a href="#GlobalWorkspaceBase-355"><span class="linenos">355</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">RawDomainGroupT</span><span class="p">,</span> <span class="n">batch_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">dataloader_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="GlobalWorkspaceBase-356"><a href="#GlobalWorkspaceBase-356"><span class="linenos">356</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="GlobalWorkspaceBase-357"><a href="#GlobalWorkspaceBase-357"><span class="linenos">357</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Validation step used by lightning&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase-358"><a href="#GlobalWorkspaceBase-358"><span class="linenos">358</span></a>
</span><span id="GlobalWorkspaceBase-359"><a href="#GlobalWorkspaceBase-359"><span class="linenos">359</span></a>        <span class="n">batch</span> <span class="o">=</span> <span class="p">{</span><span class="nb">frozenset</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="n">data</span><span class="p">}</span>
</span><span id="GlobalWorkspaceBase-360"><a href="#GlobalWorkspaceBase-360"><span class="linenos">360</span></a>        <span class="k">for</span> <span class="n">domain</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="GlobalWorkspaceBase-361"><a href="#GlobalWorkspaceBase-361"><span class="linenos">361</span></a>            <span class="n">batch</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">([</span><span class="n">domain</span><span class="p">])]</span> <span class="o">=</span> <span class="p">{</span><span class="n">domain</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="n">domain</span><span class="p">]}</span>
</span><span id="GlobalWorkspaceBase-362"><a href="#GlobalWorkspaceBase-362"><span class="linenos">362</span></a>        <span class="k">if</span> <span class="n">dataloader_idx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GlobalWorkspaceBase-363"><a href="#GlobalWorkspaceBase-363"><span class="linenos">363</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_step</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;val&quot;</span><span class="p">)</span>
</span><span id="GlobalWorkspaceBase-364"><a href="#GlobalWorkspaceBase-364"><span class="linenos">364</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_step</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;val/ood&quot;</span><span class="p">)</span>
</span><span id="GlobalWorkspaceBase-365"><a href="#GlobalWorkspaceBase-365"><span class="linenos">365</span></a>
</span><span id="GlobalWorkspaceBase-366"><a href="#GlobalWorkspaceBase-366"><span class="linenos">366</span></a>    <span class="k">def</span> <span class="nf">test_step</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="GlobalWorkspaceBase-367"><a href="#GlobalWorkspaceBase-367"><span class="linenos">367</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">batch_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">dataloader_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="GlobalWorkspaceBase-368"><a href="#GlobalWorkspaceBase-368"><span class="linenos">368</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="GlobalWorkspaceBase-369"><a href="#GlobalWorkspaceBase-369"><span class="linenos">369</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Test step used by lightning&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase-370"><a href="#GlobalWorkspaceBase-370"><span class="linenos">370</span></a>
</span><span id="GlobalWorkspaceBase-371"><a href="#GlobalWorkspaceBase-371"><span class="linenos">371</span></a>        <span class="n">batch</span> <span class="o">=</span> <span class="p">{</span><span class="nb">frozenset</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="n">data</span><span class="p">}</span>
</span><span id="GlobalWorkspaceBase-372"><a href="#GlobalWorkspaceBase-372"><span class="linenos">372</span></a>        <span class="k">for</span> <span class="n">domain</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="GlobalWorkspaceBase-373"><a href="#GlobalWorkspaceBase-373"><span class="linenos">373</span></a>            <span class="n">batch</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">([</span><span class="n">domain</span><span class="p">])]</span> <span class="o">=</span> <span class="p">{</span><span class="n">domain</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="n">domain</span><span class="p">]}</span>
</span><span id="GlobalWorkspaceBase-374"><a href="#GlobalWorkspaceBase-374"><span class="linenos">374</span></a>        <span class="k">if</span> <span class="n">dataloader_idx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GlobalWorkspaceBase-375"><a href="#GlobalWorkspaceBase-375"><span class="linenos">375</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_step</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
</span><span id="GlobalWorkspaceBase-376"><a href="#GlobalWorkspaceBase-376"><span class="linenos">376</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_step</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;test/ood&quot;</span><span class="p">)</span>
</span><span id="GlobalWorkspaceBase-377"><a href="#GlobalWorkspaceBase-377"><span class="linenos">377</span></a>
</span><span id="GlobalWorkspaceBase-378"><a href="#GlobalWorkspaceBase-378"><span class="linenos">378</span></a>    <span class="k">def</span> <span class="nf">training_step</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="GlobalWorkspaceBase-379"><a href="#GlobalWorkspaceBase-379"><span class="linenos">379</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">batch_idx</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="GlobalWorkspaceBase-380"><a href="#GlobalWorkspaceBase-380"><span class="linenos">380</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="GlobalWorkspaceBase-381"><a href="#GlobalWorkspaceBase-381"><span class="linenos">381</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Training step used by lightning&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase-382"><a href="#GlobalWorkspaceBase-382"><span class="linenos">382</span></a>
</span><span id="GlobalWorkspaceBase-383"><a href="#GlobalWorkspaceBase-383"><span class="linenos">383</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_step</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">)</span>
</span><span id="GlobalWorkspaceBase-384"><a href="#GlobalWorkspaceBase-384"><span class="linenos">384</span></a>
</span><span id="GlobalWorkspaceBase-385"><a href="#GlobalWorkspaceBase-385"><span class="linenos">385</span></a>    <span class="k">def</span> <span class="nf">predict_step</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="GlobalWorkspaceBase-386"><a href="#GlobalWorkspaceBase-386"><span class="linenos">386</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">batch_idx</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="GlobalWorkspaceBase-387"><a href="#GlobalWorkspaceBase-387"><span class="linenos">387</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GWPredictionsBase</span><span class="p">:</span>
</span><span id="GlobalWorkspaceBase-388"><a href="#GlobalWorkspaceBase-388"><span class="linenos">388</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Predict step used by lightning&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase-389"><a href="#GlobalWorkspaceBase-389"><span class="linenos">389</span></a>
</span><span id="GlobalWorkspaceBase-390"><a href="#GlobalWorkspaceBase-390"><span class="linenos">390</span></a>        <span class="n">batch</span> <span class="o">=</span> <span class="p">{</span><span class="nb">frozenset</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="n">data</span><span class="p">}</span>
</span><span id="GlobalWorkspaceBase-391"><a href="#GlobalWorkspaceBase-391"><span class="linenos">391</span></a>        <span class="k">for</span> <span class="n">domain</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="GlobalWorkspaceBase-392"><a href="#GlobalWorkspaceBase-392"><span class="linenos">392</span></a>            <span class="n">batch</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">([</span><span class="n">domain</span><span class="p">])]</span> <span class="o">=</span> <span class="p">{</span><span class="n">domain</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="n">domain</span><span class="p">]}</span>
</span><span id="GlobalWorkspaceBase-393"><a href="#GlobalWorkspaceBase-393"><span class="linenos">393</span></a>
</span><span id="GlobalWorkspaceBase-394"><a href="#GlobalWorkspaceBase-394"><span class="linenos">394</span></a>        <span class="n">domain_latents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode_domains</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
</span><span id="GlobalWorkspaceBase-395"><a href="#GlobalWorkspaceBase-395"><span class="linenos">395</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">domain_latents</span><span class="p">)</span>
</span><span id="GlobalWorkspaceBase-396"><a href="#GlobalWorkspaceBase-396"><span class="linenos">396</span></a>
</span><span id="GlobalWorkspaceBase-397"><a href="#GlobalWorkspaceBase-397"><span class="linenos">397</span></a>    <span class="k">def</span> <span class="nf">configure_optimizers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OptimizerLRSchedulerConfig</span><span class="p">:</span>
</span><span id="GlobalWorkspaceBase-398"><a href="#GlobalWorkspaceBase-398"><span class="linenos">398</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase-399"><a href="#GlobalWorkspaceBase-399"><span class="linenos">399</span></a><span class="sd">        Configure models optimizers.</span>
</span><span id="GlobalWorkspaceBase-400"><a href="#GlobalWorkspaceBase-400"><span class="linenos">400</span></a>
</span><span id="GlobalWorkspaceBase-401"><a href="#GlobalWorkspaceBase-401"><span class="linenos">401</span></a><span class="sd">        Here we use `AdamW` for the optimizer and `OneCycleLR` for the learning-rate</span>
</span><span id="GlobalWorkspaceBase-402"><a href="#GlobalWorkspaceBase-402"><span class="linenos">402</span></a><span class="sd">        scheduler.</span>
</span><span id="GlobalWorkspaceBase-403"><a href="#GlobalWorkspaceBase-403"><span class="linenos">403</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase-404"><a href="#GlobalWorkspaceBase-404"><span class="linenos">404</span></a>
</span><span id="GlobalWorkspaceBase-405"><a href="#GlobalWorkspaceBase-405"><span class="linenos">405</span></a>        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">AdamW</span><span class="p">(</span>
</span><span id="GlobalWorkspaceBase-406"><a href="#GlobalWorkspaceBase-406"><span class="linenos">406</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span>
</span><span id="GlobalWorkspaceBase-407"><a href="#GlobalWorkspaceBase-407"><span class="linenos">407</span></a>            <span class="n">lr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">optim_lr</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBase-408"><a href="#GlobalWorkspaceBase-408"><span class="linenos">408</span></a>            <span class="n">weight_decay</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">optim_weight_decay</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBase-409"><a href="#GlobalWorkspaceBase-409"><span class="linenos">409</span></a>        <span class="p">)</span>
</span><span id="GlobalWorkspaceBase-410"><a href="#GlobalWorkspaceBase-410"><span class="linenos">410</span></a>
</span><span id="GlobalWorkspaceBase-411"><a href="#GlobalWorkspaceBase-411"><span class="linenos">411</span></a>        <span class="n">lr_scheduler</span> <span class="o">=</span> <span class="n">OneCycleLR</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">scheduler_args</span><span class="p">)</span>
</span><span id="GlobalWorkspaceBase-412"><a href="#GlobalWorkspaceBase-412"><span class="linenos">412</span></a>
</span><span id="GlobalWorkspaceBase-413"><a href="#GlobalWorkspaceBase-413"><span class="linenos">413</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="GlobalWorkspaceBase-414"><a href="#GlobalWorkspaceBase-414"><span class="linenos">414</span></a>            <span class="s2">&quot;optimizer&quot;</span><span class="p">:</span> <span class="n">optimizer</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBase-415"><a href="#GlobalWorkspaceBase-415"><span class="linenos">415</span></a>            <span class="s2">&quot;lr_scheduler&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="GlobalWorkspaceBase-416"><a href="#GlobalWorkspaceBase-416"><span class="linenos">416</span></a>                <span class="s2">&quot;scheduler&quot;</span><span class="p">:</span> <span class="n">lr_scheduler</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBase-417"><a href="#GlobalWorkspaceBase-417"><span class="linenos">417</span></a>                <span class="s2">&quot;interval&quot;</span><span class="p">:</span> <span class="s2">&quot;step&quot;</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBase-418"><a href="#GlobalWorkspaceBase-418"><span class="linenos">418</span></a>            <span class="p">},</span>
</span><span id="GlobalWorkspaceBase-419"><a href="#GlobalWorkspaceBase-419"><span class="linenos">419</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Global Workspace Lightning Module.</p>

<p>This is the base class to build the Global Workspace.</p>
</div>


                            <div id="GlobalWorkspaceBase.gw_mod" class="classattr">
                                <div class="attr variable">
            <span class="name">gw_mod</span>

        
    </div>
    <a class="headerlink" href="#GlobalWorkspaceBase.gw_mod"></a>
    
            <div class="docstring"><p>a <code>GWModuleBase</code> implementation.</p>
</div>


                            </div>
                            <div id="GlobalWorkspaceBase.selection_mod" class="classattr">
                                <div class="attr variable">
            <span class="name">selection_mod</span>

        
    </div>
    <a class="headerlink" href="#GlobalWorkspaceBase.selection_mod"></a>
    
            <div class="docstring"><p>A <code>SelectionBase</code> implementation.</p>
</div>


                            </div>
                            <div id="GlobalWorkspaceBase.loss_mod" class="classattr">
                                <div class="attr variable">
            <span class="name">loss_mod</span>

        
    </div>
    <a class="headerlink" href="#GlobalWorkspaceBase.loss_mod"></a>
    
            <div class="docstring"><p>The module that computes losses of the GW</p>
</div>


                            </div>
                            <div id="GlobalWorkspaceBase.optim_lr" class="classattr">
                                <div class="attr variable">
            <span class="name">optim_lr</span>

        
    </div>
    <a class="headerlink" href="#GlobalWorkspaceBase.optim_lr"></a>
    
    

                            </div>
                            <div id="GlobalWorkspaceBase.optim_weight_decay" class="classattr">
                                <div class="attr variable">
            <span class="name">optim_weight_decay</span>

        
    </div>
    <a class="headerlink" href="#GlobalWorkspaceBase.optim_weight_decay"></a>
    
    

                            </div>
                            <div id="GlobalWorkspaceBase.scheduler_args" class="classattr">
                                <div class="attr variable">
            <span class="name">scheduler_args</span>

        
    </div>
    <a class="headerlink" href="#GlobalWorkspaceBase.scheduler_args"></a>
    
    

                            </div>
                            <div id="GlobalWorkspaceBase.domain_mods" class="classattr">
                                        <input id="GlobalWorkspaceBase.domain_mods-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">domain_mods</span><span class="annotation">: collections.abc.Mapping[str, <a href="domain.html#DomainModule">shimmer.modules.domain.DomainModule</a>]</span>

                <label class="view-source-button" for="GlobalWorkspaceBase.domain_mods-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GlobalWorkspaceBase.domain_mods"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GlobalWorkspaceBase.domain_mods-130"><a href="#GlobalWorkspaceBase.domain_mods-130"><span class="linenos">130</span></a>    <span class="nd">@property</span>
</span><span id="GlobalWorkspaceBase.domain_mods-131"><a href="#GlobalWorkspaceBase.domain_mods-131"><span class="linenos">131</span></a>    <span class="k">def</span> <span class="nf">domain_mods</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DomainModule</span><span class="p">]:</span>
</span><span id="GlobalWorkspaceBase.domain_mods-132"><a href="#GlobalWorkspaceBase.domain_mods-132"><span class="linenos">132</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="o">.</span><span class="n">domain_mods</span>
</span></pre></div>


    

                            </div>
                            <div id="GlobalWorkspaceBase.workspace_dim" class="classattr">
                                        <input id="GlobalWorkspaceBase.workspace_dim-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">workspace_dim</span><span class="annotation">: int</span>

                <label class="view-source-button" for="GlobalWorkspaceBase.workspace_dim-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GlobalWorkspaceBase.workspace_dim"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GlobalWorkspaceBase.workspace_dim-134"><a href="#GlobalWorkspaceBase.workspace_dim-134"><span class="linenos">134</span></a>    <span class="nd">@property</span>
</span><span id="GlobalWorkspaceBase.workspace_dim-135"><a href="#GlobalWorkspaceBase.workspace_dim-135"><span class="linenos">135</span></a>    <span class="k">def</span> <span class="nf">workspace_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="GlobalWorkspaceBase.workspace_dim-136"><a href="#GlobalWorkspaceBase.workspace_dim-136"><span class="linenos">136</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Dimension of the GW.&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase.workspace_dim-137"><a href="#GlobalWorkspaceBase.workspace_dim-137"><span class="linenos">137</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="o">.</span><span class="n">workspace_dim</span>
</span></pre></div>


            <div class="docstring"><p>Dimension of the GW.</p>
</div>


                            </div>
                            <div id="GlobalWorkspaceBase.encode_and_fuse" class="classattr">
                                        <input id="GlobalWorkspaceBase.encode_and_fuse-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">encode_and_fuse</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">x</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]]</span>,</span><span class="param">	<span class="n">selection_module</span><span class="p">:</span> <span class="n"><a href="selection.html#SelectionBase">shimmer.modules.selection.SelectionBase</a></span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="GlobalWorkspaceBase.encode_and_fuse-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GlobalWorkspaceBase.encode_and_fuse"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GlobalWorkspaceBase.encode_and_fuse-139"><a href="#GlobalWorkspaceBase.encode_and_fuse-139"><span class="linenos">139</span></a>    <span class="k">def</span> <span class="nf">encode_and_fuse</span><span class="p">(</span>
</span><span id="GlobalWorkspaceBase.encode_and_fuse-140"><a href="#GlobalWorkspaceBase.encode_and_fuse-140"><span class="linenos">140</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">LatentsDomainGroupsT</span><span class="p">,</span> <span class="n">selection_module</span><span class="p">:</span> <span class="n">SelectionBase</span>
</span><span id="GlobalWorkspaceBase.encode_and_fuse-141"><a href="#GlobalWorkspaceBase.encode_and_fuse-141"><span class="linenos">141</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
</span><span id="GlobalWorkspaceBase.encode_and_fuse-142"><a href="#GlobalWorkspaceBase.encode_and_fuse-142"><span class="linenos">142</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase.encode_and_fuse-143"><a href="#GlobalWorkspaceBase.encode_and_fuse-143"><span class="linenos">143</span></a><span class="sd">        Encode a group of latent representations into the GW representation.</span>
</span><span id="GlobalWorkspaceBase.encode_and_fuse-144"><a href="#GlobalWorkspaceBase.encode_and_fuse-144"><span class="linenos">144</span></a>
</span><span id="GlobalWorkspaceBase.encode_and_fuse-145"><a href="#GlobalWorkspaceBase.encode_and_fuse-145"><span class="linenos">145</span></a><span class="sd">        Args:</span>
</span><span id="GlobalWorkspaceBase.encode_and_fuse-146"><a href="#GlobalWorkspaceBase.encode_and_fuse-146"><span class="linenos">146</span></a><span class="sd">            x (`LatentsDomainGroupsT`): the input domain representations.</span>
</span><span id="GlobalWorkspaceBase.encode_and_fuse-147"><a href="#GlobalWorkspaceBase.encode_and_fuse-147"><span class="linenos">147</span></a><span class="sd">            selection_scores (`Mapping[str, torch.Tensor]`):</span>
</span><span id="GlobalWorkspaceBase.encode_and_fuse-148"><a href="#GlobalWorkspaceBase.encode_and_fuse-148"><span class="linenos">148</span></a>
</span><span id="GlobalWorkspaceBase.encode_and_fuse-149"><a href="#GlobalWorkspaceBase.encode_and_fuse-149"><span class="linenos">149</span></a><span class="sd">        Returns:</span>
</span><span id="GlobalWorkspaceBase.encode_and_fuse-150"><a href="#GlobalWorkspaceBase.encode_and_fuse-150"><span class="linenos">150</span></a><span class="sd">            `dict[frozenset[str], torch.Tensor]`: the GW representations.</span>
</span><span id="GlobalWorkspaceBase.encode_and_fuse-151"><a href="#GlobalWorkspaceBase.encode_and_fuse-151"><span class="linenos">151</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase.encode_and_fuse-152"><a href="#GlobalWorkspaceBase.encode_and_fuse-152"><span class="linenos">152</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="GlobalWorkspaceBase.encode_and_fuse-153"><a href="#GlobalWorkspaceBase.encode_and_fuse-153"><span class="linenos">153</span></a>            <span class="n">domains</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="o">.</span><span class="n">encode_and_fuse</span><span class="p">(</span><span class="n">latents</span><span class="p">,</span> <span class="n">selection_module</span><span class="p">)</span>
</span><span id="GlobalWorkspaceBase.encode_and_fuse-154"><a href="#GlobalWorkspaceBase.encode_and_fuse-154"><span class="linenos">154</span></a>            <span class="k">for</span> <span class="n">domains</span><span class="p">,</span> <span class="n">latents</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="GlobalWorkspaceBase.encode_and_fuse-155"><a href="#GlobalWorkspaceBase.encode_and_fuse-155"><span class="linenos">155</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Encode a group of latent representations into the GW representation.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>x (<code>LatentsDomainGroupsT</code>):</strong>  the input domain representations.</li>
<li><strong>selection_scores (<code>Mapping[str, torch.Tensor]</code>):</strong> </li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p><code>dict[frozenset[str], torch.Tensor]</code>: the GW representations.</p>
</blockquote>
</div>


                            </div>
                            <div id="GlobalWorkspaceBase.encode" class="classattr">
                                        <input id="GlobalWorkspaceBase.encode-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">encode</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">x</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="GlobalWorkspaceBase.encode-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GlobalWorkspaceBase.encode"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GlobalWorkspaceBase.encode-157"><a href="#GlobalWorkspaceBase.encode-157"><span class="linenos">157</span></a>    <span class="k">def</span> <span class="nf">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">LatentsDomainGroupsT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LatentsDomainGroupsDT</span><span class="p">:</span>
</span><span id="GlobalWorkspaceBase.encode-158"><a href="#GlobalWorkspaceBase.encode-158"><span class="linenos">158</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase.encode-159"><a href="#GlobalWorkspaceBase.encode-159"><span class="linenos">159</span></a><span class="sd">        Encode a group of latent representations into the pre-fusion GW representation.</span>
</span><span id="GlobalWorkspaceBase.encode-160"><a href="#GlobalWorkspaceBase.encode-160"><span class="linenos">160</span></a>
</span><span id="GlobalWorkspaceBase.encode-161"><a href="#GlobalWorkspaceBase.encode-161"><span class="linenos">161</span></a><span class="sd">        Args:</span>
</span><span id="GlobalWorkspaceBase.encode-162"><a href="#GlobalWorkspaceBase.encode-162"><span class="linenos">162</span></a><span class="sd">            x (`LatentsDomainGroupsT`): the input domain representations.</span>
</span><span id="GlobalWorkspaceBase.encode-163"><a href="#GlobalWorkspaceBase.encode-163"><span class="linenos">163</span></a>
</span><span id="GlobalWorkspaceBase.encode-164"><a href="#GlobalWorkspaceBase.encode-164"><span class="linenos">164</span></a><span class="sd">        Returns:</span>
</span><span id="GlobalWorkspaceBase.encode-165"><a href="#GlobalWorkspaceBase.encode-165"><span class="linenos">165</span></a><span class="sd">            `LatensDomainGroupsDT`: the GW representations.</span>
</span><span id="GlobalWorkspaceBase.encode-166"><a href="#GlobalWorkspaceBase.encode-166"><span class="linenos">166</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase.encode-167"><a href="#GlobalWorkspaceBase.encode-167"><span class="linenos">167</span></a>        <span class="k">return</span> <span class="p">{</span><span class="n">domains</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">latents</span><span class="p">)</span> <span class="k">for</span> <span class="n">domains</span><span class="p">,</span> <span class="n">latents</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span></pre></div>


            <div class="docstring"><p>Encode a group of latent representations into the pre-fusion GW representation.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>x (<code>LatentsDomainGroupsT</code>):</strong>  the input domain representations.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p><code>LatensDomainGroupsDT</code>: the GW representations.</p>
</blockquote>
</div>


                            </div>
                            <div id="GlobalWorkspaceBase.fuse" class="classattr">
                                        <input id="GlobalWorkspaceBase.fuse-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">fuse</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">x</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]]</span>,</span><span class="param">	<span class="n">selection_scores</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="GlobalWorkspaceBase.fuse-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GlobalWorkspaceBase.fuse"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GlobalWorkspaceBase.fuse-169"><a href="#GlobalWorkspaceBase.fuse-169"><span class="linenos">169</span></a>    <span class="k">def</span> <span class="nf">fuse</span><span class="p">(</span>
</span><span id="GlobalWorkspaceBase.fuse-170"><a href="#GlobalWorkspaceBase.fuse-170"><span class="linenos">170</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBase.fuse-171"><a href="#GlobalWorkspaceBase.fuse-171"><span class="linenos">171</span></a>        <span class="n">x</span><span class="p">:</span> <span class="n">LatentsDomainGroupsT</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBase.fuse-172"><a href="#GlobalWorkspaceBase.fuse-172"><span class="linenos">172</span></a>        <span class="n">selection_scores</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]],</span>
</span><span id="GlobalWorkspaceBase.fuse-173"><a href="#GlobalWorkspaceBase.fuse-173"><span class="linenos">173</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
</span><span id="GlobalWorkspaceBase.fuse-174"><a href="#GlobalWorkspaceBase.fuse-174"><span class="linenos">174</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase.fuse-175"><a href="#GlobalWorkspaceBase.fuse-175"><span class="linenos">175</span></a><span class="sd">        Fuses a group of latent representations into the GW representation.</span>
</span><span id="GlobalWorkspaceBase.fuse-176"><a href="#GlobalWorkspaceBase.fuse-176"><span class="linenos">176</span></a>
</span><span id="GlobalWorkspaceBase.fuse-177"><a href="#GlobalWorkspaceBase.fuse-177"><span class="linenos">177</span></a><span class="sd">        Args:</span>
</span><span id="GlobalWorkspaceBase.fuse-178"><a href="#GlobalWorkspaceBase.fuse-178"><span class="linenos">178</span></a><span class="sd">            x (`LatentsDomainGroupsT`): the pre-fusion latent representations</span>
</span><span id="GlobalWorkspaceBase.fuse-179"><a href="#GlobalWorkspaceBase.fuse-179"><span class="linenos">179</span></a><span class="sd">            selection_scores (`Mapping[frozenset[str], Mapping[str, torch.Tensor]]`):</span>
</span><span id="GlobalWorkspaceBase.fuse-180"><a href="#GlobalWorkspaceBase.fuse-180"><span class="linenos">180</span></a><span class="sd">                selection scores for each group</span>
</span><span id="GlobalWorkspaceBase.fuse-181"><a href="#GlobalWorkspaceBase.fuse-181"><span class="linenos">181</span></a>
</span><span id="GlobalWorkspaceBase.fuse-182"><a href="#GlobalWorkspaceBase.fuse-182"><span class="linenos">182</span></a><span class="sd">        Returns:</span>
</span><span id="GlobalWorkspaceBase.fuse-183"><a href="#GlobalWorkspaceBase.fuse-183"><span class="linenos">183</span></a><span class="sd">            `dict[frozenset[str], torch.Tensor]`: GW representation of each group</span>
</span><span id="GlobalWorkspaceBase.fuse-184"><a href="#GlobalWorkspaceBase.fuse-184"><span class="linenos">184</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase.fuse-185"><a href="#GlobalWorkspaceBase.fuse-185"><span class="linenos">185</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="GlobalWorkspaceBase.fuse-186"><a href="#GlobalWorkspaceBase.fuse-186"><span class="linenos">186</span></a>            <span class="n">domains</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="o">.</span><span class="n">fuse</span><span class="p">(</span><span class="n">latents</span><span class="p">,</span> <span class="n">selection_scores</span><span class="p">[</span><span class="n">domains</span><span class="p">])</span>
</span><span id="GlobalWorkspaceBase.fuse-187"><a href="#GlobalWorkspaceBase.fuse-187"><span class="linenos">187</span></a>            <span class="k">for</span> <span class="n">domains</span><span class="p">,</span> <span class="n">latents</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="GlobalWorkspaceBase.fuse-188"><a href="#GlobalWorkspaceBase.fuse-188"><span class="linenos">188</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Fuses a group of latent representations into the GW representation.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>x (<code>LatentsDomainGroupsT</code>):</strong>  the pre-fusion latent representations</li>
<li><strong>selection_scores (<code>Mapping[frozenset[str], Mapping[str, torch.Tensor]]</code>):</strong>  selection scores for each group</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p><code>dict[frozenset[str], torch.Tensor]</code>: GW representation of each group</p>
</blockquote>
</div>


                            </div>
                            <div id="GlobalWorkspaceBase.decode" class="classattr">
                                        <input id="GlobalWorkspaceBase.decode-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">decode</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">z</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span>,</span><span class="param">	<span class="n">domains</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="GlobalWorkspaceBase.decode-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GlobalWorkspaceBase.decode"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GlobalWorkspaceBase.decode-190"><a href="#GlobalWorkspaceBase.decode-190"><span class="linenos">190</span></a>    <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span>
</span><span id="GlobalWorkspaceBase.decode-191"><a href="#GlobalWorkspaceBase.decode-191"><span class="linenos">191</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBase.decode-192"><a href="#GlobalWorkspaceBase.decode-192"><span class="linenos">192</span></a>        <span class="n">z</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span>
</span><span id="GlobalWorkspaceBase.decode-193"><a href="#GlobalWorkspaceBase.decode-193"><span class="linenos">193</span></a>        <span class="n">domains</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBase.decode-194"><a href="#GlobalWorkspaceBase.decode-194"><span class="linenos">194</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LatentsDomainGroupsDT</span><span class="p">:</span>
</span><span id="GlobalWorkspaceBase.decode-195"><a href="#GlobalWorkspaceBase.decode-195"><span class="linenos">195</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase.decode-196"><a href="#GlobalWorkspaceBase.decode-196"><span class="linenos">196</span></a><span class="sd">        Decode the group GW representation into given `domains`.</span>
</span><span id="GlobalWorkspaceBase.decode-197"><a href="#GlobalWorkspaceBase.decode-197"><span class="linenos">197</span></a>
</span><span id="GlobalWorkspaceBase.decode-198"><a href="#GlobalWorkspaceBase.decode-198"><span class="linenos">198</span></a><span class="sd">        Args:</span>
</span><span id="GlobalWorkspaceBase.decode-199"><a href="#GlobalWorkspaceBase.decode-199"><span class="linenos">199</span></a><span class="sd">            z (`torch.Tensor`): the GW representation.</span>
</span><span id="GlobalWorkspaceBase.decode-200"><a href="#GlobalWorkspaceBase.decode-200"><span class="linenos">200</span></a><span class="sd">            domains (`Iterable[str]`): iterable of domains to decode.</span>
</span><span id="GlobalWorkspaceBase.decode-201"><a href="#GlobalWorkspaceBase.decode-201"><span class="linenos">201</span></a>
</span><span id="GlobalWorkspaceBase.decode-202"><a href="#GlobalWorkspaceBase.decode-202"><span class="linenos">202</span></a><span class="sd">        Returns:</span>
</span><span id="GlobalWorkspaceBase.decode-203"><a href="#GlobalWorkspaceBase.decode-203"><span class="linenos">203</span></a><span class="sd">            `dict[str, torch.Tensor]`: the decoded unimodal representations.</span>
</span><span id="GlobalWorkspaceBase.decode-204"><a href="#GlobalWorkspaceBase.decode-204"><span class="linenos">204</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase.decode-205"><a href="#GlobalWorkspaceBase.decode-205"><span class="linenos">205</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="GlobalWorkspaceBase.decode-206"><a href="#GlobalWorkspaceBase.decode-206"><span class="linenos">206</span></a>            <span class="n">domain_names</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">gw_rep</span><span class="p">,</span> <span class="n">domains</span><span class="p">)</span>
</span><span id="GlobalWorkspaceBase.decode-207"><a href="#GlobalWorkspaceBase.decode-207"><span class="linenos">207</span></a>            <span class="k">for</span> <span class="n">domain_names</span><span class="p">,</span> <span class="n">gw_rep</span> <span class="ow">in</span> <span class="n">z</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="GlobalWorkspaceBase.decode-208"><a href="#GlobalWorkspaceBase.decode-208"><span class="linenos">208</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Decode the group GW representation into given <code>domains</code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>z (<code>torch.Tensor</code>):</strong>  the GW representation.</li>
<li><strong>domains (<code>Iterable[str]</code>):</strong>  iterable of domains to decode.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p><code>dict[str, torch.Tensor]</code>: the decoded unimodal representations.</p>
</blockquote>
</div>


                            </div>
                            <div id="GlobalWorkspaceBase.batch_gw_states" class="classattr">
                                        <input id="GlobalWorkspaceBase.batch_gw_states-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">batch_gw_states</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">latent_domains</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="GlobalWorkspaceBase.batch_gw_states-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GlobalWorkspaceBase.batch_gw_states"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GlobalWorkspaceBase.batch_gw_states-226"><a href="#GlobalWorkspaceBase.batch_gw_states-226"><span class="linenos">226</span></a>    <span class="k">def</span> <span class="nf">batch_gw_states</span><span class="p">(</span>
</span><span id="GlobalWorkspaceBase.batch_gw_states-227"><a href="#GlobalWorkspaceBase.batch_gw_states-227"><span class="linenos">227</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">latent_domains</span><span class="p">:</span> <span class="n">LatentsDomainGroupsT</span>
</span><span id="GlobalWorkspaceBase.batch_gw_states-228"><a href="#GlobalWorkspaceBase.batch_gw_states-228"><span class="linenos">228</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
</span><span id="GlobalWorkspaceBase.batch_gw_states-229"><a href="#GlobalWorkspaceBase.batch_gw_states-229"><span class="linenos">229</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase.batch_gw_states-230"><a href="#GlobalWorkspaceBase.batch_gw_states-230"><span class="linenos">230</span></a><span class="sd">        Comptues GW states of a batch of groups of domains.</span>
</span><span id="GlobalWorkspaceBase.batch_gw_states-231"><a href="#GlobalWorkspaceBase.batch_gw_states-231"><span class="linenos">231</span></a>
</span><span id="GlobalWorkspaceBase.batch_gw_states-232"><a href="#GlobalWorkspaceBase.batch_gw_states-232"><span class="linenos">232</span></a><span class="sd">        Args:</span>
</span><span id="GlobalWorkspaceBase.batch_gw_states-233"><a href="#GlobalWorkspaceBase.batch_gw_states-233"><span class="linenos">233</span></a><span class="sd">            latent_domains (`LatentsT`): the batch of groups of domains</span>
</span><span id="GlobalWorkspaceBase.batch_gw_states-234"><a href="#GlobalWorkspaceBase.batch_gw_states-234"><span class="linenos">234</span></a>
</span><span id="GlobalWorkspaceBase.batch_gw_states-235"><a href="#GlobalWorkspaceBase.batch_gw_states-235"><span class="linenos">235</span></a><span class="sd">        Returns:</span>
</span><span id="GlobalWorkspaceBase.batch_gw_states-236"><a href="#GlobalWorkspaceBase.batch_gw_states-236"><span class="linenos">236</span></a><span class="sd">            `dict[str, torch.Tensor]`: states for each domain.</span>
</span><span id="GlobalWorkspaceBase.batch_gw_states-237"><a href="#GlobalWorkspaceBase.batch_gw_states-237"><span class="linenos">237</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase.batch_gw_states-238"><a href="#GlobalWorkspaceBase.batch_gw_states-238"><span class="linenos">238</span></a>        <span class="n">predictions</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="GlobalWorkspaceBase.batch_gw_states-239"><a href="#GlobalWorkspaceBase.batch_gw_states-239"><span class="linenos">239</span></a>        <span class="k">for</span> <span class="n">domains</span><span class="p">,</span> <span class="n">latents</span> <span class="ow">in</span> <span class="n">latent_domains</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="GlobalWorkspaceBase.batch_gw_states-240"><a href="#GlobalWorkspaceBase.batch_gw_states-240"><span class="linenos">240</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">domains</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="GlobalWorkspaceBase.batch_gw_states-241"><a href="#GlobalWorkspaceBase.batch_gw_states-241"><span class="linenos">241</span></a>                <span class="k">continue</span>
</span><span id="GlobalWorkspaceBase.batch_gw_states-242"><a href="#GlobalWorkspaceBase.batch_gw_states-242"><span class="linenos">242</span></a>            <span class="n">domain_name</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">domains</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="GlobalWorkspaceBase.batch_gw_states-243"><a href="#GlobalWorkspaceBase.batch_gw_states-243"><span class="linenos">243</span></a>            <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="o">.</span><span class="n">encode_and_fuse</span><span class="p">(</span>
</span><span id="GlobalWorkspaceBase.batch_gw_states-244"><a href="#GlobalWorkspaceBase.batch_gw_states-244"><span class="linenos">244</span></a>                <span class="n">latents</span><span class="p">,</span> <span class="n">selection_module</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">selection_mod</span>
</span><span id="GlobalWorkspaceBase.batch_gw_states-245"><a href="#GlobalWorkspaceBase.batch_gw_states-245"><span class="linenos">245</span></a>            <span class="p">)</span>
</span><span id="GlobalWorkspaceBase.batch_gw_states-246"><a href="#GlobalWorkspaceBase.batch_gw_states-246"><span class="linenos">246</span></a>            <span class="n">predictions</span><span class="p">[</span><span class="n">domain_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span>
</span><span id="GlobalWorkspaceBase.batch_gw_states-247"><a href="#GlobalWorkspaceBase.batch_gw_states-247"><span class="linenos">247</span></a>        <span class="k">return</span> <span class="n">predictions</span>
</span></pre></div>


            <div class="docstring"><p>Comptues GW states of a batch of groups of domains.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>latent_domains (<code>LatentsT</code>):</strong>  the batch of groups of domains</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p><code>dict[str, torch.Tensor]</code>: states for each domain.</p>
</blockquote>
</div>


                            </div>
                            <div id="GlobalWorkspaceBase.encode_domain" class="classattr">
                                        <input id="GlobalWorkspaceBase.encode_domain-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">encode_domain</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">domain</span><span class="p">:</span> <span class="n">Any</span>, </span><span class="param"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>:</span></span>

                <label class="view-source-button" for="GlobalWorkspaceBase.encode_domain-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GlobalWorkspaceBase.encode_domain"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GlobalWorkspaceBase.encode_domain-249"><a href="#GlobalWorkspaceBase.encode_domain-249"><span class="linenos">249</span></a>    <span class="k">def</span> <span class="nf">encode_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="GlobalWorkspaceBase.encode_domain-250"><a href="#GlobalWorkspaceBase.encode_domain-250"><span class="linenos">250</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase.encode_domain-251"><a href="#GlobalWorkspaceBase.encode_domain-251"><span class="linenos">251</span></a><span class="sd">        Encodes a domain from the domain data into the unimodal representation.</span>
</span><span id="GlobalWorkspaceBase.encode_domain-252"><a href="#GlobalWorkspaceBase.encode_domain-252"><span class="linenos">252</span></a>
</span><span id="GlobalWorkspaceBase.encode_domain-253"><a href="#GlobalWorkspaceBase.encode_domain-253"><span class="linenos">253</span></a><span class="sd">        This is a convenient proxy for the `DomainModule.encode` method and is</span>
</span><span id="GlobalWorkspaceBase.encode_domain-254"><a href="#GlobalWorkspaceBase.encode_domain-254"><span class="linenos">254</span></a><span class="sd">        equivalent to:</span>
</span><span id="GlobalWorkspaceBase.encode_domain-255"><a href="#GlobalWorkspaceBase.encode_domain-255"><span class="linenos">255</span></a><span class="sd">        ```python</span>
</span><span id="GlobalWorkspaceBase.encode_domain-256"><a href="#GlobalWorkspaceBase.encode_domain-256"><span class="linenos">256</span></a><span class="sd">        self.domain_mods[name].encode(domain)</span>
</span><span id="GlobalWorkspaceBase.encode_domain-257"><a href="#GlobalWorkspaceBase.encode_domain-257"><span class="linenos">257</span></a><span class="sd">        ```</span>
</span><span id="GlobalWorkspaceBase.encode_domain-258"><a href="#GlobalWorkspaceBase.encode_domain-258"><span class="linenos">258</span></a>
</span><span id="GlobalWorkspaceBase.encode_domain-259"><a href="#GlobalWorkspaceBase.encode_domain-259"><span class="linenos">259</span></a><span class="sd">        Args:</span>
</span><span id="GlobalWorkspaceBase.encode_domain-260"><a href="#GlobalWorkspaceBase.encode_domain-260"><span class="linenos">260</span></a><span class="sd">            domain (`Any`): the domain data</span>
</span><span id="GlobalWorkspaceBase.encode_domain-261"><a href="#GlobalWorkspaceBase.encode_domain-261"><span class="linenos">261</span></a><span class="sd">            name (`str`): domain name to encode</span>
</span><span id="GlobalWorkspaceBase.encode_domain-262"><a href="#GlobalWorkspaceBase.encode_domain-262"><span class="linenos">262</span></a>
</span><span id="GlobalWorkspaceBase.encode_domain-263"><a href="#GlobalWorkspaceBase.encode_domain-263"><span class="linenos">263</span></a><span class="sd">        Returns:</span>
</span><span id="GlobalWorkspaceBase.encode_domain-264"><a href="#GlobalWorkspaceBase.encode_domain-264"><span class="linenos">264</span></a><span class="sd">            `torch.Tensor`: the domain&#39;s unimodal representation.</span>
</span><span id="GlobalWorkspaceBase.encode_domain-265"><a href="#GlobalWorkspaceBase.encode_domain-265"><span class="linenos">265</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase.encode_domain-266"><a href="#GlobalWorkspaceBase.encode_domain-266"><span class="linenos">266</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_mods</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Encodes a domain from the domain data into the unimodal representation.</p>

<p>This is a convenient proxy for the <code>DomainModule.encode</code> method and is
equivalent to:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="bp">self</span><span class="o">.</span><span class="n">domain_mods</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
</code></pre>
</div>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>domain (<code>Any</code>):</strong>  the domain data</li>
<li><strong>name (<code>str</code>):</strong>  domain name to encode</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p><code>torch.Tensor</code>: the domain's unimodal representation.</p>
</blockquote>
</div>


                            </div>
                            <div id="GlobalWorkspaceBase.encode_domains" class="classattr">
                                        <input id="GlobalWorkspaceBase.encode_domains-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">encode_domains</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">batch</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="GlobalWorkspaceBase.encode_domains-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GlobalWorkspaceBase.encode_domains"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GlobalWorkspaceBase.encode_domains-268"><a href="#GlobalWorkspaceBase.encode_domains-268"><span class="linenos">268</span></a>    <span class="k">def</span> <span class="nf">encode_domains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">RawDomainGroupsT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LatentsDomainGroupsDT</span><span class="p">:</span>
</span><span id="GlobalWorkspaceBase.encode_domains-269"><a href="#GlobalWorkspaceBase.encode_domains-269"><span class="linenos">269</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase.encode_domains-270"><a href="#GlobalWorkspaceBase.encode_domains-270"><span class="linenos">270</span></a><span class="sd">        Encode all domains in the batch.</span>
</span><span id="GlobalWorkspaceBase.encode_domains-271"><a href="#GlobalWorkspaceBase.encode_domains-271"><span class="linenos">271</span></a>
</span><span id="GlobalWorkspaceBase.encode_domains-272"><a href="#GlobalWorkspaceBase.encode_domains-272"><span class="linenos">272</span></a><span class="sd">        Args:</span>
</span><span id="GlobalWorkspaceBase.encode_domains-273"><a href="#GlobalWorkspaceBase.encode_domains-273"><span class="linenos">273</span></a><span class="sd">            batch (`RawDomainGroupsT`): the batch of</span>
</span><span id="GlobalWorkspaceBase.encode_domains-274"><a href="#GlobalWorkspaceBase.encode_domains-274"><span class="linenos">274</span></a><span class="sd">                domain groups with raw unimodal data to encode into groups of latent</span>
</span><span id="GlobalWorkspaceBase.encode_domains-275"><a href="#GlobalWorkspaceBase.encode_domains-275"><span class="linenos">275</span></a><span class="sd">                representations.</span>
</span><span id="GlobalWorkspaceBase.encode_domains-276"><a href="#GlobalWorkspaceBase.encode_domains-276"><span class="linenos">276</span></a>
</span><span id="GlobalWorkspaceBase.encode_domains-277"><a href="#GlobalWorkspaceBase.encode_domains-277"><span class="linenos">277</span></a><span class="sd">        Returns:</span>
</span><span id="GlobalWorkspaceBase.encode_domains-278"><a href="#GlobalWorkspaceBase.encode_domains-278"><span class="linenos">278</span></a><span class="sd">            `LatentsDomainGroupsDT`: the domains&#39; unimodal representations.</span>
</span><span id="GlobalWorkspaceBase.encode_domains-279"><a href="#GlobalWorkspaceBase.encode_domains-279"><span class="linenos">279</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase.encode_domains-280"><a href="#GlobalWorkspaceBase.encode_domains-280"><span class="linenos">280</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="GlobalWorkspaceBase.encode_domains-281"><a href="#GlobalWorkspaceBase.encode_domains-281"><span class="linenos">281</span></a>            <span class="n">domains</span><span class="p">:</span> <span class="p">{</span>
</span><span id="GlobalWorkspaceBase.encode_domains-282"><a href="#GlobalWorkspaceBase.encode_domains-282"><span class="linenos">282</span></a>                <span class="n">name</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_mods</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
</span><span id="GlobalWorkspaceBase.encode_domains-283"><a href="#GlobalWorkspaceBase.encode_domains-283"><span class="linenos">283</span></a>                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">domain</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="GlobalWorkspaceBase.encode_domains-284"><a href="#GlobalWorkspaceBase.encode_domains-284"><span class="linenos">284</span></a>            <span class="p">}</span>
</span><span id="GlobalWorkspaceBase.encode_domains-285"><a href="#GlobalWorkspaceBase.encode_domains-285"><span class="linenos">285</span></a>            <span class="k">for</span> <span class="n">domains</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">batch</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="GlobalWorkspaceBase.encode_domains-286"><a href="#GlobalWorkspaceBase.encode_domains-286"><span class="linenos">286</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Encode all domains in the batch.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>batch (<code>RawDomainGroupsT</code>):</strong>  the batch of
domain groups with raw unimodal data to encode into groups of latent
representations.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p><code>LatentsDomainGroupsDT</code>: the domains' unimodal representations.</p>
</blockquote>
</div>


                            </div>
                            <div id="GlobalWorkspaceBase.decode_domain" class="classattr">
                                        <input id="GlobalWorkspaceBase.decode_domain-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">decode_domain</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">domain</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>, </span><span class="param"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="GlobalWorkspaceBase.decode_domain-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GlobalWorkspaceBase.decode_domain"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GlobalWorkspaceBase.decode_domain-288"><a href="#GlobalWorkspaceBase.decode_domain-288"><span class="linenos">288</span></a>    <span class="k">def</span> <span class="nf">decode_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="GlobalWorkspaceBase.decode_domain-289"><a href="#GlobalWorkspaceBase.decode_domain-289"><span class="linenos">289</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase.decode_domain-290"><a href="#GlobalWorkspaceBase.decode_domain-290"><span class="linenos">290</span></a><span class="sd">        Decodes a domain from the unimodal representation into the domain data.</span>
</span><span id="GlobalWorkspaceBase.decode_domain-291"><a href="#GlobalWorkspaceBase.decode_domain-291"><span class="linenos">291</span></a>
</span><span id="GlobalWorkspaceBase.decode_domain-292"><a href="#GlobalWorkspaceBase.decode_domain-292"><span class="linenos">292</span></a><span class="sd">        This is a convenient proxy for the `DomainModule.encode` method and is</span>
</span><span id="GlobalWorkspaceBase.decode_domain-293"><a href="#GlobalWorkspaceBase.decode_domain-293"><span class="linenos">293</span></a><span class="sd">        equivalent to:</span>
</span><span id="GlobalWorkspaceBase.decode_domain-294"><a href="#GlobalWorkspaceBase.decode_domain-294"><span class="linenos">294</span></a><span class="sd">        ```python</span>
</span><span id="GlobalWorkspaceBase.decode_domain-295"><a href="#GlobalWorkspaceBase.decode_domain-295"><span class="linenos">295</span></a><span class="sd">        self.domain_mods[name].decode(domain)</span>
</span><span id="GlobalWorkspaceBase.decode_domain-296"><a href="#GlobalWorkspaceBase.decode_domain-296"><span class="linenos">296</span></a><span class="sd">        ```</span>
</span><span id="GlobalWorkspaceBase.decode_domain-297"><a href="#GlobalWorkspaceBase.decode_domain-297"><span class="linenos">297</span></a>
</span><span id="GlobalWorkspaceBase.decode_domain-298"><a href="#GlobalWorkspaceBase.decode_domain-298"><span class="linenos">298</span></a><span class="sd">        Args:</span>
</span><span id="GlobalWorkspaceBase.decode_domain-299"><a href="#GlobalWorkspaceBase.decode_domain-299"><span class="linenos">299</span></a><span class="sd">            domain (`torch.Tensor`): the domain data</span>
</span><span id="GlobalWorkspaceBase.decode_domain-300"><a href="#GlobalWorkspaceBase.decode_domain-300"><span class="linenos">300</span></a><span class="sd">            name (`str`): domain name to encode</span>
</span><span id="GlobalWorkspaceBase.decode_domain-301"><a href="#GlobalWorkspaceBase.decode_domain-301"><span class="linenos">301</span></a>
</span><span id="GlobalWorkspaceBase.decode_domain-302"><a href="#GlobalWorkspaceBase.decode_domain-302"><span class="linenos">302</span></a><span class="sd">        Returns:</span>
</span><span id="GlobalWorkspaceBase.decode_domain-303"><a href="#GlobalWorkspaceBase.decode_domain-303"><span class="linenos">303</span></a><span class="sd">            `Any`: the domain&#39;s raw data.</span>
</span><span id="GlobalWorkspaceBase.decode_domain-304"><a href="#GlobalWorkspaceBase.decode_domain-304"><span class="linenos">304</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase.decode_domain-305"><a href="#GlobalWorkspaceBase.decode_domain-305"><span class="linenos">305</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_mods</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Decodes a domain from the unimodal representation into the domain data.</p>

<p>This is a convenient proxy for the <code>DomainModule.encode</code> method and is
equivalent to:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="bp">self</span><span class="o">.</span><span class="n">domain_mods</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
</code></pre>
</div>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>domain (<code>torch.Tensor</code>):</strong>  the domain data</li>
<li><strong>name (<code>str</code>):</strong>  domain name to encode</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p><code>Any</code>: the domain's raw data.</p>
</blockquote>
</div>


                            </div>
                            <div id="GlobalWorkspaceBase.decode_domains" class="classattr">
                                        <input id="GlobalWorkspaceBase.decode_domains-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">decode_domains</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">latents_domain</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="GlobalWorkspaceBase.decode_domains-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GlobalWorkspaceBase.decode_domains"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GlobalWorkspaceBase.decode_domains-307"><a href="#GlobalWorkspaceBase.decode_domains-307"><span class="linenos">307</span></a>    <span class="k">def</span> <span class="nf">decode_domains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">latents_domain</span><span class="p">:</span> <span class="n">LatentsDomainGroupsT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RawDomainGroupsDT</span><span class="p">:</span>
</span><span id="GlobalWorkspaceBase.decode_domains-308"><a href="#GlobalWorkspaceBase.decode_domains-308"><span class="linenos">308</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase.decode_domains-309"><a href="#GlobalWorkspaceBase.decode_domains-309"><span class="linenos">309</span></a><span class="sd">        Decodes all domains in the batch.</span>
</span><span id="GlobalWorkspaceBase.decode_domains-310"><a href="#GlobalWorkspaceBase.decode_domains-310"><span class="linenos">310</span></a>
</span><span id="GlobalWorkspaceBase.decode_domains-311"><a href="#GlobalWorkspaceBase.decode_domains-311"><span class="linenos">311</span></a><span class="sd">        Args:</span>
</span><span id="GlobalWorkspaceBase.decode_domains-312"><a href="#GlobalWorkspaceBase.decode_domains-312"><span class="linenos">312</span></a><span class="sd">            batch (`LatentsDomainGroupsT`): the batch of</span>
</span><span id="GlobalWorkspaceBase.decode_domains-313"><a href="#GlobalWorkspaceBase.decode_domains-313"><span class="linenos">313</span></a><span class="sd">                domain groups with unimodal latent representation to decode into</span>
</span><span id="GlobalWorkspaceBase.decode_domains-314"><a href="#GlobalWorkspaceBase.decode_domains-314"><span class="linenos">314</span></a><span class="sd">                groups of raw data.</span>
</span><span id="GlobalWorkspaceBase.decode_domains-315"><a href="#GlobalWorkspaceBase.decode_domains-315"><span class="linenos">315</span></a>
</span><span id="GlobalWorkspaceBase.decode_domains-316"><a href="#GlobalWorkspaceBase.decode_domains-316"><span class="linenos">316</span></a><span class="sd">        Returns:</span>
</span><span id="GlobalWorkspaceBase.decode_domains-317"><a href="#GlobalWorkspaceBase.decode_domains-317"><span class="linenos">317</span></a><span class="sd">            `LatentsDomainGroupsDT`: the domains&#39; raw data.</span>
</span><span id="GlobalWorkspaceBase.decode_domains-318"><a href="#GlobalWorkspaceBase.decode_domains-318"><span class="linenos">318</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase.decode_domains-319"><a href="#GlobalWorkspaceBase.decode_domains-319"><span class="linenos">319</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="GlobalWorkspaceBase.decode_domains-320"><a href="#GlobalWorkspaceBase.decode_domains-320"><span class="linenos">320</span></a>            <span class="n">domains</span><span class="p">:</span> <span class="p">{</span>
</span><span id="GlobalWorkspaceBase.decode_domains-321"><a href="#GlobalWorkspaceBase.decode_domains-321"><span class="linenos">321</span></a>                <span class="n">name</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_mods</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
</span><span id="GlobalWorkspaceBase.decode_domains-322"><a href="#GlobalWorkspaceBase.decode_domains-322"><span class="linenos">322</span></a>                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">domain</span> <span class="ow">in</span> <span class="n">latents</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="GlobalWorkspaceBase.decode_domains-323"><a href="#GlobalWorkspaceBase.decode_domains-323"><span class="linenos">323</span></a>            <span class="p">}</span>
</span><span id="GlobalWorkspaceBase.decode_domains-324"><a href="#GlobalWorkspaceBase.decode_domains-324"><span class="linenos">324</span></a>            <span class="k">for</span> <span class="n">domains</span><span class="p">,</span> <span class="n">latents</span> <span class="ow">in</span> <span class="n">latents_domain</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="GlobalWorkspaceBase.decode_domains-325"><a href="#GlobalWorkspaceBase.decode_domains-325"><span class="linenos">325</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Decodes all domains in the batch.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>batch (<code>LatentsDomainGroupsT</code>):</strong>  the batch of
domain groups with unimodal latent representation to decode into
groups of raw data.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p><code>LatentsDomainGroupsDT</code>: the domains' raw data.</p>
</blockquote>
</div>


                            </div>
                            <div id="GlobalWorkspaceBase.generic_step" class="classattr">
                                        <input id="GlobalWorkspaceBase.generic_step-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">generic_step</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">batch</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]]</span>,</span><span class="param">	<span class="n">mode</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;val/ood&#39;</span><span class="p">,</span> <span class="s1">&#39;test/ood&#39;</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>:</span></span>

                <label class="view-source-button" for="GlobalWorkspaceBase.generic_step-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GlobalWorkspaceBase.generic_step"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GlobalWorkspaceBase.generic_step-327"><a href="#GlobalWorkspaceBase.generic_step-327"><span class="linenos">327</span></a>    <span class="k">def</span> <span class="nf">generic_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">RawDomainGroupsT</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="n">ModelModeT</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="GlobalWorkspaceBase.generic_step-328"><a href="#GlobalWorkspaceBase.generic_step-328"><span class="linenos">328</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase.generic_step-329"><a href="#GlobalWorkspaceBase.generic_step-329"><span class="linenos">329</span></a><span class="sd">        The generic step used in `training_step`, `validation_step` and</span>
</span><span id="GlobalWorkspaceBase.generic_step-330"><a href="#GlobalWorkspaceBase.generic_step-330"><span class="linenos">330</span></a><span class="sd">        `test_step`.</span>
</span><span id="GlobalWorkspaceBase.generic_step-331"><a href="#GlobalWorkspaceBase.generic_step-331"><span class="linenos">331</span></a>
</span><span id="GlobalWorkspaceBase.generic_step-332"><a href="#GlobalWorkspaceBase.generic_step-332"><span class="linenos">332</span></a><span class="sd">        Args:</span>
</span><span id="GlobalWorkspaceBase.generic_step-333"><a href="#GlobalWorkspaceBase.generic_step-333"><span class="linenos">333</span></a><span class="sd">            batch (`RawDomainGroupsT`): the batch of groups of raw unimodal data.</span>
</span><span id="GlobalWorkspaceBase.generic_step-334"><a href="#GlobalWorkspaceBase.generic_step-334"><span class="linenos">334</span></a><span class="sd">            mode (`ModelModeT`):</span>
</span><span id="GlobalWorkspaceBase.generic_step-335"><a href="#GlobalWorkspaceBase.generic_step-335"><span class="linenos">335</span></a>
</span><span id="GlobalWorkspaceBase.generic_step-336"><a href="#GlobalWorkspaceBase.generic_step-336"><span class="linenos">336</span></a><span class="sd">        Returns:</span>
</span><span id="GlobalWorkspaceBase.generic_step-337"><a href="#GlobalWorkspaceBase.generic_step-337"><span class="linenos">337</span></a><span class="sd">            `torch.Tensor`: the loss to train on.</span>
</span><span id="GlobalWorkspaceBase.generic_step-338"><a href="#GlobalWorkspaceBase.generic_step-338"><span class="linenos">338</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBase.generic_step-339"><a href="#GlobalWorkspaceBase.generic_step-339"><span class="linenos">339</span></a>        <span class="n">domain_latents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode_domains</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
</span><span id="GlobalWorkspaceBase.generic_step-340"><a href="#GlobalWorkspaceBase.generic_step-340"><span class="linenos">340</span></a>        <span class="n">batch_size</span> <span class="o">=</span> <span class="n">groups_batch_size</span><span class="p">(</span><span class="n">domain_latents</span><span class="p">)</span>
</span><span id="GlobalWorkspaceBase.generic_step-341"><a href="#GlobalWorkspaceBase.generic_step-341"><span class="linenos">341</span></a>
</span><span id="GlobalWorkspaceBase.generic_step-342"><a href="#GlobalWorkspaceBase.generic_step-342"><span class="linenos">342</span></a>        <span class="n">loss_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loss_mod</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">domain_latents</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
</span><span id="GlobalWorkspaceBase.generic_step-343"><a href="#GlobalWorkspaceBase.generic_step-343"><span class="linenos">343</span></a>
</span><span id="GlobalWorkspaceBase.generic_step-344"><a href="#GlobalWorkspaceBase.generic_step-344"><span class="linenos">344</span></a>        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">loss_output</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="GlobalWorkspaceBase.generic_step-345"><a href="#GlobalWorkspaceBase.generic_step-345"><span class="linenos">345</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
</span><span id="GlobalWorkspaceBase.generic_step-346"><a href="#GlobalWorkspaceBase.generic_step-346"><span class="linenos">346</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBase.generic_step-347"><a href="#GlobalWorkspaceBase.generic_step-347"><span class="linenos">347</span></a>                <span class="n">metric</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBase.generic_step-348"><a href="#GlobalWorkspaceBase.generic_step-348"><span class="linenos">348</span></a>                <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBase.generic_step-349"><a href="#GlobalWorkspaceBase.generic_step-349"><span class="linenos">349</span></a>                <span class="n">add_dataloader_idx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBase.generic_step-350"><a href="#GlobalWorkspaceBase.generic_step-350"><span class="linenos">350</span></a>            <span class="p">)</span>
</span><span id="GlobalWorkspaceBase.generic_step-351"><a href="#GlobalWorkspaceBase.generic_step-351"><span class="linenos">351</span></a>
</span><span id="GlobalWorkspaceBase.generic_step-352"><a href="#GlobalWorkspaceBase.generic_step-352"><span class="linenos">352</span></a>        <span class="k">return</span> <span class="n">loss_output</span><span class="o">.</span><span class="n">loss</span>
</span></pre></div>


            <div class="docstring"><p>The generic step used in <code><a href="#GlobalWorkspaceBase.training_step">training_step</a></code>, <code><a href="#GlobalWorkspaceBase.validation_step">validation_step</a></code> and
<code><a href="#GlobalWorkspaceBase.test_step">test_step</a></code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>batch (<code>RawDomainGroupsT</code>):</strong>  the batch of groups of raw unimodal data.</li>
<li><strong>mode (<code>ModelModeT</code>):</strong> </li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p><code>torch.Tensor</code>: the loss to train on.</p>
</blockquote>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>lightning.pytorch.core.module.LightningModule</dt>
                                <dd id="GlobalWorkspaceBase.__init__" class="function">LightningModule</dd>
                <dd id="GlobalWorkspaceBase.CHECKPOINT_HYPER_PARAMS_KEY" class="variable">CHECKPOINT_HYPER_PARAMS_KEY</dd>
                <dd id="GlobalWorkspaceBase.CHECKPOINT_HYPER_PARAMS_NAME" class="variable">CHECKPOINT_HYPER_PARAMS_NAME</dd>
                <dd id="GlobalWorkspaceBase.CHECKPOINT_HYPER_PARAMS_TYPE" class="variable">CHECKPOINT_HYPER_PARAMS_TYPE</dd>
                <dd id="GlobalWorkspaceBase.optimizers" class="function">optimizers</dd>
                <dd id="GlobalWorkspaceBase.lr_schedulers" class="function">lr_schedulers</dd>
                <dd id="GlobalWorkspaceBase.trainer" class="variable">trainer</dd>
                <dd id="GlobalWorkspaceBase.fabric" class="variable">fabric</dd>
                <dd id="GlobalWorkspaceBase.example_input_array" class="variable">example_input_array</dd>
                <dd id="GlobalWorkspaceBase.current_epoch" class="variable">current_epoch</dd>
                <dd id="GlobalWorkspaceBase.global_step" class="variable">global_step</dd>
                <dd id="GlobalWorkspaceBase.global_rank" class="variable">global_rank</dd>
                <dd id="GlobalWorkspaceBase.local_rank" class="variable">local_rank</dd>
                <dd id="GlobalWorkspaceBase.on_gpu" class="variable">on_gpu</dd>
                <dd id="GlobalWorkspaceBase.automatic_optimization" class="variable">automatic_optimization</dd>
                <dd id="GlobalWorkspaceBase.strict_loading" class="variable">strict_loading</dd>
                <dd id="GlobalWorkspaceBase.logger" class="variable">logger</dd>
                <dd id="GlobalWorkspaceBase.loggers" class="variable">loggers</dd>
                <dd id="GlobalWorkspaceBase.print" class="function">print</dd>
                <dd id="GlobalWorkspaceBase.log" class="function">log</dd>
                <dd id="GlobalWorkspaceBase.log_dict" class="function">log_dict</dd>
                <dd id="GlobalWorkspaceBase.all_gather" class="function">all_gather</dd>
                <dd id="GlobalWorkspaceBase.forward" class="function">forward</dd>
                <dd id="GlobalWorkspaceBase.training_step" class="function">training_step</dd>
                <dd id="GlobalWorkspaceBase.validation_step" class="function">validation_step</dd>
                <dd id="GlobalWorkspaceBase.test_step" class="function">test_step</dd>
                <dd id="GlobalWorkspaceBase.predict_step" class="function">predict_step</dd>
                <dd id="GlobalWorkspaceBase.configure_callbacks" class="function">configure_callbacks</dd>
                <dd id="GlobalWorkspaceBase.configure_optimizers" class="function">configure_optimizers</dd>
                <dd id="GlobalWorkspaceBase.manual_backward" class="function">manual_backward</dd>
                <dd id="GlobalWorkspaceBase.backward" class="function">backward</dd>
                <dd id="GlobalWorkspaceBase.toggle_optimizer" class="function">toggle_optimizer</dd>
                <dd id="GlobalWorkspaceBase.untoggle_optimizer" class="function">untoggle_optimizer</dd>
                <dd id="GlobalWorkspaceBase.clip_gradients" class="function">clip_gradients</dd>
                <dd id="GlobalWorkspaceBase.configure_gradient_clipping" class="function">configure_gradient_clipping</dd>
                <dd id="GlobalWorkspaceBase.lr_scheduler_step" class="function">lr_scheduler_step</dd>
                <dd id="GlobalWorkspaceBase.optimizer_step" class="function">optimizer_step</dd>
                <dd id="GlobalWorkspaceBase.optimizer_zero_grad" class="function">optimizer_zero_grad</dd>
                <dd id="GlobalWorkspaceBase.freeze" class="function">freeze</dd>
                <dd id="GlobalWorkspaceBase.unfreeze" class="function">unfreeze</dd>
                <dd id="GlobalWorkspaceBase.to_onnx" class="function">to_onnx</dd>
                <dd id="GlobalWorkspaceBase.to_torchscript" class="function">to_torchscript</dd>
                <dd id="GlobalWorkspaceBase.load_from_checkpoint" class="function">load_from_checkpoint</dd>

            </div>
            <div><dt>lightning.fabric.utilities.device_dtype_mixin._DeviceDtypeModuleMixin</dt>
                                <dd id="GlobalWorkspaceBase.dtype" class="variable">dtype</dd>
                <dd id="GlobalWorkspaceBase.device" class="variable">device</dd>
                <dd id="GlobalWorkspaceBase.to" class="function">to</dd>
                <dd id="GlobalWorkspaceBase.cuda" class="function">cuda</dd>
                <dd id="GlobalWorkspaceBase.cpu" class="function">cpu</dd>
                <dd id="GlobalWorkspaceBase.type" class="function">type</dd>
                <dd id="GlobalWorkspaceBase.float" class="function">float</dd>
                <dd id="GlobalWorkspaceBase.double" class="function">double</dd>
                <dd id="GlobalWorkspaceBase.half" class="function">half</dd>

            </div>
            <div><dt>lightning.pytorch.core.mixins.hparams_mixin.HyperparametersMixin</dt>
                                <dd id="GlobalWorkspaceBase.save_hyperparameters" class="function">save_hyperparameters</dd>
                <dd id="GlobalWorkspaceBase.hparams" class="variable">hparams</dd>
                <dd id="GlobalWorkspaceBase.hparams_initial" class="variable">hparams_initial</dd>

            </div>
            <div><dt>lightning.pytorch.core.hooks.ModelHooks</dt>
                                <dd id="GlobalWorkspaceBase.on_fit_start" class="function">on_fit_start</dd>
                <dd id="GlobalWorkspaceBase.on_fit_end" class="function">on_fit_end</dd>
                <dd id="GlobalWorkspaceBase.on_train_start" class="function">on_train_start</dd>
                <dd id="GlobalWorkspaceBase.on_train_end" class="function">on_train_end</dd>
                <dd id="GlobalWorkspaceBase.on_validation_start" class="function">on_validation_start</dd>
                <dd id="GlobalWorkspaceBase.on_validation_end" class="function">on_validation_end</dd>
                <dd id="GlobalWorkspaceBase.on_test_start" class="function">on_test_start</dd>
                <dd id="GlobalWorkspaceBase.on_test_end" class="function">on_test_end</dd>
                <dd id="GlobalWorkspaceBase.on_predict_start" class="function">on_predict_start</dd>
                <dd id="GlobalWorkspaceBase.on_predict_end" class="function">on_predict_end</dd>
                <dd id="GlobalWorkspaceBase.on_train_batch_start" class="function">on_train_batch_start</dd>
                <dd id="GlobalWorkspaceBase.on_train_batch_end" class="function">on_train_batch_end</dd>
                <dd id="GlobalWorkspaceBase.on_validation_batch_start" class="function">on_validation_batch_start</dd>
                <dd id="GlobalWorkspaceBase.on_validation_batch_end" class="function">on_validation_batch_end</dd>
                <dd id="GlobalWorkspaceBase.on_test_batch_start" class="function">on_test_batch_start</dd>
                <dd id="GlobalWorkspaceBase.on_test_batch_end" class="function">on_test_batch_end</dd>
                <dd id="GlobalWorkspaceBase.on_predict_batch_start" class="function">on_predict_batch_start</dd>
                <dd id="GlobalWorkspaceBase.on_predict_batch_end" class="function">on_predict_batch_end</dd>
                <dd id="GlobalWorkspaceBase.on_validation_model_zero_grad" class="function">on_validation_model_zero_grad</dd>
                <dd id="GlobalWorkspaceBase.on_validation_model_eval" class="function">on_validation_model_eval</dd>
                <dd id="GlobalWorkspaceBase.on_validation_model_train" class="function">on_validation_model_train</dd>
                <dd id="GlobalWorkspaceBase.on_test_model_eval" class="function">on_test_model_eval</dd>
                <dd id="GlobalWorkspaceBase.on_test_model_train" class="function">on_test_model_train</dd>
                <dd id="GlobalWorkspaceBase.on_predict_model_eval" class="function">on_predict_model_eval</dd>
                <dd id="GlobalWorkspaceBase.on_train_epoch_start" class="function">on_train_epoch_start</dd>
                <dd id="GlobalWorkspaceBase.on_train_epoch_end" class="function">on_train_epoch_end</dd>
                <dd id="GlobalWorkspaceBase.on_validation_epoch_start" class="function">on_validation_epoch_start</dd>
                <dd id="GlobalWorkspaceBase.on_validation_epoch_end" class="function">on_validation_epoch_end</dd>
                <dd id="GlobalWorkspaceBase.on_test_epoch_start" class="function">on_test_epoch_start</dd>
                <dd id="GlobalWorkspaceBase.on_test_epoch_end" class="function">on_test_epoch_end</dd>
                <dd id="GlobalWorkspaceBase.on_predict_epoch_start" class="function">on_predict_epoch_start</dd>
                <dd id="GlobalWorkspaceBase.on_predict_epoch_end" class="function">on_predict_epoch_end</dd>
                <dd id="GlobalWorkspaceBase.on_before_zero_grad" class="function">on_before_zero_grad</dd>
                <dd id="GlobalWorkspaceBase.on_before_backward" class="function">on_before_backward</dd>
                <dd id="GlobalWorkspaceBase.on_after_backward" class="function">on_after_backward</dd>
                <dd id="GlobalWorkspaceBase.on_before_optimizer_step" class="function">on_before_optimizer_step</dd>
                <dd id="GlobalWorkspaceBase.configure_sharded_model" class="function">configure_sharded_model</dd>
                <dd id="GlobalWorkspaceBase.configure_model" class="function">configure_model</dd>

            </div>
            <div><dt>lightning.pytorch.core.hooks.DataHooks</dt>
                                <dd id="GlobalWorkspaceBase.prepare_data_per_node" class="variable">prepare_data_per_node</dd>
                <dd id="GlobalWorkspaceBase.allow_zero_length_dataloader_with_multiple_devices" class="variable">allow_zero_length_dataloader_with_multiple_devices</dd>
                <dd id="GlobalWorkspaceBase.prepare_data" class="function">prepare_data</dd>
                <dd id="GlobalWorkspaceBase.setup" class="function">setup</dd>
                <dd id="GlobalWorkspaceBase.teardown" class="function">teardown</dd>
                <dd id="GlobalWorkspaceBase.train_dataloader" class="function">train_dataloader</dd>
                <dd id="GlobalWorkspaceBase.test_dataloader" class="function">test_dataloader</dd>
                <dd id="GlobalWorkspaceBase.val_dataloader" class="function">val_dataloader</dd>
                <dd id="GlobalWorkspaceBase.predict_dataloader" class="function">predict_dataloader</dd>
                <dd id="GlobalWorkspaceBase.transfer_batch_to_device" class="function">transfer_batch_to_device</dd>
                <dd id="GlobalWorkspaceBase.on_before_batch_transfer" class="function">on_before_batch_transfer</dd>
                <dd id="GlobalWorkspaceBase.on_after_batch_transfer" class="function">on_after_batch_transfer</dd>

            </div>
            <div><dt>lightning.pytorch.core.hooks.CheckpointHooks</dt>
                                <dd id="GlobalWorkspaceBase.on_load_checkpoint" class="function">on_load_checkpoint</dd>
                <dd id="GlobalWorkspaceBase.on_save_checkpoint" class="function">on_save_checkpoint</dd>

            </div>
            <div><dt>torch.nn.modules.module.Module</dt>
                                <dd id="GlobalWorkspaceBase.dump_patches" class="variable">dump_patches</dd>
                <dd id="GlobalWorkspaceBase.training" class="variable">training</dd>
                <dd id="GlobalWorkspaceBase.call_super_init" class="variable">call_super_init</dd>
                <dd id="GlobalWorkspaceBase.register_buffer" class="function">register_buffer</dd>
                <dd id="GlobalWorkspaceBase.register_parameter" class="function">register_parameter</dd>
                <dd id="GlobalWorkspaceBase.add_module" class="function">add_module</dd>
                <dd id="GlobalWorkspaceBase.register_module" class="function">register_module</dd>
                <dd id="GlobalWorkspaceBase.get_submodule" class="function">get_submodule</dd>
                <dd id="GlobalWorkspaceBase.get_parameter" class="function">get_parameter</dd>
                <dd id="GlobalWorkspaceBase.get_buffer" class="function">get_buffer</dd>
                <dd id="GlobalWorkspaceBase.get_extra_state" class="function">get_extra_state</dd>
                <dd id="GlobalWorkspaceBase.set_extra_state" class="function">set_extra_state</dd>
                <dd id="GlobalWorkspaceBase.apply" class="function">apply</dd>
                <dd id="GlobalWorkspaceBase.ipu" class="function">ipu</dd>
                <dd id="GlobalWorkspaceBase.xpu" class="function">xpu</dd>
                <dd id="GlobalWorkspaceBase.bfloat16" class="function">bfloat16</dd>
                <dd id="GlobalWorkspaceBase.to_empty" class="function">to_empty</dd>
                <dd id="GlobalWorkspaceBase.register_full_backward_pre_hook" class="function">register_full_backward_pre_hook</dd>
                <dd id="GlobalWorkspaceBase.register_backward_hook" class="function">register_backward_hook</dd>
                <dd id="GlobalWorkspaceBase.register_full_backward_hook" class="function">register_full_backward_hook</dd>
                <dd id="GlobalWorkspaceBase.register_forward_pre_hook" class="function">register_forward_pre_hook</dd>
                <dd id="GlobalWorkspaceBase.register_forward_hook" class="function">register_forward_hook</dd>
                <dd id="GlobalWorkspaceBase.register_state_dict_pre_hook" class="function">register_state_dict_pre_hook</dd>
                <dd id="GlobalWorkspaceBase.state_dict" class="function">state_dict</dd>
                <dd id="GlobalWorkspaceBase.register_load_state_dict_post_hook" class="function">register_load_state_dict_post_hook</dd>
                <dd id="GlobalWorkspaceBase.load_state_dict" class="function">load_state_dict</dd>
                <dd id="GlobalWorkspaceBase.parameters" class="function">parameters</dd>
                <dd id="GlobalWorkspaceBase.named_parameters" class="function">named_parameters</dd>
                <dd id="GlobalWorkspaceBase.buffers" class="function">buffers</dd>
                <dd id="GlobalWorkspaceBase.named_buffers" class="function">named_buffers</dd>
                <dd id="GlobalWorkspaceBase.children" class="function">children</dd>
                <dd id="GlobalWorkspaceBase.named_children" class="function">named_children</dd>
                <dd id="GlobalWorkspaceBase.modules" class="function">modules</dd>
                <dd id="GlobalWorkspaceBase.named_modules" class="function">named_modules</dd>
                <dd id="GlobalWorkspaceBase.train" class="function">train</dd>
                <dd id="GlobalWorkspaceBase.eval" class="function">eval</dd>
                <dd id="GlobalWorkspaceBase.requires_grad_" class="function">requires_grad_</dd>
                <dd id="GlobalWorkspaceBase.zero_grad" class="function">zero_grad</dd>
                <dd id="GlobalWorkspaceBase.share_memory" class="function">share_memory</dd>
                <dd id="GlobalWorkspaceBase.extra_repr" class="function">extra_repr</dd>
                <dd id="GlobalWorkspaceBase.compile" class="function">compile</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="freeze_domain_modules">
                            <input id="freeze_domain_modules-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">freeze_domain_modules</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">domain_mods</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><a href="domain.html#DomainModule">shimmer.modules.domain.DomainModule</a></span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><a href="domain.html#DomainModule">shimmer.modules.domain.DomainModule</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="freeze_domain_modules-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#freeze_domain_modules"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="freeze_domain_modules-422"><a href="#freeze_domain_modules-422"><span class="linenos">422</span></a><span class="k">def</span> <span class="nf">freeze_domain_modules</span><span class="p">(</span>
</span><span id="freeze_domain_modules-423"><a href="#freeze_domain_modules-423"><span class="linenos">423</span></a>    <span class="n">domain_mods</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DomainModule</span><span class="p">],</span>
</span><span id="freeze_domain_modules-424"><a href="#freeze_domain_modules-424"><span class="linenos">424</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DomainModule</span><span class="p">]:</span>
</span><span id="freeze_domain_modules-425"><a href="#freeze_domain_modules-425"><span class="linenos">425</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="freeze_domain_modules-426"><a href="#freeze_domain_modules-426"><span class="linenos">426</span></a><span class="sd">    Freezes weights and set to eval mode the domain modules.</span>
</span><span id="freeze_domain_modules-427"><a href="#freeze_domain_modules-427"><span class="linenos">427</span></a>
</span><span id="freeze_domain_modules-428"><a href="#freeze_domain_modules-428"><span class="linenos">428</span></a><span class="sd">    .. note::</span>
</span><span id="freeze_domain_modules-429"><a href="#freeze_domain_modules-429"><span class="linenos">429</span></a><span class="sd">        The output is casted as `dict[str, DomainModule]` type for better</span>
</span><span id="freeze_domain_modules-430"><a href="#freeze_domain_modules-430"><span class="linenos">430</span></a><span class="sd">        auto-completion, but is actually a torch `ModuleDict`.</span>
</span><span id="freeze_domain_modules-431"><a href="#freeze_domain_modules-431"><span class="linenos">431</span></a>
</span><span id="freeze_domain_modules-432"><a href="#freeze_domain_modules-432"><span class="linenos">432</span></a><span class="sd">    Args:</span>
</span><span id="freeze_domain_modules-433"><a href="#freeze_domain_modules-433"><span class="linenos">433</span></a><span class="sd">        domain_mods (`Mapping[str, DomainModule]`): mapping of domain modules to freeze</span>
</span><span id="freeze_domain_modules-434"><a href="#freeze_domain_modules-434"><span class="linenos">434</span></a>
</span><span id="freeze_domain_modules-435"><a href="#freeze_domain_modules-435"><span class="linenos">435</span></a><span class="sd">    Returns:</span>
</span><span id="freeze_domain_modules-436"><a href="#freeze_domain_modules-436"><span class="linenos">436</span></a><span class="sd">        `ModuleDict`: frozen modules.</span>
</span><span id="freeze_domain_modules-437"><a href="#freeze_domain_modules-437"><span class="linenos">437</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="freeze_domain_modules-438"><a href="#freeze_domain_modules-438"><span class="linenos">438</span></a>
</span><span id="freeze_domain_modules-439"><a href="#freeze_domain_modules-439"><span class="linenos">439</span></a>    <span class="k">for</span> <span class="n">mod</span> <span class="ow">in</span> <span class="n">domain_mods</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="freeze_domain_modules-440"><a href="#freeze_domain_modules-440"><span class="linenos">440</span></a>        <span class="n">mod</span><span class="o">.</span><span class="n">freeze</span><span class="p">()</span>
</span><span id="freeze_domain_modules-441"><a href="#freeze_domain_modules-441"><span class="linenos">441</span></a>    <span class="c1"># Cast for better auto-completion at the expense of ModuleDict</span>
</span><span id="freeze_domain_modules-442"><a href="#freeze_domain_modules-442"><span class="linenos">442</span></a>    <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DomainModule</span><span class="p">],</span> <span class="n">ModuleDict</span><span class="p">(</span><span class="n">domain_mods</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Freezes weights and set to eval mode the domain modules.</p>

<div class="pdoc-alert pdoc-alert-note">

<p>The output is casted as <code>dict[str, DomainModule]</code> type for better
auto-completion, but is actually a torch <code>ModuleDict</code>.</p>

</div>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>domain_mods (<code>Mapping[str, DomainModule]</code>):</strong>  mapping of domain modules to freeze</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p><code>ModuleDict</code>: frozen modules.</p>
</blockquote>
</div>


                </section>
                <section id="GWPredictions">
                            <input id="GWPredictions-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">GWPredictions</span><wbr>(<span class="base">builtins.dict</span>):

                <label class="view-source-button" for="GWPredictions-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GWPredictions"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GWPredictions-445"><a href="#GWPredictions-445"><span class="linenos">445</span></a><span class="k">class</span> <span class="nc">GWPredictions</span><span class="p">(</span><span class="n">GWPredictionsBase</span><span class="p">):</span>
</span><span id="GWPredictions-446"><a href="#GWPredictions-446"><span class="linenos">446</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;TypedDict of the output given when calling `GlobalWorkspaceBase.predict`&quot;&quot;&quot;</span>
</span><span id="GWPredictions-447"><a href="#GWPredictions-447"><span class="linenos">447</span></a>
</span><span id="GWPredictions-448"><a href="#GWPredictions-448"><span class="linenos">448</span></a>    <span class="n">demi_cycles</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span>
</span><span id="GWPredictions-449"><a href="#GWPredictions-449"><span class="linenos">449</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GWPredictions-450"><a href="#GWPredictions-450"><span class="linenos">450</span></a><span class="sd">    Demi-cycle predictions of the model for each domain. Only computed on domain</span>
</span><span id="GWPredictions-451"><a href="#GWPredictions-451"><span class="linenos">451</span></a><span class="sd">    groups with only one domain.</span>
</span><span id="GWPredictions-452"><a href="#GWPredictions-452"><span class="linenos">452</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="GWPredictions-453"><a href="#GWPredictions-453"><span class="linenos">453</span></a>
</span><span id="GWPredictions-454"><a href="#GWPredictions-454"><span class="linenos">454</span></a>    <span class="n">cycles</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span>
</span><span id="GWPredictions-455"><a href="#GWPredictions-455"><span class="linenos">455</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GWPredictions-456"><a href="#GWPredictions-456"><span class="linenos">456</span></a><span class="sd">    Cycle predictions of the model from one domain through another one.</span>
</span><span id="GWPredictions-457"><a href="#GWPredictions-457"><span class="linenos">457</span></a><span class="sd">    Only computed on domain groups with more than one domain.</span>
</span><span id="GWPredictions-458"><a href="#GWPredictions-458"><span class="linenos">458</span></a><span class="sd">    The keys are tuple with start domain and intermediary domain.</span>
</span><span id="GWPredictions-459"><a href="#GWPredictions-459"><span class="linenos">459</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="GWPredictions-460"><a href="#GWPredictions-460"><span class="linenos">460</span></a>
</span><span id="GWPredictions-461"><a href="#GWPredictions-461"><span class="linenos">461</span></a>    <span class="n">translations</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]</span>
</span><span id="GWPredictions-462"><a href="#GWPredictions-462"><span class="linenos">462</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GWPredictions-463"><a href="#GWPredictions-463"><span class="linenos">463</span></a><span class="sd">    Translation predictions of the model from one domain through another one.</span>
</span><span id="GWPredictions-464"><a href="#GWPredictions-464"><span class="linenos">464</span></a>
</span><span id="GWPredictions-465"><a href="#GWPredictions-465"><span class="linenos">465</span></a><span class="sd">    Only computed on domain groups with more than one domain.</span>
</span><span id="GWPredictions-466"><a href="#GWPredictions-466"><span class="linenos">466</span></a><span class="sd">    The keys are tuples with start domain and target domain.</span>
</span><span id="GWPredictions-467"><a href="#GWPredictions-467"><span class="linenos">467</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>TypedDict of the output given when calling <code>GlobalWorkspaceBase.predict</code></p>
</div>


                            <div id="GWPredictions.demi_cycles" class="classattr">
                                <div class="attr variable">
            <span class="name">demi_cycles</span><span class="annotation">: dict[str, torch.Tensor]</span>

        
    </div>
    <a class="headerlink" href="#GWPredictions.demi_cycles"></a>
    
            <div class="docstring"><p>Demi-cycle predictions of the model for each domain. Only computed on domain
groups with only one domain.</p>
</div>


                            </div>
                            <div id="GWPredictions.cycles" class="classattr">
                                <div class="attr variable">
            <span class="name">cycles</span><span class="annotation">: dict[tuple[str, str], torch.Tensor]</span>

        
    </div>
    <a class="headerlink" href="#GWPredictions.cycles"></a>
    
            <div class="docstring"><p>Cycle predictions of the model from one domain through another one.
Only computed on domain groups with more than one domain.
The keys are tuple with start domain and intermediary domain.</p>
</div>


                            </div>
                            <div id="GWPredictions.translations" class="classattr">
                                <div class="attr variable">
            <span class="name">translations</span><span class="annotation">: dict[tuple[str, str], torch.Tensor]</span>

        
    </div>
    <a class="headerlink" href="#GWPredictions.translations"></a>
    
            <div class="docstring"><p>Translation predictions of the model from one domain through another one.</p>

<p>Only computed on domain groups with more than one domain.
The keys are tuples with start domain and target domain.</p>
</div>


                            </div>
                            <div id="GWPredictions.states" class="classattr">
                                <div class="attr variable">
            <span class="name">states</span><span class="annotation">: dict[str, torch.Tensor]</span>

        
    </div>
    <a class="headerlink" href="#GWPredictions.states"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.dict</dt>
                                <dd id="GWPredictions.get" class="function">get</dd>
                <dd id="GWPredictions.setdefault" class="function">setdefault</dd>
                <dd id="GWPredictions.pop" class="function">pop</dd>
                <dd id="GWPredictions.popitem" class="function">popitem</dd>
                <dd id="GWPredictions.keys" class="function">keys</dd>
                <dd id="GWPredictions.items" class="function">items</dd>
                <dd id="GWPredictions.values" class="function">values</dd>
                <dd id="GWPredictions.update" class="function">update</dd>
                <dd id="GWPredictions.fromkeys" class="function">fromkeys</dd>
                <dd id="GWPredictions.clear" class="function">clear</dd>
                <dd id="GWPredictions.copy" class="function">copy</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="GlobalWorkspace2Domains">
                            <input id="GlobalWorkspace2Domains-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">GlobalWorkspace2Domains</span><wbr>(<span class="base"><a href="#GlobalWorkspaceBase">shimmer.modules.global_workspace.GlobalWorkspaceBase[shimmer.modules.gw_module.GWModule, shimmer.modules.selection.SingleDomainSelection, shimmer.modules.losses.GWLosses2Domains]</a></span>):

                <label class="view-source-button" for="GlobalWorkspace2Domains-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GlobalWorkspace2Domains"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GlobalWorkspace2Domains-470"><a href="#GlobalWorkspace2Domains-470"><span class="linenos">470</span></a><span class="k">class</span> <span class="nc">GlobalWorkspace2Domains</span><span class="p">(</span>
</span><span id="GlobalWorkspace2Domains-471"><a href="#GlobalWorkspace2Domains-471"><span class="linenos">471</span></a>    <span class="n">GlobalWorkspaceBase</span><span class="p">[</span><span class="n">GWModule</span><span class="p">,</span> <span class="n">SingleDomainSelection</span><span class="p">,</span> <span class="n">GWLosses2Domains</span><span class="p">]</span>
</span><span id="GlobalWorkspace2Domains-472"><a href="#GlobalWorkspace2Domains-472"><span class="linenos">472</span></a><span class="p">):</span>
</span><span id="GlobalWorkspace2Domains-473"><a href="#GlobalWorkspace2Domains-473"><span class="linenos">473</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspace2Domains-474"><a href="#GlobalWorkspace2Domains-474"><span class="linenos">474</span></a><span class="sd">    A simple 2-domains max flavor of GlobalWorkspaceBase.</span>
</span><span id="GlobalWorkspace2Domains-475"><a href="#GlobalWorkspace2Domains-475"><span class="linenos">475</span></a>
</span><span id="GlobalWorkspace2Domains-476"><a href="#GlobalWorkspace2Domains-476"><span class="linenos">476</span></a><span class="sd">    This is used to simplify a Global Workspace instanciation and only overrides the</span>
</span><span id="GlobalWorkspace2Domains-477"><a href="#GlobalWorkspace2Domains-477"><span class="linenos">477</span></a><span class="sd">    `__init__` method.</span>
</span><span id="GlobalWorkspace2Domains-478"><a href="#GlobalWorkspace2Domains-478"><span class="linenos">478</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="GlobalWorkspace2Domains-479"><a href="#GlobalWorkspace2Domains-479"><span class="linenos">479</span></a>
</span><span id="GlobalWorkspace2Domains-480"><a href="#GlobalWorkspace2Domains-480"><span class="linenos">480</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="GlobalWorkspace2Domains-481"><a href="#GlobalWorkspace2Domains-481"><span class="linenos">481</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GlobalWorkspace2Domains-482"><a href="#GlobalWorkspace2Domains-482"><span class="linenos">482</span></a>        <span class="n">domain_mods</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DomainModule</span><span class="p">],</span>
</span><span id="GlobalWorkspace2Domains-483"><a href="#GlobalWorkspace2Domains-483"><span class="linenos">483</span></a>        <span class="n">gw_encoders</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Module</span><span class="p">],</span>
</span><span id="GlobalWorkspace2Domains-484"><a href="#GlobalWorkspace2Domains-484"><span class="linenos">484</span></a>        <span class="n">gw_decoders</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Module</span><span class="p">],</span>
</span><span id="GlobalWorkspace2Domains-485"><a href="#GlobalWorkspace2Domains-485"><span class="linenos">485</span></a>        <span class="n">workspace_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="GlobalWorkspace2Domains-486"><a href="#GlobalWorkspace2Domains-486"><span class="linenos">486</span></a>        <span class="n">loss_coefs</span><span class="p">:</span> <span class="n">LossCoefs</span><span class="p">,</span>
</span><span id="GlobalWorkspace2Domains-487"><a href="#GlobalWorkspace2Domains-487"><span class="linenos">487</span></a>        <span class="n">optim_lr</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">,</span>
</span><span id="GlobalWorkspace2Domains-488"><a href="#GlobalWorkspace2Domains-488"><span class="linenos">488</span></a>        <span class="n">optim_weight_decay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="GlobalWorkspace2Domains-489"><a href="#GlobalWorkspace2Domains-489"><span class="linenos">489</span></a>        <span class="n">scheduler_args</span><span class="p">:</span> <span class="n">SchedulerArgs</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GlobalWorkspace2Domains-490"><a href="#GlobalWorkspace2Domains-490"><span class="linenos">490</span></a>        <span class="n">learn_logit_scale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="GlobalWorkspace2Domains-491"><a href="#GlobalWorkspace2Domains-491"><span class="linenos">491</span></a>        <span class="n">contrastive_loss</span><span class="p">:</span> <span class="n">ContrastiveLossType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GlobalWorkspace2Domains-492"><a href="#GlobalWorkspace2Domains-492"><span class="linenos">492</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GlobalWorkspace2Domains-493"><a href="#GlobalWorkspace2Domains-493"><span class="linenos">493</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspace2Domains-494"><a href="#GlobalWorkspace2Domains-494"><span class="linenos">494</span></a><span class="sd">        Initializes a Global Workspace</span>
</span><span id="GlobalWorkspace2Domains-495"><a href="#GlobalWorkspace2Domains-495"><span class="linenos">495</span></a>
</span><span id="GlobalWorkspace2Domains-496"><a href="#GlobalWorkspace2Domains-496"><span class="linenos">496</span></a><span class="sd">        Args:</span>
</span><span id="GlobalWorkspace2Domains-497"><a href="#GlobalWorkspace2Domains-497"><span class="linenos">497</span></a><span class="sd">            domain_mods (`Mapping[str, DomainModule]`): mapping of the domains</span>
</span><span id="GlobalWorkspace2Domains-498"><a href="#GlobalWorkspace2Domains-498"><span class="linenos">498</span></a><span class="sd">                connected to the GW. Keys are domain names, values are the</span>
</span><span id="GlobalWorkspace2Domains-499"><a href="#GlobalWorkspace2Domains-499"><span class="linenos">499</span></a><span class="sd">                `DomainModule`.</span>
</span><span id="GlobalWorkspace2Domains-500"><a href="#GlobalWorkspace2Domains-500"><span class="linenos">500</span></a><span class="sd">            gw_encoders (`Mapping[str, torch.nn.Module]`): mapping for each domain</span>
</span><span id="GlobalWorkspace2Domains-501"><a href="#GlobalWorkspace2Domains-501"><span class="linenos">501</span></a><span class="sd">                name to a `torch.nn.Module` class which role is to encode a</span>
</span><span id="GlobalWorkspace2Domains-502"><a href="#GlobalWorkspace2Domains-502"><span class="linenos">502</span></a><span class="sd">                unimodal latent representations into a GW representation (pre fusion).</span>
</span><span id="GlobalWorkspace2Domains-503"><a href="#GlobalWorkspace2Domains-503"><span class="linenos">503</span></a><span class="sd">            gw_decoders (`Mapping[str, torch.nn.Module]`): mapping for each domain</span>
</span><span id="GlobalWorkspace2Domains-504"><a href="#GlobalWorkspace2Domains-504"><span class="linenos">504</span></a><span class="sd">                name to a `torch.nn.Module` class which role is to decode a</span>
</span><span id="GlobalWorkspace2Domains-505"><a href="#GlobalWorkspace2Domains-505"><span class="linenos">505</span></a><span class="sd">                GW representation into a unimodal latent representations.</span>
</span><span id="GlobalWorkspace2Domains-506"><a href="#GlobalWorkspace2Domains-506"><span class="linenos">506</span></a><span class="sd">            workspace_dim (`int`): dimension of the GW.</span>
</span><span id="GlobalWorkspace2Domains-507"><a href="#GlobalWorkspace2Domains-507"><span class="linenos">507</span></a><span class="sd">            loss_coefs (`LossCoefs`): loss coefficients</span>
</span><span id="GlobalWorkspace2Domains-508"><a href="#GlobalWorkspace2Domains-508"><span class="linenos">508</span></a><span class="sd">            optim_lr (`float`): learning rate</span>
</span><span id="GlobalWorkspace2Domains-509"><a href="#GlobalWorkspace2Domains-509"><span class="linenos">509</span></a><span class="sd">            optim_weight_decay (`float`): weight decay</span>
</span><span id="GlobalWorkspace2Domains-510"><a href="#GlobalWorkspace2Domains-510"><span class="linenos">510</span></a><span class="sd">            scheduler_args (`SchedulerArgs | None`): optimization scheduler&#39;s arguments</span>
</span><span id="GlobalWorkspace2Domains-511"><a href="#GlobalWorkspace2Domains-511"><span class="linenos">511</span></a><span class="sd">            learn_logit_scale (`bool`): whether to learn the contrastive learning</span>
</span><span id="GlobalWorkspace2Domains-512"><a href="#GlobalWorkspace2Domains-512"><span class="linenos">512</span></a><span class="sd">                contrastive loss when using the default contrastive loss.</span>
</span><span id="GlobalWorkspace2Domains-513"><a href="#GlobalWorkspace2Domains-513"><span class="linenos">513</span></a><span class="sd">            contrastive_loss (`ContrastiveLossType | None`): a contrastive loss</span>
</span><span id="GlobalWorkspace2Domains-514"><a href="#GlobalWorkspace2Domains-514"><span class="linenos">514</span></a><span class="sd">                function used for alignment. `learn_logit_scale` will not affect custom</span>
</span><span id="GlobalWorkspace2Domains-515"><a href="#GlobalWorkspace2Domains-515"><span class="linenos">515</span></a><span class="sd">                contrastive losses.</span>
</span><span id="GlobalWorkspace2Domains-516"><a href="#GlobalWorkspace2Domains-516"><span class="linenos">516</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GlobalWorkspace2Domains-517"><a href="#GlobalWorkspace2Domains-517"><span class="linenos">517</span></a>        <span class="n">domain_mods</span> <span class="o">=</span> <span class="n">freeze_domain_modules</span><span class="p">(</span><span class="n">domain_mods</span><span class="p">)</span>
</span><span id="GlobalWorkspace2Domains-518"><a href="#GlobalWorkspace2Domains-518"><span class="linenos">518</span></a>
</span><span id="GlobalWorkspace2Domains-519"><a href="#GlobalWorkspace2Domains-519"><span class="linenos">519</span></a>        <span class="n">gw_mod</span> <span class="o">=</span> <span class="n">GWModule</span><span class="p">(</span><span class="n">domain_mods</span><span class="p">,</span> <span class="n">workspace_dim</span><span class="p">,</span> <span class="n">gw_encoders</span><span class="p">,</span> <span class="n">gw_decoders</span><span class="p">)</span>
</span><span id="GlobalWorkspace2Domains-520"><a href="#GlobalWorkspace2Domains-520"><span class="linenos">520</span></a>        <span class="k">if</span> <span class="n">contrastive_loss</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GlobalWorkspace2Domains-521"><a href="#GlobalWorkspace2Domains-521"><span class="linenos">521</span></a>            <span class="n">contrastive_loss</span> <span class="o">=</span> <span class="n">ContrastiveLoss</span><span class="p">(</span>
</span><span id="GlobalWorkspace2Domains-522"><a href="#GlobalWorkspace2Domains-522"><span class="linenos">522</span></a>                <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">1</span> <span class="o">/</span> <span class="mf">0.07</span><span class="p">])</span><span class="o">.</span><span class="n">log</span><span class="p">(),</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="n">learn_logit_scale</span>
</span><span id="GlobalWorkspace2Domains-523"><a href="#GlobalWorkspace2Domains-523"><span class="linenos">523</span></a>            <span class="p">)</span>
</span><span id="GlobalWorkspace2Domains-524"><a href="#GlobalWorkspace2Domains-524"><span class="linenos">524</span></a>        <span class="n">selection_mod</span> <span class="o">=</span> <span class="n">SingleDomainSelection</span><span class="p">()</span>
</span><span id="GlobalWorkspace2Domains-525"><a href="#GlobalWorkspace2Domains-525"><span class="linenos">525</span></a>        <span class="n">loss_mod</span> <span class="o">=</span> <span class="n">GWLosses2Domains</span><span class="p">(</span>
</span><span id="GlobalWorkspace2Domains-526"><a href="#GlobalWorkspace2Domains-526"><span class="linenos">526</span></a>            <span class="n">gw_mod</span><span class="p">,</span> <span class="n">selection_mod</span><span class="p">,</span> <span class="n">domain_mods</span><span class="p">,</span> <span class="n">loss_coefs</span><span class="p">,</span> <span class="n">contrastive_loss</span>
</span><span id="GlobalWorkspace2Domains-527"><a href="#GlobalWorkspace2Domains-527"><span class="linenos">527</span></a>        <span class="p">)</span>
</span><span id="GlobalWorkspace2Domains-528"><a href="#GlobalWorkspace2Domains-528"><span class="linenos">528</span></a>
</span><span id="GlobalWorkspace2Domains-529"><a href="#GlobalWorkspace2Domains-529"><span class="linenos">529</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="GlobalWorkspace2Domains-530"><a href="#GlobalWorkspace2Domains-530"><span class="linenos">530</span></a>            <span class="n">gw_mod</span><span class="p">,</span>
</span><span id="GlobalWorkspace2Domains-531"><a href="#GlobalWorkspace2Domains-531"><span class="linenos">531</span></a>            <span class="n">selection_mod</span><span class="p">,</span>
</span><span id="GlobalWorkspace2Domains-532"><a href="#GlobalWorkspace2Domains-532"><span class="linenos">532</span></a>            <span class="n">loss_mod</span><span class="p">,</span>
</span><span id="GlobalWorkspace2Domains-533"><a href="#GlobalWorkspace2Domains-533"><span class="linenos">533</span></a>            <span class="n">optim_lr</span><span class="p">,</span>
</span><span id="GlobalWorkspace2Domains-534"><a href="#GlobalWorkspace2Domains-534"><span class="linenos">534</span></a>            <span class="n">optim_weight_decay</span><span class="p">,</span>
</span><span id="GlobalWorkspace2Domains-535"><a href="#GlobalWorkspace2Domains-535"><span class="linenos">535</span></a>            <span class="n">scheduler_args</span><span class="p">,</span>
</span><span id="GlobalWorkspace2Domains-536"><a href="#GlobalWorkspace2Domains-536"><span class="linenos">536</span></a>        <span class="p">)</span>
</span><span id="GlobalWorkspace2Domains-537"><a href="#GlobalWorkspace2Domains-537"><span class="linenos">537</span></a>
</span><span id="GlobalWorkspace2Domains-538"><a href="#GlobalWorkspace2Domains-538"><span class="linenos">538</span></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="GlobalWorkspace2Domains-539"><a href="#GlobalWorkspace2Domains-539"><span class="linenos">539</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GlobalWorkspace2Domains-540"><a href="#GlobalWorkspace2Domains-540"><span class="linenos">540</span></a>        <span class="n">latent_domains</span><span class="p">:</span> <span class="n">LatentsDomainGroupsT</span><span class="p">,</span>
</span><span id="GlobalWorkspace2Domains-541"><a href="#GlobalWorkspace2Domains-541"><span class="linenos">541</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GWPredictions</span><span class="p">:</span>
</span><span id="GlobalWorkspace2Domains-542"><a href="#GlobalWorkspace2Domains-542"><span class="linenos">542</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspace2Domains-543"><a href="#GlobalWorkspace2Domains-543"><span class="linenos">543</span></a><span class="sd">        Computes demi-cycles, cycles, and translations.</span>
</span><span id="GlobalWorkspace2Domains-544"><a href="#GlobalWorkspace2Domains-544"><span class="linenos">544</span></a>
</span><span id="GlobalWorkspace2Domains-545"><a href="#GlobalWorkspace2Domains-545"><span class="linenos">545</span></a><span class="sd">        Args:</span>
</span><span id="GlobalWorkspace2Domains-546"><a href="#GlobalWorkspace2Domains-546"><span class="linenos">546</span></a><span class="sd">            latent_domains (`LatentsT`): Groups of domains for the computation.</span>
</span><span id="GlobalWorkspace2Domains-547"><a href="#GlobalWorkspace2Domains-547"><span class="linenos">547</span></a>
</span><span id="GlobalWorkspace2Domains-548"><a href="#GlobalWorkspace2Domains-548"><span class="linenos">548</span></a><span class="sd">        Returns:</span>
</span><span id="GlobalWorkspace2Domains-549"><a href="#GlobalWorkspace2Domains-549"><span class="linenos">549</span></a><span class="sd">            `GWPredictions`: the predictions on the batch.</span>
</span><span id="GlobalWorkspace2Domains-550"><a href="#GlobalWorkspace2Domains-550"><span class="linenos">550</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GlobalWorkspace2Domains-551"><a href="#GlobalWorkspace2Domains-551"><span class="linenos">551</span></a>        <span class="k">return</span> <span class="n">GWPredictions</span><span class="p">(</span>
</span><span id="GlobalWorkspace2Domains-552"><a href="#GlobalWorkspace2Domains-552"><span class="linenos">552</span></a>            <span class="n">demi_cycles</span><span class="o">=</span><span class="n">batch_demi_cycles</span><span class="p">(</span>
</span><span id="GlobalWorkspace2Domains-553"><a href="#GlobalWorkspace2Domains-553"><span class="linenos">553</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_mod</span><span class="p">,</span> <span class="n">latent_domains</span>
</span><span id="GlobalWorkspace2Domains-554"><a href="#GlobalWorkspace2Domains-554"><span class="linenos">554</span></a>            <span class="p">),</span>
</span><span id="GlobalWorkspace2Domains-555"><a href="#GlobalWorkspace2Domains-555"><span class="linenos">555</span></a>            <span class="n">cycles</span><span class="o">=</span><span class="n">batch_cycles</span><span class="p">(</span>
</span><span id="GlobalWorkspace2Domains-556"><a href="#GlobalWorkspace2Domains-556"><span class="linenos">556</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_mod</span><span class="p">,</span> <span class="n">latent_domains</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_mods</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="GlobalWorkspace2Domains-557"><a href="#GlobalWorkspace2Domains-557"><span class="linenos">557</span></a>            <span class="p">),</span>
</span><span id="GlobalWorkspace2Domains-558"><a href="#GlobalWorkspace2Domains-558"><span class="linenos">558</span></a>            <span class="n">translations</span><span class="o">=</span><span class="n">batch_translations</span><span class="p">(</span>
</span><span id="GlobalWorkspace2Domains-559"><a href="#GlobalWorkspace2Domains-559"><span class="linenos">559</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_mod</span><span class="p">,</span> <span class="n">latent_domains</span>
</span><span id="GlobalWorkspace2Domains-560"><a href="#GlobalWorkspace2Domains-560"><span class="linenos">560</span></a>            <span class="p">),</span>
</span><span id="GlobalWorkspace2Domains-561"><a href="#GlobalWorkspace2Domains-561"><span class="linenos">561</span></a>            <span class="o">**</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">latent_domains</span><span class="p">),</span>
</span><span id="GlobalWorkspace2Domains-562"><a href="#GlobalWorkspace2Domains-562"><span class="linenos">562</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A simple 2-domains max flavor of GlobalWorkspaceBase.</p>

<p>This is used to simplify a Global Workspace instanciation and only overrides the
<code><a href="#GlobalWorkspace2Domains.__init__">__init__</a></code> method.</p>
</div>


                            <div id="GlobalWorkspace2Domains.__init__" class="classattr">
                                        <input id="GlobalWorkspace2Domains.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">GlobalWorkspace2Domains</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">domain_mods</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><a href="domain.html#DomainModule">shimmer.modules.domain.DomainModule</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">gw_encoders</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span>,</span><span class="param">	<span class="n">gw_decoders</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span>,</span><span class="param">	<span class="n">workspace_dim</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">loss_coefs</span><span class="p">:</span> <span class="n"><a href="losses.html#LossCoefs">shimmer.modules.losses.LossCoefs</a></span>,</span><span class="param">	<span class="n">optim_lr</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span>,</span><span class="param">	<span class="n">optim_weight_decay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>,</span><span class="param">	<span class="n">scheduler_args</span><span class="p">:</span> <span class="n"><a href="#SchedulerArgs">SchedulerArgs</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">learn_logit_scale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">contrastive_loss</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span> <span class="n"><a href="domain.html#LossOutput">shimmer.modules.domain.LossOutput</a></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="GlobalWorkspace2Domains.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GlobalWorkspace2Domains.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GlobalWorkspace2Domains.__init__-480"><a href="#GlobalWorkspace2Domains.__init__-480"><span class="linenos">480</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="GlobalWorkspace2Domains.__init__-481"><a href="#GlobalWorkspace2Domains.__init__-481"><span class="linenos">481</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GlobalWorkspace2Domains.__init__-482"><a href="#GlobalWorkspace2Domains.__init__-482"><span class="linenos">482</span></a>        <span class="n">domain_mods</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DomainModule</span><span class="p">],</span>
</span><span id="GlobalWorkspace2Domains.__init__-483"><a href="#GlobalWorkspace2Domains.__init__-483"><span class="linenos">483</span></a>        <span class="n">gw_encoders</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Module</span><span class="p">],</span>
</span><span id="GlobalWorkspace2Domains.__init__-484"><a href="#GlobalWorkspace2Domains.__init__-484"><span class="linenos">484</span></a>        <span class="n">gw_decoders</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Module</span><span class="p">],</span>
</span><span id="GlobalWorkspace2Domains.__init__-485"><a href="#GlobalWorkspace2Domains.__init__-485"><span class="linenos">485</span></a>        <span class="n">workspace_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="GlobalWorkspace2Domains.__init__-486"><a href="#GlobalWorkspace2Domains.__init__-486"><span class="linenos">486</span></a>        <span class="n">loss_coefs</span><span class="p">:</span> <span class="n">LossCoefs</span><span class="p">,</span>
</span><span id="GlobalWorkspace2Domains.__init__-487"><a href="#GlobalWorkspace2Domains.__init__-487"><span class="linenos">487</span></a>        <span class="n">optim_lr</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">,</span>
</span><span id="GlobalWorkspace2Domains.__init__-488"><a href="#GlobalWorkspace2Domains.__init__-488"><span class="linenos">488</span></a>        <span class="n">optim_weight_decay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="GlobalWorkspace2Domains.__init__-489"><a href="#GlobalWorkspace2Domains.__init__-489"><span class="linenos">489</span></a>        <span class="n">scheduler_args</span><span class="p">:</span> <span class="n">SchedulerArgs</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GlobalWorkspace2Domains.__init__-490"><a href="#GlobalWorkspace2Domains.__init__-490"><span class="linenos">490</span></a>        <span class="n">learn_logit_scale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="GlobalWorkspace2Domains.__init__-491"><a href="#GlobalWorkspace2Domains.__init__-491"><span class="linenos">491</span></a>        <span class="n">contrastive_loss</span><span class="p">:</span> <span class="n">ContrastiveLossType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GlobalWorkspace2Domains.__init__-492"><a href="#GlobalWorkspace2Domains.__init__-492"><span class="linenos">492</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GlobalWorkspace2Domains.__init__-493"><a href="#GlobalWorkspace2Domains.__init__-493"><span class="linenos">493</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspace2Domains.__init__-494"><a href="#GlobalWorkspace2Domains.__init__-494"><span class="linenos">494</span></a><span class="sd">        Initializes a Global Workspace</span>
</span><span id="GlobalWorkspace2Domains.__init__-495"><a href="#GlobalWorkspace2Domains.__init__-495"><span class="linenos">495</span></a>
</span><span id="GlobalWorkspace2Domains.__init__-496"><a href="#GlobalWorkspace2Domains.__init__-496"><span class="linenos">496</span></a><span class="sd">        Args:</span>
</span><span id="GlobalWorkspace2Domains.__init__-497"><a href="#GlobalWorkspace2Domains.__init__-497"><span class="linenos">497</span></a><span class="sd">            domain_mods (`Mapping[str, DomainModule]`): mapping of the domains</span>
</span><span id="GlobalWorkspace2Domains.__init__-498"><a href="#GlobalWorkspace2Domains.__init__-498"><span class="linenos">498</span></a><span class="sd">                connected to the GW. Keys are domain names, values are the</span>
</span><span id="GlobalWorkspace2Domains.__init__-499"><a href="#GlobalWorkspace2Domains.__init__-499"><span class="linenos">499</span></a><span class="sd">                `DomainModule`.</span>
</span><span id="GlobalWorkspace2Domains.__init__-500"><a href="#GlobalWorkspace2Domains.__init__-500"><span class="linenos">500</span></a><span class="sd">            gw_encoders (`Mapping[str, torch.nn.Module]`): mapping for each domain</span>
</span><span id="GlobalWorkspace2Domains.__init__-501"><a href="#GlobalWorkspace2Domains.__init__-501"><span class="linenos">501</span></a><span class="sd">                name to a `torch.nn.Module` class which role is to encode a</span>
</span><span id="GlobalWorkspace2Domains.__init__-502"><a href="#GlobalWorkspace2Domains.__init__-502"><span class="linenos">502</span></a><span class="sd">                unimodal latent representations into a GW representation (pre fusion).</span>
</span><span id="GlobalWorkspace2Domains.__init__-503"><a href="#GlobalWorkspace2Domains.__init__-503"><span class="linenos">503</span></a><span class="sd">            gw_decoders (`Mapping[str, torch.nn.Module]`): mapping for each domain</span>
</span><span id="GlobalWorkspace2Domains.__init__-504"><a href="#GlobalWorkspace2Domains.__init__-504"><span class="linenos">504</span></a><span class="sd">                name to a `torch.nn.Module` class which role is to decode a</span>
</span><span id="GlobalWorkspace2Domains.__init__-505"><a href="#GlobalWorkspace2Domains.__init__-505"><span class="linenos">505</span></a><span class="sd">                GW representation into a unimodal latent representations.</span>
</span><span id="GlobalWorkspace2Domains.__init__-506"><a href="#GlobalWorkspace2Domains.__init__-506"><span class="linenos">506</span></a><span class="sd">            workspace_dim (`int`): dimension of the GW.</span>
</span><span id="GlobalWorkspace2Domains.__init__-507"><a href="#GlobalWorkspace2Domains.__init__-507"><span class="linenos">507</span></a><span class="sd">            loss_coefs (`LossCoefs`): loss coefficients</span>
</span><span id="GlobalWorkspace2Domains.__init__-508"><a href="#GlobalWorkspace2Domains.__init__-508"><span class="linenos">508</span></a><span class="sd">            optim_lr (`float`): learning rate</span>
</span><span id="GlobalWorkspace2Domains.__init__-509"><a href="#GlobalWorkspace2Domains.__init__-509"><span class="linenos">509</span></a><span class="sd">            optim_weight_decay (`float`): weight decay</span>
</span><span id="GlobalWorkspace2Domains.__init__-510"><a href="#GlobalWorkspace2Domains.__init__-510"><span class="linenos">510</span></a><span class="sd">            scheduler_args (`SchedulerArgs | None`): optimization scheduler&#39;s arguments</span>
</span><span id="GlobalWorkspace2Domains.__init__-511"><a href="#GlobalWorkspace2Domains.__init__-511"><span class="linenos">511</span></a><span class="sd">            learn_logit_scale (`bool`): whether to learn the contrastive learning</span>
</span><span id="GlobalWorkspace2Domains.__init__-512"><a href="#GlobalWorkspace2Domains.__init__-512"><span class="linenos">512</span></a><span class="sd">                contrastive loss when using the default contrastive loss.</span>
</span><span id="GlobalWorkspace2Domains.__init__-513"><a href="#GlobalWorkspace2Domains.__init__-513"><span class="linenos">513</span></a><span class="sd">            contrastive_loss (`ContrastiveLossType | None`): a contrastive loss</span>
</span><span id="GlobalWorkspace2Domains.__init__-514"><a href="#GlobalWorkspace2Domains.__init__-514"><span class="linenos">514</span></a><span class="sd">                function used for alignment. `learn_logit_scale` will not affect custom</span>
</span><span id="GlobalWorkspace2Domains.__init__-515"><a href="#GlobalWorkspace2Domains.__init__-515"><span class="linenos">515</span></a><span class="sd">                contrastive losses.</span>
</span><span id="GlobalWorkspace2Domains.__init__-516"><a href="#GlobalWorkspace2Domains.__init__-516"><span class="linenos">516</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GlobalWorkspace2Domains.__init__-517"><a href="#GlobalWorkspace2Domains.__init__-517"><span class="linenos">517</span></a>        <span class="n">domain_mods</span> <span class="o">=</span> <span class="n">freeze_domain_modules</span><span class="p">(</span><span class="n">domain_mods</span><span class="p">)</span>
</span><span id="GlobalWorkspace2Domains.__init__-518"><a href="#GlobalWorkspace2Domains.__init__-518"><span class="linenos">518</span></a>
</span><span id="GlobalWorkspace2Domains.__init__-519"><a href="#GlobalWorkspace2Domains.__init__-519"><span class="linenos">519</span></a>        <span class="n">gw_mod</span> <span class="o">=</span> <span class="n">GWModule</span><span class="p">(</span><span class="n">domain_mods</span><span class="p">,</span> <span class="n">workspace_dim</span><span class="p">,</span> <span class="n">gw_encoders</span><span class="p">,</span> <span class="n">gw_decoders</span><span class="p">)</span>
</span><span id="GlobalWorkspace2Domains.__init__-520"><a href="#GlobalWorkspace2Domains.__init__-520"><span class="linenos">520</span></a>        <span class="k">if</span> <span class="n">contrastive_loss</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GlobalWorkspace2Domains.__init__-521"><a href="#GlobalWorkspace2Domains.__init__-521"><span class="linenos">521</span></a>            <span class="n">contrastive_loss</span> <span class="o">=</span> <span class="n">ContrastiveLoss</span><span class="p">(</span>
</span><span id="GlobalWorkspace2Domains.__init__-522"><a href="#GlobalWorkspace2Domains.__init__-522"><span class="linenos">522</span></a>                <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">1</span> <span class="o">/</span> <span class="mf">0.07</span><span class="p">])</span><span class="o">.</span><span class="n">log</span><span class="p">(),</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="n">learn_logit_scale</span>
</span><span id="GlobalWorkspace2Domains.__init__-523"><a href="#GlobalWorkspace2Domains.__init__-523"><span class="linenos">523</span></a>            <span class="p">)</span>
</span><span id="GlobalWorkspace2Domains.__init__-524"><a href="#GlobalWorkspace2Domains.__init__-524"><span class="linenos">524</span></a>        <span class="n">selection_mod</span> <span class="o">=</span> <span class="n">SingleDomainSelection</span><span class="p">()</span>
</span><span id="GlobalWorkspace2Domains.__init__-525"><a href="#GlobalWorkspace2Domains.__init__-525"><span class="linenos">525</span></a>        <span class="n">loss_mod</span> <span class="o">=</span> <span class="n">GWLosses2Domains</span><span class="p">(</span>
</span><span id="GlobalWorkspace2Domains.__init__-526"><a href="#GlobalWorkspace2Domains.__init__-526"><span class="linenos">526</span></a>            <span class="n">gw_mod</span><span class="p">,</span> <span class="n">selection_mod</span><span class="p">,</span> <span class="n">domain_mods</span><span class="p">,</span> <span class="n">loss_coefs</span><span class="p">,</span> <span class="n">contrastive_loss</span>
</span><span id="GlobalWorkspace2Domains.__init__-527"><a href="#GlobalWorkspace2Domains.__init__-527"><span class="linenos">527</span></a>        <span class="p">)</span>
</span><span id="GlobalWorkspace2Domains.__init__-528"><a href="#GlobalWorkspace2Domains.__init__-528"><span class="linenos">528</span></a>
</span><span id="GlobalWorkspace2Domains.__init__-529"><a href="#GlobalWorkspace2Domains.__init__-529"><span class="linenos">529</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="GlobalWorkspace2Domains.__init__-530"><a href="#GlobalWorkspace2Domains.__init__-530"><span class="linenos">530</span></a>            <span class="n">gw_mod</span><span class="p">,</span>
</span><span id="GlobalWorkspace2Domains.__init__-531"><a href="#GlobalWorkspace2Domains.__init__-531"><span class="linenos">531</span></a>            <span class="n">selection_mod</span><span class="p">,</span>
</span><span id="GlobalWorkspace2Domains.__init__-532"><a href="#GlobalWorkspace2Domains.__init__-532"><span class="linenos">532</span></a>            <span class="n">loss_mod</span><span class="p">,</span>
</span><span id="GlobalWorkspace2Domains.__init__-533"><a href="#GlobalWorkspace2Domains.__init__-533"><span class="linenos">533</span></a>            <span class="n">optim_lr</span><span class="p">,</span>
</span><span id="GlobalWorkspace2Domains.__init__-534"><a href="#GlobalWorkspace2Domains.__init__-534"><span class="linenos">534</span></a>            <span class="n">optim_weight_decay</span><span class="p">,</span>
</span><span id="GlobalWorkspace2Domains.__init__-535"><a href="#GlobalWorkspace2Domains.__init__-535"><span class="linenos">535</span></a>            <span class="n">scheduler_args</span><span class="p">,</span>
</span><span id="GlobalWorkspace2Domains.__init__-536"><a href="#GlobalWorkspace2Domains.__init__-536"><span class="linenos">536</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initializes a Global Workspace</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>domain_mods (<code>Mapping[str, DomainModule]</code>):</strong>  mapping of the domains
connected to the GW. Keys are domain names, values are the
<code>DomainModule</code>.</li>
<li><strong>gw_encoders (<code>Mapping[str, torch.nn.Module]</code>):</strong>  mapping for each domain
name to a <code>torch.nn.Module</code> class which role is to encode a
unimodal latent representations into a GW representation (pre fusion).</li>
<li><strong>gw_decoders (<code>Mapping[str, torch.nn.Module]</code>):</strong>  mapping for each domain
name to a <code>torch.nn.Module</code> class which role is to decode a
GW representation into a unimodal latent representations.</li>
<li><strong>workspace_dim (<code>int</code>):</strong>  dimension of the GW.</li>
<li><strong>loss_coefs (<code>LossCoefs</code>):</strong>  loss coefficients</li>
<li><strong>optim_lr (<code><a href="#GlobalWorkspace2Domains.float">float</a></code>):</strong>  learning rate</li>
<li><strong>optim_weight_decay (<code><a href="#GlobalWorkspace2Domains.float">float</a></code>):</strong>  weight decay</li>
<li><strong>scheduler_args (<code>SchedulerArgs | None</code>):</strong>  optimization scheduler's arguments</li>
<li><strong>learn_logit_scale (<code>bool</code>):</strong>  whether to learn the contrastive learning
contrastive loss when using the default contrastive loss.</li>
<li><strong>contrastive_loss (<code>ContrastiveLossType | None</code>):</strong>  a contrastive loss
function used for alignment. <code>learn_logit_scale</code> will not affect custom
contrastive losses.</li>
</ul>
</div>


                            </div>
                            <div id="GlobalWorkspace2Domains.forward" class="classattr">
                                        <input id="GlobalWorkspace2Domains.forward-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">forward</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">latent_domains</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n"><a href="#GWPredictions">GWPredictions</a></span>:</span></span>

                <label class="view-source-button" for="GlobalWorkspace2Domains.forward-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GlobalWorkspace2Domains.forward"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GlobalWorkspace2Domains.forward-538"><a href="#GlobalWorkspace2Domains.forward-538"><span class="linenos">538</span></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="GlobalWorkspace2Domains.forward-539"><a href="#GlobalWorkspace2Domains.forward-539"><span class="linenos">539</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GlobalWorkspace2Domains.forward-540"><a href="#GlobalWorkspace2Domains.forward-540"><span class="linenos">540</span></a>        <span class="n">latent_domains</span><span class="p">:</span> <span class="n">LatentsDomainGroupsT</span><span class="p">,</span>
</span><span id="GlobalWorkspace2Domains.forward-541"><a href="#GlobalWorkspace2Domains.forward-541"><span class="linenos">541</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GWPredictions</span><span class="p">:</span>
</span><span id="GlobalWorkspace2Domains.forward-542"><a href="#GlobalWorkspace2Domains.forward-542"><span class="linenos">542</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspace2Domains.forward-543"><a href="#GlobalWorkspace2Domains.forward-543"><span class="linenos">543</span></a><span class="sd">        Computes demi-cycles, cycles, and translations.</span>
</span><span id="GlobalWorkspace2Domains.forward-544"><a href="#GlobalWorkspace2Domains.forward-544"><span class="linenos">544</span></a>
</span><span id="GlobalWorkspace2Domains.forward-545"><a href="#GlobalWorkspace2Domains.forward-545"><span class="linenos">545</span></a><span class="sd">        Args:</span>
</span><span id="GlobalWorkspace2Domains.forward-546"><a href="#GlobalWorkspace2Domains.forward-546"><span class="linenos">546</span></a><span class="sd">            latent_domains (`LatentsT`): Groups of domains for the computation.</span>
</span><span id="GlobalWorkspace2Domains.forward-547"><a href="#GlobalWorkspace2Domains.forward-547"><span class="linenos">547</span></a>
</span><span id="GlobalWorkspace2Domains.forward-548"><a href="#GlobalWorkspace2Domains.forward-548"><span class="linenos">548</span></a><span class="sd">        Returns:</span>
</span><span id="GlobalWorkspace2Domains.forward-549"><a href="#GlobalWorkspace2Domains.forward-549"><span class="linenos">549</span></a><span class="sd">            `GWPredictions`: the predictions on the batch.</span>
</span><span id="GlobalWorkspace2Domains.forward-550"><a href="#GlobalWorkspace2Domains.forward-550"><span class="linenos">550</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GlobalWorkspace2Domains.forward-551"><a href="#GlobalWorkspace2Domains.forward-551"><span class="linenos">551</span></a>        <span class="k">return</span> <span class="n">GWPredictions</span><span class="p">(</span>
</span><span id="GlobalWorkspace2Domains.forward-552"><a href="#GlobalWorkspace2Domains.forward-552"><span class="linenos">552</span></a>            <span class="n">demi_cycles</span><span class="o">=</span><span class="n">batch_demi_cycles</span><span class="p">(</span>
</span><span id="GlobalWorkspace2Domains.forward-553"><a href="#GlobalWorkspace2Domains.forward-553"><span class="linenos">553</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_mod</span><span class="p">,</span> <span class="n">latent_domains</span>
</span><span id="GlobalWorkspace2Domains.forward-554"><a href="#GlobalWorkspace2Domains.forward-554"><span class="linenos">554</span></a>            <span class="p">),</span>
</span><span id="GlobalWorkspace2Domains.forward-555"><a href="#GlobalWorkspace2Domains.forward-555"><span class="linenos">555</span></a>            <span class="n">cycles</span><span class="o">=</span><span class="n">batch_cycles</span><span class="p">(</span>
</span><span id="GlobalWorkspace2Domains.forward-556"><a href="#GlobalWorkspace2Domains.forward-556"><span class="linenos">556</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_mod</span><span class="p">,</span> <span class="n">latent_domains</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_mods</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="GlobalWorkspace2Domains.forward-557"><a href="#GlobalWorkspace2Domains.forward-557"><span class="linenos">557</span></a>            <span class="p">),</span>
</span><span id="GlobalWorkspace2Domains.forward-558"><a href="#GlobalWorkspace2Domains.forward-558"><span class="linenos">558</span></a>            <span class="n">translations</span><span class="o">=</span><span class="n">batch_translations</span><span class="p">(</span>
</span><span id="GlobalWorkspace2Domains.forward-559"><a href="#GlobalWorkspace2Domains.forward-559"><span class="linenos">559</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_mod</span><span class="p">,</span> <span class="n">latent_domains</span>
</span><span id="GlobalWorkspace2Domains.forward-560"><a href="#GlobalWorkspace2Domains.forward-560"><span class="linenos">560</span></a>            <span class="p">),</span>
</span><span id="GlobalWorkspace2Domains.forward-561"><a href="#GlobalWorkspace2Domains.forward-561"><span class="linenos">561</span></a>            <span class="o">**</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">latent_domains</span><span class="p">),</span>
</span><span id="GlobalWorkspace2Domains.forward-562"><a href="#GlobalWorkspace2Domains.forward-562"><span class="linenos">562</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Computes demi-cycles, cycles, and translations.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>latent_domains (<code>LatentsT</code>):</strong>  Groups of domains for the computation.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p><code><a href="#GWPredictions">GWPredictions</a></code>: the predictions on the batch.</p>
</blockquote>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#GlobalWorkspaceBase">GlobalWorkspaceBase</a></dt>
                                <dd id="GlobalWorkspace2Domains.gw_mod" class="variable"><a href="#GlobalWorkspaceBase.gw_mod">gw_mod</a></dd>
                <dd id="GlobalWorkspace2Domains.selection_mod" class="variable"><a href="#GlobalWorkspaceBase.selection_mod">selection_mod</a></dd>
                <dd id="GlobalWorkspace2Domains.loss_mod" class="variable"><a href="#GlobalWorkspaceBase.loss_mod">loss_mod</a></dd>
                <dd id="GlobalWorkspace2Domains.optim_lr" class="variable"><a href="#GlobalWorkspaceBase.optim_lr">optim_lr</a></dd>
                <dd id="GlobalWorkspace2Domains.optim_weight_decay" class="variable"><a href="#GlobalWorkspaceBase.optim_weight_decay">optim_weight_decay</a></dd>
                <dd id="GlobalWorkspace2Domains.scheduler_args" class="variable"><a href="#GlobalWorkspaceBase.scheduler_args">scheduler_args</a></dd>
                <dd id="GlobalWorkspace2Domains.domain_mods" class="variable"><a href="#GlobalWorkspaceBase.domain_mods">domain_mods</a></dd>
                <dd id="GlobalWorkspace2Domains.workspace_dim" class="variable"><a href="#GlobalWorkspaceBase.workspace_dim">workspace_dim</a></dd>
                <dd id="GlobalWorkspace2Domains.encode_and_fuse" class="function"><a href="#GlobalWorkspaceBase.encode_and_fuse">encode_and_fuse</a></dd>
                <dd id="GlobalWorkspace2Domains.encode" class="function"><a href="#GlobalWorkspaceBase.encode">encode</a></dd>
                <dd id="GlobalWorkspace2Domains.fuse" class="function"><a href="#GlobalWorkspaceBase.fuse">fuse</a></dd>
                <dd id="GlobalWorkspace2Domains.decode" class="function"><a href="#GlobalWorkspaceBase.decode">decode</a></dd>
                <dd id="GlobalWorkspace2Domains.batch_gw_states" class="function"><a href="#GlobalWorkspaceBase.batch_gw_states">batch_gw_states</a></dd>
                <dd id="GlobalWorkspace2Domains.encode_domain" class="function"><a href="#GlobalWorkspaceBase.encode_domain">encode_domain</a></dd>
                <dd id="GlobalWorkspace2Domains.encode_domains" class="function"><a href="#GlobalWorkspaceBase.encode_domains">encode_domains</a></dd>
                <dd id="GlobalWorkspace2Domains.decode_domain" class="function"><a href="#GlobalWorkspaceBase.decode_domain">decode_domain</a></dd>
                <dd id="GlobalWorkspace2Domains.decode_domains" class="function"><a href="#GlobalWorkspaceBase.decode_domains">decode_domains</a></dd>
                <dd id="GlobalWorkspace2Domains.generic_step" class="function"><a href="#GlobalWorkspaceBase.generic_step">generic_step</a></dd>
                <dd id="GlobalWorkspace2Domains.validation_step" class="function"><a href="#GlobalWorkspaceBase.validation_step">validation_step</a></dd>
                <dd id="GlobalWorkspace2Domains.test_step" class="function"><a href="#GlobalWorkspaceBase.test_step">test_step</a></dd>
                <dd id="GlobalWorkspace2Domains.training_step" class="function"><a href="#GlobalWorkspaceBase.training_step">training_step</a></dd>
                <dd id="GlobalWorkspace2Domains.predict_step" class="function"><a href="#GlobalWorkspaceBase.predict_step">predict_step</a></dd>
                <dd id="GlobalWorkspace2Domains.configure_optimizers" class="function"><a href="#GlobalWorkspaceBase.configure_optimizers">configure_optimizers</a></dd>

            </div>
            <div><dt>lightning.pytorch.core.module.LightningModule</dt>
                                <dd id="GlobalWorkspace2Domains.CHECKPOINT_HYPER_PARAMS_KEY" class="variable">CHECKPOINT_HYPER_PARAMS_KEY</dd>
                <dd id="GlobalWorkspace2Domains.CHECKPOINT_HYPER_PARAMS_NAME" class="variable">CHECKPOINT_HYPER_PARAMS_NAME</dd>
                <dd id="GlobalWorkspace2Domains.CHECKPOINT_HYPER_PARAMS_TYPE" class="variable">CHECKPOINT_HYPER_PARAMS_TYPE</dd>
                <dd id="GlobalWorkspace2Domains.optimizers" class="function">optimizers</dd>
                <dd id="GlobalWorkspace2Domains.lr_schedulers" class="function">lr_schedulers</dd>
                <dd id="GlobalWorkspace2Domains.trainer" class="variable">trainer</dd>
                <dd id="GlobalWorkspace2Domains.fabric" class="variable">fabric</dd>
                <dd id="GlobalWorkspace2Domains.example_input_array" class="variable">example_input_array</dd>
                <dd id="GlobalWorkspace2Domains.current_epoch" class="variable">current_epoch</dd>
                <dd id="GlobalWorkspace2Domains.global_step" class="variable">global_step</dd>
                <dd id="GlobalWorkspace2Domains.global_rank" class="variable">global_rank</dd>
                <dd id="GlobalWorkspace2Domains.local_rank" class="variable">local_rank</dd>
                <dd id="GlobalWorkspace2Domains.on_gpu" class="variable">on_gpu</dd>
                <dd id="GlobalWorkspace2Domains.automatic_optimization" class="variable">automatic_optimization</dd>
                <dd id="GlobalWorkspace2Domains.strict_loading" class="variable">strict_loading</dd>
                <dd id="GlobalWorkspace2Domains.logger" class="variable">logger</dd>
                <dd id="GlobalWorkspace2Domains.loggers" class="variable">loggers</dd>
                <dd id="GlobalWorkspace2Domains.print" class="function">print</dd>
                <dd id="GlobalWorkspace2Domains.log" class="function">log</dd>
                <dd id="GlobalWorkspace2Domains.log_dict" class="function">log_dict</dd>
                <dd id="GlobalWorkspace2Domains.all_gather" class="function">all_gather</dd>
                <dd id="GlobalWorkspace2Domains.configure_callbacks" class="function">configure_callbacks</dd>
                <dd id="GlobalWorkspace2Domains.manual_backward" class="function">manual_backward</dd>
                <dd id="GlobalWorkspace2Domains.backward" class="function">backward</dd>
                <dd id="GlobalWorkspace2Domains.toggle_optimizer" class="function">toggle_optimizer</dd>
                <dd id="GlobalWorkspace2Domains.untoggle_optimizer" class="function">untoggle_optimizer</dd>
                <dd id="GlobalWorkspace2Domains.clip_gradients" class="function">clip_gradients</dd>
                <dd id="GlobalWorkspace2Domains.configure_gradient_clipping" class="function">configure_gradient_clipping</dd>
                <dd id="GlobalWorkspace2Domains.lr_scheduler_step" class="function">lr_scheduler_step</dd>
                <dd id="GlobalWorkspace2Domains.optimizer_step" class="function">optimizer_step</dd>
                <dd id="GlobalWorkspace2Domains.optimizer_zero_grad" class="function">optimizer_zero_grad</dd>
                <dd id="GlobalWorkspace2Domains.freeze" class="function">freeze</dd>
                <dd id="GlobalWorkspace2Domains.unfreeze" class="function">unfreeze</dd>
                <dd id="GlobalWorkspace2Domains.to_onnx" class="function">to_onnx</dd>
                <dd id="GlobalWorkspace2Domains.to_torchscript" class="function">to_torchscript</dd>
                <dd id="GlobalWorkspace2Domains.load_from_checkpoint" class="function">load_from_checkpoint</dd>

            </div>
            <div><dt>lightning.fabric.utilities.device_dtype_mixin._DeviceDtypeModuleMixin</dt>
                                <dd id="GlobalWorkspace2Domains.dtype" class="variable">dtype</dd>
                <dd id="GlobalWorkspace2Domains.device" class="variable">device</dd>
                <dd id="GlobalWorkspace2Domains.to" class="function">to</dd>
                <dd id="GlobalWorkspace2Domains.cuda" class="function">cuda</dd>
                <dd id="GlobalWorkspace2Domains.cpu" class="function">cpu</dd>
                <dd id="GlobalWorkspace2Domains.type" class="function">type</dd>
                <dd id="GlobalWorkspace2Domains.float" class="function">float</dd>
                <dd id="GlobalWorkspace2Domains.double" class="function">double</dd>
                <dd id="GlobalWorkspace2Domains.half" class="function">half</dd>

            </div>
            <div><dt>lightning.pytorch.core.mixins.hparams_mixin.HyperparametersMixin</dt>
                                <dd id="GlobalWorkspace2Domains.save_hyperparameters" class="function">save_hyperparameters</dd>
                <dd id="GlobalWorkspace2Domains.hparams" class="variable">hparams</dd>
                <dd id="GlobalWorkspace2Domains.hparams_initial" class="variable">hparams_initial</dd>

            </div>
            <div><dt>lightning.pytorch.core.hooks.ModelHooks</dt>
                                <dd id="GlobalWorkspace2Domains.on_fit_start" class="function">on_fit_start</dd>
                <dd id="GlobalWorkspace2Domains.on_fit_end" class="function">on_fit_end</dd>
                <dd id="GlobalWorkspace2Domains.on_train_start" class="function">on_train_start</dd>
                <dd id="GlobalWorkspace2Domains.on_train_end" class="function">on_train_end</dd>
                <dd id="GlobalWorkspace2Domains.on_validation_start" class="function">on_validation_start</dd>
                <dd id="GlobalWorkspace2Domains.on_validation_end" class="function">on_validation_end</dd>
                <dd id="GlobalWorkspace2Domains.on_test_start" class="function">on_test_start</dd>
                <dd id="GlobalWorkspace2Domains.on_test_end" class="function">on_test_end</dd>
                <dd id="GlobalWorkspace2Domains.on_predict_start" class="function">on_predict_start</dd>
                <dd id="GlobalWorkspace2Domains.on_predict_end" class="function">on_predict_end</dd>
                <dd id="GlobalWorkspace2Domains.on_train_batch_start" class="function">on_train_batch_start</dd>
                <dd id="GlobalWorkspace2Domains.on_train_batch_end" class="function">on_train_batch_end</dd>
                <dd id="GlobalWorkspace2Domains.on_validation_batch_start" class="function">on_validation_batch_start</dd>
                <dd id="GlobalWorkspace2Domains.on_validation_batch_end" class="function">on_validation_batch_end</dd>
                <dd id="GlobalWorkspace2Domains.on_test_batch_start" class="function">on_test_batch_start</dd>
                <dd id="GlobalWorkspace2Domains.on_test_batch_end" class="function">on_test_batch_end</dd>
                <dd id="GlobalWorkspace2Domains.on_predict_batch_start" class="function">on_predict_batch_start</dd>
                <dd id="GlobalWorkspace2Domains.on_predict_batch_end" class="function">on_predict_batch_end</dd>
                <dd id="GlobalWorkspace2Domains.on_validation_model_zero_grad" class="function">on_validation_model_zero_grad</dd>
                <dd id="GlobalWorkspace2Domains.on_validation_model_eval" class="function">on_validation_model_eval</dd>
                <dd id="GlobalWorkspace2Domains.on_validation_model_train" class="function">on_validation_model_train</dd>
                <dd id="GlobalWorkspace2Domains.on_test_model_eval" class="function">on_test_model_eval</dd>
                <dd id="GlobalWorkspace2Domains.on_test_model_train" class="function">on_test_model_train</dd>
                <dd id="GlobalWorkspace2Domains.on_predict_model_eval" class="function">on_predict_model_eval</dd>
                <dd id="GlobalWorkspace2Domains.on_train_epoch_start" class="function">on_train_epoch_start</dd>
                <dd id="GlobalWorkspace2Domains.on_train_epoch_end" class="function">on_train_epoch_end</dd>
                <dd id="GlobalWorkspace2Domains.on_validation_epoch_start" class="function">on_validation_epoch_start</dd>
                <dd id="GlobalWorkspace2Domains.on_validation_epoch_end" class="function">on_validation_epoch_end</dd>
                <dd id="GlobalWorkspace2Domains.on_test_epoch_start" class="function">on_test_epoch_start</dd>
                <dd id="GlobalWorkspace2Domains.on_test_epoch_end" class="function">on_test_epoch_end</dd>
                <dd id="GlobalWorkspace2Domains.on_predict_epoch_start" class="function">on_predict_epoch_start</dd>
                <dd id="GlobalWorkspace2Domains.on_predict_epoch_end" class="function">on_predict_epoch_end</dd>
                <dd id="GlobalWorkspace2Domains.on_before_zero_grad" class="function">on_before_zero_grad</dd>
                <dd id="GlobalWorkspace2Domains.on_before_backward" class="function">on_before_backward</dd>
                <dd id="GlobalWorkspace2Domains.on_after_backward" class="function">on_after_backward</dd>
                <dd id="GlobalWorkspace2Domains.on_before_optimizer_step" class="function">on_before_optimizer_step</dd>
                <dd id="GlobalWorkspace2Domains.configure_sharded_model" class="function">configure_sharded_model</dd>
                <dd id="GlobalWorkspace2Domains.configure_model" class="function">configure_model</dd>

            </div>
            <div><dt>lightning.pytorch.core.hooks.DataHooks</dt>
                                <dd id="GlobalWorkspace2Domains.prepare_data_per_node" class="variable">prepare_data_per_node</dd>
                <dd id="GlobalWorkspace2Domains.allow_zero_length_dataloader_with_multiple_devices" class="variable">allow_zero_length_dataloader_with_multiple_devices</dd>
                <dd id="GlobalWorkspace2Domains.prepare_data" class="function">prepare_data</dd>
                <dd id="GlobalWorkspace2Domains.setup" class="function">setup</dd>
                <dd id="GlobalWorkspace2Domains.teardown" class="function">teardown</dd>
                <dd id="GlobalWorkspace2Domains.train_dataloader" class="function">train_dataloader</dd>
                <dd id="GlobalWorkspace2Domains.test_dataloader" class="function">test_dataloader</dd>
                <dd id="GlobalWorkspace2Domains.val_dataloader" class="function">val_dataloader</dd>
                <dd id="GlobalWorkspace2Domains.predict_dataloader" class="function">predict_dataloader</dd>
                <dd id="GlobalWorkspace2Domains.transfer_batch_to_device" class="function">transfer_batch_to_device</dd>
                <dd id="GlobalWorkspace2Domains.on_before_batch_transfer" class="function">on_before_batch_transfer</dd>
                <dd id="GlobalWorkspace2Domains.on_after_batch_transfer" class="function">on_after_batch_transfer</dd>

            </div>
            <div><dt>lightning.pytorch.core.hooks.CheckpointHooks</dt>
                                <dd id="GlobalWorkspace2Domains.on_load_checkpoint" class="function">on_load_checkpoint</dd>
                <dd id="GlobalWorkspace2Domains.on_save_checkpoint" class="function">on_save_checkpoint</dd>

            </div>
            <div><dt>torch.nn.modules.module.Module</dt>
                                <dd id="GlobalWorkspace2Domains.dump_patches" class="variable">dump_patches</dd>
                <dd id="GlobalWorkspace2Domains.training" class="variable">training</dd>
                <dd id="GlobalWorkspace2Domains.call_super_init" class="variable">call_super_init</dd>
                <dd id="GlobalWorkspace2Domains.register_buffer" class="function">register_buffer</dd>
                <dd id="GlobalWorkspace2Domains.register_parameter" class="function">register_parameter</dd>
                <dd id="GlobalWorkspace2Domains.add_module" class="function">add_module</dd>
                <dd id="GlobalWorkspace2Domains.register_module" class="function">register_module</dd>
                <dd id="GlobalWorkspace2Domains.get_submodule" class="function">get_submodule</dd>
                <dd id="GlobalWorkspace2Domains.get_parameter" class="function">get_parameter</dd>
                <dd id="GlobalWorkspace2Domains.get_buffer" class="function">get_buffer</dd>
                <dd id="GlobalWorkspace2Domains.get_extra_state" class="function">get_extra_state</dd>
                <dd id="GlobalWorkspace2Domains.set_extra_state" class="function">set_extra_state</dd>
                <dd id="GlobalWorkspace2Domains.apply" class="function">apply</dd>
                <dd id="GlobalWorkspace2Domains.ipu" class="function">ipu</dd>
                <dd id="GlobalWorkspace2Domains.xpu" class="function">xpu</dd>
                <dd id="GlobalWorkspace2Domains.bfloat16" class="function">bfloat16</dd>
                <dd id="GlobalWorkspace2Domains.to_empty" class="function">to_empty</dd>
                <dd id="GlobalWorkspace2Domains.register_full_backward_pre_hook" class="function">register_full_backward_pre_hook</dd>
                <dd id="GlobalWorkspace2Domains.register_backward_hook" class="function">register_backward_hook</dd>
                <dd id="GlobalWorkspace2Domains.register_full_backward_hook" class="function">register_full_backward_hook</dd>
                <dd id="GlobalWorkspace2Domains.register_forward_pre_hook" class="function">register_forward_pre_hook</dd>
                <dd id="GlobalWorkspace2Domains.register_forward_hook" class="function">register_forward_hook</dd>
                <dd id="GlobalWorkspace2Domains.register_state_dict_pre_hook" class="function">register_state_dict_pre_hook</dd>
                <dd id="GlobalWorkspace2Domains.state_dict" class="function">state_dict</dd>
                <dd id="GlobalWorkspace2Domains.register_load_state_dict_post_hook" class="function">register_load_state_dict_post_hook</dd>
                <dd id="GlobalWorkspace2Domains.load_state_dict" class="function">load_state_dict</dd>
                <dd id="GlobalWorkspace2Domains.parameters" class="function">parameters</dd>
                <dd id="GlobalWorkspace2Domains.named_parameters" class="function">named_parameters</dd>
                <dd id="GlobalWorkspace2Domains.buffers" class="function">buffers</dd>
                <dd id="GlobalWorkspace2Domains.named_buffers" class="function">named_buffers</dd>
                <dd id="GlobalWorkspace2Domains.children" class="function">children</dd>
                <dd id="GlobalWorkspace2Domains.named_children" class="function">named_children</dd>
                <dd id="GlobalWorkspace2Domains.modules" class="function">modules</dd>
                <dd id="GlobalWorkspace2Domains.named_modules" class="function">named_modules</dd>
                <dd id="GlobalWorkspace2Domains.train" class="function">train</dd>
                <dd id="GlobalWorkspace2Domains.eval" class="function">eval</dd>
                <dd id="GlobalWorkspace2Domains.requires_grad_" class="function">requires_grad_</dd>
                <dd id="GlobalWorkspace2Domains.zero_grad" class="function">zero_grad</dd>
                <dd id="GlobalWorkspace2Domains.share_memory" class="function">share_memory</dd>
                <dd id="GlobalWorkspace2Domains.extra_repr" class="function">extra_repr</dd>
                <dd id="GlobalWorkspace2Domains.compile" class="function">compile</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="GlobalWorkspace">
                            <input id="GlobalWorkspace-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">GlobalWorkspace</span><wbr>(<span class="base"><a href="#GlobalWorkspaceBase">shimmer.modules.global_workspace.GlobalWorkspaceBase[shimmer.modules.gw_module.GWModule, shimmer.modules.selection.RandomSelection, shimmer.modules.losses.GWLosses]</a></span>):

                <label class="view-source-button" for="GlobalWorkspace-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GlobalWorkspace"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GlobalWorkspace-565"><a href="#GlobalWorkspace-565"><span class="linenos">565</span></a><span class="k">class</span> <span class="nc">GlobalWorkspace</span><span class="p">(</span><span class="n">GlobalWorkspaceBase</span><span class="p">[</span><span class="n">GWModule</span><span class="p">,</span> <span class="n">RandomSelection</span><span class="p">,</span> <span class="n">GWLosses</span><span class="p">]):</span>
</span><span id="GlobalWorkspace-566"><a href="#GlobalWorkspace-566"><span class="linenos">566</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The 2-domain fusion (with broadcast loss) flavor of GlobalWorkspaceBase.</span>
</span><span id="GlobalWorkspace-567"><a href="#GlobalWorkspace-567"><span class="linenos">567</span></a>
</span><span id="GlobalWorkspace-568"><a href="#GlobalWorkspace-568"><span class="linenos">568</span></a><span class="sd">    This is used to simplify a Global Workspace instanciation and only overrides the</span>
</span><span id="GlobalWorkspace-569"><a href="#GlobalWorkspace-569"><span class="linenos">569</span></a><span class="sd">    `__init__` method.</span>
</span><span id="GlobalWorkspace-570"><a href="#GlobalWorkspace-570"><span class="linenos">570</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="GlobalWorkspace-571"><a href="#GlobalWorkspace-571"><span class="linenos">571</span></a>
</span><span id="GlobalWorkspace-572"><a href="#GlobalWorkspace-572"><span class="linenos">572</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="GlobalWorkspace-573"><a href="#GlobalWorkspace-573"><span class="linenos">573</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GlobalWorkspace-574"><a href="#GlobalWorkspace-574"><span class="linenos">574</span></a>        <span class="n">domain_mods</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DomainModule</span><span class="p">],</span>
</span><span id="GlobalWorkspace-575"><a href="#GlobalWorkspace-575"><span class="linenos">575</span></a>        <span class="n">gw_encoders</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Module</span><span class="p">],</span>
</span><span id="GlobalWorkspace-576"><a href="#GlobalWorkspace-576"><span class="linenos">576</span></a>        <span class="n">gw_decoders</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Module</span><span class="p">],</span>
</span><span id="GlobalWorkspace-577"><a href="#GlobalWorkspace-577"><span class="linenos">577</span></a>        <span class="n">workspace_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="GlobalWorkspace-578"><a href="#GlobalWorkspace-578"><span class="linenos">578</span></a>        <span class="n">loss_coefs</span><span class="p">:</span> <span class="n">BroadcastLossCoefs</span><span class="p">,</span>
</span><span id="GlobalWorkspace-579"><a href="#GlobalWorkspace-579"><span class="linenos">579</span></a>        <span class="n">selection_temperature</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
</span><span id="GlobalWorkspace-580"><a href="#GlobalWorkspace-580"><span class="linenos">580</span></a>        <span class="n">optim_lr</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">,</span>
</span><span id="GlobalWorkspace-581"><a href="#GlobalWorkspace-581"><span class="linenos">581</span></a>        <span class="n">optim_weight_decay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="GlobalWorkspace-582"><a href="#GlobalWorkspace-582"><span class="linenos">582</span></a>        <span class="n">scheduler_args</span><span class="p">:</span> <span class="n">SchedulerArgs</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GlobalWorkspace-583"><a href="#GlobalWorkspace-583"><span class="linenos">583</span></a>        <span class="n">learn_logit_scale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="GlobalWorkspace-584"><a href="#GlobalWorkspace-584"><span class="linenos">584</span></a>        <span class="n">contrastive_loss</span><span class="p">:</span> <span class="n">ContrastiveLossType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GlobalWorkspace-585"><a href="#GlobalWorkspace-585"><span class="linenos">585</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GlobalWorkspace-586"><a href="#GlobalWorkspace-586"><span class="linenos">586</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspace-587"><a href="#GlobalWorkspace-587"><span class="linenos">587</span></a><span class="sd">        Initializes a Global Workspace</span>
</span><span id="GlobalWorkspace-588"><a href="#GlobalWorkspace-588"><span class="linenos">588</span></a>
</span><span id="GlobalWorkspace-589"><a href="#GlobalWorkspace-589"><span class="linenos">589</span></a><span class="sd">        Args:</span>
</span><span id="GlobalWorkspace-590"><a href="#GlobalWorkspace-590"><span class="linenos">590</span></a><span class="sd">            domain_mods (`Mapping[str, DomainModule]`): mapping of the domains</span>
</span><span id="GlobalWorkspace-591"><a href="#GlobalWorkspace-591"><span class="linenos">591</span></a><span class="sd">                connected to the GW. Keys are domain names, values are the</span>
</span><span id="GlobalWorkspace-592"><a href="#GlobalWorkspace-592"><span class="linenos">592</span></a><span class="sd">                `DomainModule`.</span>
</span><span id="GlobalWorkspace-593"><a href="#GlobalWorkspace-593"><span class="linenos">593</span></a><span class="sd">            gw_encoders (`Mapping[str, torch.nn.Module]`): mapping for each domain</span>
</span><span id="GlobalWorkspace-594"><a href="#GlobalWorkspace-594"><span class="linenos">594</span></a><span class="sd">                name to a `torch.nn.Module` class which role is to encode a</span>
</span><span id="GlobalWorkspace-595"><a href="#GlobalWorkspace-595"><span class="linenos">595</span></a><span class="sd">                unimodal latent representations into a GW representation (pre fusion).</span>
</span><span id="GlobalWorkspace-596"><a href="#GlobalWorkspace-596"><span class="linenos">596</span></a><span class="sd">            gw_decoders (`Mapping[str, torch.nn.Module]`): mapping for each domain</span>
</span><span id="GlobalWorkspace-597"><a href="#GlobalWorkspace-597"><span class="linenos">597</span></a><span class="sd">                name to a `torch.nn.Module` class which role is to decode a</span>
</span><span id="GlobalWorkspace-598"><a href="#GlobalWorkspace-598"><span class="linenos">598</span></a><span class="sd">                GW representation into a unimodal latent representations.</span>
</span><span id="GlobalWorkspace-599"><a href="#GlobalWorkspace-599"><span class="linenos">599</span></a><span class="sd">            workspace_dim (`int`): dimension of the GW.</span>
</span><span id="GlobalWorkspace-600"><a href="#GlobalWorkspace-600"><span class="linenos">600</span></a><span class="sd">            loss_coefs (`BroadcastLossCoefs`): loss coefs for the losses.</span>
</span><span id="GlobalWorkspace-601"><a href="#GlobalWorkspace-601"><span class="linenos">601</span></a><span class="sd">            selection_temperature (`float`): temperature value for the RandomSelection</span>
</span><span id="GlobalWorkspace-602"><a href="#GlobalWorkspace-602"><span class="linenos">602</span></a><span class="sd">                module.</span>
</span><span id="GlobalWorkspace-603"><a href="#GlobalWorkspace-603"><span class="linenos">603</span></a><span class="sd">            optim_lr (`float`): learning rate</span>
</span><span id="GlobalWorkspace-604"><a href="#GlobalWorkspace-604"><span class="linenos">604</span></a><span class="sd">            optim_weight_decay (`float`): weight decay</span>
</span><span id="GlobalWorkspace-605"><a href="#GlobalWorkspace-605"><span class="linenos">605</span></a><span class="sd">            scheduler_args (`SchedulerArgs | None`): optimization scheduler&#39;s arguments</span>
</span><span id="GlobalWorkspace-606"><a href="#GlobalWorkspace-606"><span class="linenos">606</span></a><span class="sd">            learn_logit_scale (`bool`): whether to learn the contrastive learning</span>
</span><span id="GlobalWorkspace-607"><a href="#GlobalWorkspace-607"><span class="linenos">607</span></a><span class="sd">                contrastive loss when using the default contrastive loss.</span>
</span><span id="GlobalWorkspace-608"><a href="#GlobalWorkspace-608"><span class="linenos">608</span></a><span class="sd">            contrastive_loss (`ContrastiveLossType | None`): a contrastive loss</span>
</span><span id="GlobalWorkspace-609"><a href="#GlobalWorkspace-609"><span class="linenos">609</span></a><span class="sd">                function used for alignment. `learn_logit_scale` will not affect custom</span>
</span><span id="GlobalWorkspace-610"><a href="#GlobalWorkspace-610"><span class="linenos">610</span></a><span class="sd">                contrastive losses.</span>
</span><span id="GlobalWorkspace-611"><a href="#GlobalWorkspace-611"><span class="linenos">611</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GlobalWorkspace-612"><a href="#GlobalWorkspace-612"><span class="linenos">612</span></a>        <span class="n">domain_mods</span> <span class="o">=</span> <span class="n">freeze_domain_modules</span><span class="p">(</span><span class="n">domain_mods</span><span class="p">)</span>
</span><span id="GlobalWorkspace-613"><a href="#GlobalWorkspace-613"><span class="linenos">613</span></a>        <span class="n">gw_mod</span> <span class="o">=</span> <span class="n">GWModule</span><span class="p">(</span><span class="n">domain_mods</span><span class="p">,</span> <span class="n">workspace_dim</span><span class="p">,</span> <span class="n">gw_encoders</span><span class="p">,</span> <span class="n">gw_decoders</span><span class="p">)</span>
</span><span id="GlobalWorkspace-614"><a href="#GlobalWorkspace-614"><span class="linenos">614</span></a>
</span><span id="GlobalWorkspace-615"><a href="#GlobalWorkspace-615"><span class="linenos">615</span></a>        <span class="k">if</span> <span class="n">contrastive_loss</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GlobalWorkspace-616"><a href="#GlobalWorkspace-616"><span class="linenos">616</span></a>            <span class="n">contrastive_loss</span> <span class="o">=</span> <span class="n">ContrastiveLoss</span><span class="p">(</span>
</span><span id="GlobalWorkspace-617"><a href="#GlobalWorkspace-617"><span class="linenos">617</span></a>                <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">1</span> <span class="o">/</span> <span class="mf">0.07</span><span class="p">])</span><span class="o">.</span><span class="n">log</span><span class="p">(),</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="n">learn_logit_scale</span>
</span><span id="GlobalWorkspace-618"><a href="#GlobalWorkspace-618"><span class="linenos">618</span></a>            <span class="p">)</span>
</span><span id="GlobalWorkspace-619"><a href="#GlobalWorkspace-619"><span class="linenos">619</span></a>
</span><span id="GlobalWorkspace-620"><a href="#GlobalWorkspace-620"><span class="linenos">620</span></a>        <span class="n">selection_mod</span> <span class="o">=</span> <span class="n">RandomSelection</span><span class="p">(</span><span class="n">selection_temperature</span><span class="p">)</span>
</span><span id="GlobalWorkspace-621"><a href="#GlobalWorkspace-621"><span class="linenos">621</span></a>        <span class="n">loss_mod</span> <span class="o">=</span> <span class="n">GWLosses</span><span class="p">(</span>
</span><span id="GlobalWorkspace-622"><a href="#GlobalWorkspace-622"><span class="linenos">622</span></a>            <span class="n">gw_mod</span><span class="p">,</span> <span class="n">selection_mod</span><span class="p">,</span> <span class="n">domain_mods</span><span class="p">,</span> <span class="n">loss_coefs</span><span class="p">,</span> <span class="n">contrastive_loss</span>
</span><span id="GlobalWorkspace-623"><a href="#GlobalWorkspace-623"><span class="linenos">623</span></a>        <span class="p">)</span>
</span><span id="GlobalWorkspace-624"><a href="#GlobalWorkspace-624"><span class="linenos">624</span></a>
</span><span id="GlobalWorkspace-625"><a href="#GlobalWorkspace-625"><span class="linenos">625</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="GlobalWorkspace-626"><a href="#GlobalWorkspace-626"><span class="linenos">626</span></a>            <span class="n">gw_mod</span><span class="p">,</span>
</span><span id="GlobalWorkspace-627"><a href="#GlobalWorkspace-627"><span class="linenos">627</span></a>            <span class="n">selection_mod</span><span class="p">,</span>
</span><span id="GlobalWorkspace-628"><a href="#GlobalWorkspace-628"><span class="linenos">628</span></a>            <span class="n">loss_mod</span><span class="p">,</span>
</span><span id="GlobalWorkspace-629"><a href="#GlobalWorkspace-629"><span class="linenos">629</span></a>            <span class="n">optim_lr</span><span class="p">,</span>
</span><span id="GlobalWorkspace-630"><a href="#GlobalWorkspace-630"><span class="linenos">630</span></a>            <span class="n">optim_weight_decay</span><span class="p">,</span>
</span><span id="GlobalWorkspace-631"><a href="#GlobalWorkspace-631"><span class="linenos">631</span></a>            <span class="n">scheduler_args</span><span class="p">,</span>
</span><span id="GlobalWorkspace-632"><a href="#GlobalWorkspace-632"><span class="linenos">632</span></a>        <span class="p">)</span>
</span><span id="GlobalWorkspace-633"><a href="#GlobalWorkspace-633"><span class="linenos">633</span></a>
</span><span id="GlobalWorkspace-634"><a href="#GlobalWorkspace-634"><span class="linenos">634</span></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="GlobalWorkspace-635"><a href="#GlobalWorkspace-635"><span class="linenos">635</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GlobalWorkspace-636"><a href="#GlobalWorkspace-636"><span class="linenos">636</span></a>        <span class="n">latent_domains</span><span class="p">:</span> <span class="n">LatentsDomainGroupsT</span><span class="p">,</span>
</span><span id="GlobalWorkspace-637"><a href="#GlobalWorkspace-637"><span class="linenos">637</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GWPredictions</span><span class="p">:</span>
</span><span id="GlobalWorkspace-638"><a href="#GlobalWorkspace-638"><span class="linenos">638</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspace-639"><a href="#GlobalWorkspace-639"><span class="linenos">639</span></a><span class="sd">        Computes demi-cycles, cycles, and translations.</span>
</span><span id="GlobalWorkspace-640"><a href="#GlobalWorkspace-640"><span class="linenos">640</span></a>
</span><span id="GlobalWorkspace-641"><a href="#GlobalWorkspace-641"><span class="linenos">641</span></a><span class="sd">        Args:</span>
</span><span id="GlobalWorkspace-642"><a href="#GlobalWorkspace-642"><span class="linenos">642</span></a><span class="sd">            latent_domains (`LatentsT`): Groups of domains for the computation.</span>
</span><span id="GlobalWorkspace-643"><a href="#GlobalWorkspace-643"><span class="linenos">643</span></a>
</span><span id="GlobalWorkspace-644"><a href="#GlobalWorkspace-644"><span class="linenos">644</span></a><span class="sd">        Returns:</span>
</span><span id="GlobalWorkspace-645"><a href="#GlobalWorkspace-645"><span class="linenos">645</span></a><span class="sd">            `GWPredictions`: the predictions on the batch.</span>
</span><span id="GlobalWorkspace-646"><a href="#GlobalWorkspace-646"><span class="linenos">646</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GlobalWorkspace-647"><a href="#GlobalWorkspace-647"><span class="linenos">647</span></a>        <span class="k">return</span> <span class="n">GWPredictions</span><span class="p">(</span>
</span><span id="GlobalWorkspace-648"><a href="#GlobalWorkspace-648"><span class="linenos">648</span></a>            <span class="n">demi_cycles</span><span class="o">=</span><span class="n">batch_demi_cycles</span><span class="p">(</span>
</span><span id="GlobalWorkspace-649"><a href="#GlobalWorkspace-649"><span class="linenos">649</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_mod</span><span class="p">,</span> <span class="n">latent_domains</span>
</span><span id="GlobalWorkspace-650"><a href="#GlobalWorkspace-650"><span class="linenos">650</span></a>            <span class="p">),</span>
</span><span id="GlobalWorkspace-651"><a href="#GlobalWorkspace-651"><span class="linenos">651</span></a>            <span class="n">cycles</span><span class="o">=</span><span class="n">batch_cycles</span><span class="p">(</span>
</span><span id="GlobalWorkspace-652"><a href="#GlobalWorkspace-652"><span class="linenos">652</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_mod</span><span class="p">,</span> <span class="n">latent_domains</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_mods</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="GlobalWorkspace-653"><a href="#GlobalWorkspace-653"><span class="linenos">653</span></a>            <span class="p">),</span>
</span><span id="GlobalWorkspace-654"><a href="#GlobalWorkspace-654"><span class="linenos">654</span></a>            <span class="n">translations</span><span class="o">=</span><span class="n">batch_translations</span><span class="p">(</span>
</span><span id="GlobalWorkspace-655"><a href="#GlobalWorkspace-655"><span class="linenos">655</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_mod</span><span class="p">,</span> <span class="n">latent_domains</span>
</span><span id="GlobalWorkspace-656"><a href="#GlobalWorkspace-656"><span class="linenos">656</span></a>            <span class="p">),</span>
</span><span id="GlobalWorkspace-657"><a href="#GlobalWorkspace-657"><span class="linenos">657</span></a>            <span class="c1"># TODO: add other combinations</span>
</span><span id="GlobalWorkspace-658"><a href="#GlobalWorkspace-658"><span class="linenos">658</span></a>            <span class="o">**</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">latent_domains</span><span class="p">),</span>
</span><span id="GlobalWorkspace-659"><a href="#GlobalWorkspace-659"><span class="linenos">659</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The 2-domain fusion (with broadcast loss) flavor of GlobalWorkspaceBase.</p>

<p>This is used to simplify a Global Workspace instanciation and only overrides the
<code><a href="#GlobalWorkspace.__init__">__init__</a></code> method.</p>
</div>


                            <div id="GlobalWorkspace.__init__" class="classattr">
                                        <input id="GlobalWorkspace.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">GlobalWorkspace</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">domain_mods</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><a href="domain.html#DomainModule">shimmer.modules.domain.DomainModule</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">gw_encoders</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span>,</span><span class="param">	<span class="n">gw_decoders</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span>,</span><span class="param">	<span class="n">workspace_dim</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">loss_coefs</span><span class="p">:</span> <span class="n"><a href="losses.html#BroadcastLossCoefs">shimmer.modules.losses.BroadcastLossCoefs</a></span>,</span><span class="param">	<span class="n">selection_temperature</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span>,</span><span class="param">	<span class="n">optim_lr</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span>,</span><span class="param">	<span class="n">optim_weight_decay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>,</span><span class="param">	<span class="n">scheduler_args</span><span class="p">:</span> <span class="n"><a href="#SchedulerArgs">SchedulerArgs</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">learn_logit_scale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">contrastive_loss</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span> <span class="n"><a href="domain.html#LossOutput">shimmer.modules.domain.LossOutput</a></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="GlobalWorkspace.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GlobalWorkspace.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GlobalWorkspace.__init__-572"><a href="#GlobalWorkspace.__init__-572"><span class="linenos">572</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="GlobalWorkspace.__init__-573"><a href="#GlobalWorkspace.__init__-573"><span class="linenos">573</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GlobalWorkspace.__init__-574"><a href="#GlobalWorkspace.__init__-574"><span class="linenos">574</span></a>        <span class="n">domain_mods</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DomainModule</span><span class="p">],</span>
</span><span id="GlobalWorkspace.__init__-575"><a href="#GlobalWorkspace.__init__-575"><span class="linenos">575</span></a>        <span class="n">gw_encoders</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Module</span><span class="p">],</span>
</span><span id="GlobalWorkspace.__init__-576"><a href="#GlobalWorkspace.__init__-576"><span class="linenos">576</span></a>        <span class="n">gw_decoders</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Module</span><span class="p">],</span>
</span><span id="GlobalWorkspace.__init__-577"><a href="#GlobalWorkspace.__init__-577"><span class="linenos">577</span></a>        <span class="n">workspace_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="GlobalWorkspace.__init__-578"><a href="#GlobalWorkspace.__init__-578"><span class="linenos">578</span></a>        <span class="n">loss_coefs</span><span class="p">:</span> <span class="n">BroadcastLossCoefs</span><span class="p">,</span>
</span><span id="GlobalWorkspace.__init__-579"><a href="#GlobalWorkspace.__init__-579"><span class="linenos">579</span></a>        <span class="n">selection_temperature</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
</span><span id="GlobalWorkspace.__init__-580"><a href="#GlobalWorkspace.__init__-580"><span class="linenos">580</span></a>        <span class="n">optim_lr</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">,</span>
</span><span id="GlobalWorkspace.__init__-581"><a href="#GlobalWorkspace.__init__-581"><span class="linenos">581</span></a>        <span class="n">optim_weight_decay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="GlobalWorkspace.__init__-582"><a href="#GlobalWorkspace.__init__-582"><span class="linenos">582</span></a>        <span class="n">scheduler_args</span><span class="p">:</span> <span class="n">SchedulerArgs</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GlobalWorkspace.__init__-583"><a href="#GlobalWorkspace.__init__-583"><span class="linenos">583</span></a>        <span class="n">learn_logit_scale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="GlobalWorkspace.__init__-584"><a href="#GlobalWorkspace.__init__-584"><span class="linenos">584</span></a>        <span class="n">contrastive_loss</span><span class="p">:</span> <span class="n">ContrastiveLossType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GlobalWorkspace.__init__-585"><a href="#GlobalWorkspace.__init__-585"><span class="linenos">585</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GlobalWorkspace.__init__-586"><a href="#GlobalWorkspace.__init__-586"><span class="linenos">586</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspace.__init__-587"><a href="#GlobalWorkspace.__init__-587"><span class="linenos">587</span></a><span class="sd">        Initializes a Global Workspace</span>
</span><span id="GlobalWorkspace.__init__-588"><a href="#GlobalWorkspace.__init__-588"><span class="linenos">588</span></a>
</span><span id="GlobalWorkspace.__init__-589"><a href="#GlobalWorkspace.__init__-589"><span class="linenos">589</span></a><span class="sd">        Args:</span>
</span><span id="GlobalWorkspace.__init__-590"><a href="#GlobalWorkspace.__init__-590"><span class="linenos">590</span></a><span class="sd">            domain_mods (`Mapping[str, DomainModule]`): mapping of the domains</span>
</span><span id="GlobalWorkspace.__init__-591"><a href="#GlobalWorkspace.__init__-591"><span class="linenos">591</span></a><span class="sd">                connected to the GW. Keys are domain names, values are the</span>
</span><span id="GlobalWorkspace.__init__-592"><a href="#GlobalWorkspace.__init__-592"><span class="linenos">592</span></a><span class="sd">                `DomainModule`.</span>
</span><span id="GlobalWorkspace.__init__-593"><a href="#GlobalWorkspace.__init__-593"><span class="linenos">593</span></a><span class="sd">            gw_encoders (`Mapping[str, torch.nn.Module]`): mapping for each domain</span>
</span><span id="GlobalWorkspace.__init__-594"><a href="#GlobalWorkspace.__init__-594"><span class="linenos">594</span></a><span class="sd">                name to a `torch.nn.Module` class which role is to encode a</span>
</span><span id="GlobalWorkspace.__init__-595"><a href="#GlobalWorkspace.__init__-595"><span class="linenos">595</span></a><span class="sd">                unimodal latent representations into a GW representation (pre fusion).</span>
</span><span id="GlobalWorkspace.__init__-596"><a href="#GlobalWorkspace.__init__-596"><span class="linenos">596</span></a><span class="sd">            gw_decoders (`Mapping[str, torch.nn.Module]`): mapping for each domain</span>
</span><span id="GlobalWorkspace.__init__-597"><a href="#GlobalWorkspace.__init__-597"><span class="linenos">597</span></a><span class="sd">                name to a `torch.nn.Module` class which role is to decode a</span>
</span><span id="GlobalWorkspace.__init__-598"><a href="#GlobalWorkspace.__init__-598"><span class="linenos">598</span></a><span class="sd">                GW representation into a unimodal latent representations.</span>
</span><span id="GlobalWorkspace.__init__-599"><a href="#GlobalWorkspace.__init__-599"><span class="linenos">599</span></a><span class="sd">            workspace_dim (`int`): dimension of the GW.</span>
</span><span id="GlobalWorkspace.__init__-600"><a href="#GlobalWorkspace.__init__-600"><span class="linenos">600</span></a><span class="sd">            loss_coefs (`BroadcastLossCoefs`): loss coefs for the losses.</span>
</span><span id="GlobalWorkspace.__init__-601"><a href="#GlobalWorkspace.__init__-601"><span class="linenos">601</span></a><span class="sd">            selection_temperature (`float`): temperature value for the RandomSelection</span>
</span><span id="GlobalWorkspace.__init__-602"><a href="#GlobalWorkspace.__init__-602"><span class="linenos">602</span></a><span class="sd">                module.</span>
</span><span id="GlobalWorkspace.__init__-603"><a href="#GlobalWorkspace.__init__-603"><span class="linenos">603</span></a><span class="sd">            optim_lr (`float`): learning rate</span>
</span><span id="GlobalWorkspace.__init__-604"><a href="#GlobalWorkspace.__init__-604"><span class="linenos">604</span></a><span class="sd">            optim_weight_decay (`float`): weight decay</span>
</span><span id="GlobalWorkspace.__init__-605"><a href="#GlobalWorkspace.__init__-605"><span class="linenos">605</span></a><span class="sd">            scheduler_args (`SchedulerArgs | None`): optimization scheduler&#39;s arguments</span>
</span><span id="GlobalWorkspace.__init__-606"><a href="#GlobalWorkspace.__init__-606"><span class="linenos">606</span></a><span class="sd">            learn_logit_scale (`bool`): whether to learn the contrastive learning</span>
</span><span id="GlobalWorkspace.__init__-607"><a href="#GlobalWorkspace.__init__-607"><span class="linenos">607</span></a><span class="sd">                contrastive loss when using the default contrastive loss.</span>
</span><span id="GlobalWorkspace.__init__-608"><a href="#GlobalWorkspace.__init__-608"><span class="linenos">608</span></a><span class="sd">            contrastive_loss (`ContrastiveLossType | None`): a contrastive loss</span>
</span><span id="GlobalWorkspace.__init__-609"><a href="#GlobalWorkspace.__init__-609"><span class="linenos">609</span></a><span class="sd">                function used for alignment. `learn_logit_scale` will not affect custom</span>
</span><span id="GlobalWorkspace.__init__-610"><a href="#GlobalWorkspace.__init__-610"><span class="linenos">610</span></a><span class="sd">                contrastive losses.</span>
</span><span id="GlobalWorkspace.__init__-611"><a href="#GlobalWorkspace.__init__-611"><span class="linenos">611</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GlobalWorkspace.__init__-612"><a href="#GlobalWorkspace.__init__-612"><span class="linenos">612</span></a>        <span class="n">domain_mods</span> <span class="o">=</span> <span class="n">freeze_domain_modules</span><span class="p">(</span><span class="n">domain_mods</span><span class="p">)</span>
</span><span id="GlobalWorkspace.__init__-613"><a href="#GlobalWorkspace.__init__-613"><span class="linenos">613</span></a>        <span class="n">gw_mod</span> <span class="o">=</span> <span class="n">GWModule</span><span class="p">(</span><span class="n">domain_mods</span><span class="p">,</span> <span class="n">workspace_dim</span><span class="p">,</span> <span class="n">gw_encoders</span><span class="p">,</span> <span class="n">gw_decoders</span><span class="p">)</span>
</span><span id="GlobalWorkspace.__init__-614"><a href="#GlobalWorkspace.__init__-614"><span class="linenos">614</span></a>
</span><span id="GlobalWorkspace.__init__-615"><a href="#GlobalWorkspace.__init__-615"><span class="linenos">615</span></a>        <span class="k">if</span> <span class="n">contrastive_loss</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GlobalWorkspace.__init__-616"><a href="#GlobalWorkspace.__init__-616"><span class="linenos">616</span></a>            <span class="n">contrastive_loss</span> <span class="o">=</span> <span class="n">ContrastiveLoss</span><span class="p">(</span>
</span><span id="GlobalWorkspace.__init__-617"><a href="#GlobalWorkspace.__init__-617"><span class="linenos">617</span></a>                <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">1</span> <span class="o">/</span> <span class="mf">0.07</span><span class="p">])</span><span class="o">.</span><span class="n">log</span><span class="p">(),</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="n">learn_logit_scale</span>
</span><span id="GlobalWorkspace.__init__-618"><a href="#GlobalWorkspace.__init__-618"><span class="linenos">618</span></a>            <span class="p">)</span>
</span><span id="GlobalWorkspace.__init__-619"><a href="#GlobalWorkspace.__init__-619"><span class="linenos">619</span></a>
</span><span id="GlobalWorkspace.__init__-620"><a href="#GlobalWorkspace.__init__-620"><span class="linenos">620</span></a>        <span class="n">selection_mod</span> <span class="o">=</span> <span class="n">RandomSelection</span><span class="p">(</span><span class="n">selection_temperature</span><span class="p">)</span>
</span><span id="GlobalWorkspace.__init__-621"><a href="#GlobalWorkspace.__init__-621"><span class="linenos">621</span></a>        <span class="n">loss_mod</span> <span class="o">=</span> <span class="n">GWLosses</span><span class="p">(</span>
</span><span id="GlobalWorkspace.__init__-622"><a href="#GlobalWorkspace.__init__-622"><span class="linenos">622</span></a>            <span class="n">gw_mod</span><span class="p">,</span> <span class="n">selection_mod</span><span class="p">,</span> <span class="n">domain_mods</span><span class="p">,</span> <span class="n">loss_coefs</span><span class="p">,</span> <span class="n">contrastive_loss</span>
</span><span id="GlobalWorkspace.__init__-623"><a href="#GlobalWorkspace.__init__-623"><span class="linenos">623</span></a>        <span class="p">)</span>
</span><span id="GlobalWorkspace.__init__-624"><a href="#GlobalWorkspace.__init__-624"><span class="linenos">624</span></a>
</span><span id="GlobalWorkspace.__init__-625"><a href="#GlobalWorkspace.__init__-625"><span class="linenos">625</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="GlobalWorkspace.__init__-626"><a href="#GlobalWorkspace.__init__-626"><span class="linenos">626</span></a>            <span class="n">gw_mod</span><span class="p">,</span>
</span><span id="GlobalWorkspace.__init__-627"><a href="#GlobalWorkspace.__init__-627"><span class="linenos">627</span></a>            <span class="n">selection_mod</span><span class="p">,</span>
</span><span id="GlobalWorkspace.__init__-628"><a href="#GlobalWorkspace.__init__-628"><span class="linenos">628</span></a>            <span class="n">loss_mod</span><span class="p">,</span>
</span><span id="GlobalWorkspace.__init__-629"><a href="#GlobalWorkspace.__init__-629"><span class="linenos">629</span></a>            <span class="n">optim_lr</span><span class="p">,</span>
</span><span id="GlobalWorkspace.__init__-630"><a href="#GlobalWorkspace.__init__-630"><span class="linenos">630</span></a>            <span class="n">optim_weight_decay</span><span class="p">,</span>
</span><span id="GlobalWorkspace.__init__-631"><a href="#GlobalWorkspace.__init__-631"><span class="linenos">631</span></a>            <span class="n">scheduler_args</span><span class="p">,</span>
</span><span id="GlobalWorkspace.__init__-632"><a href="#GlobalWorkspace.__init__-632"><span class="linenos">632</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initializes a Global Workspace</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>domain_mods (<code>Mapping[str, DomainModule]</code>):</strong>  mapping of the domains
connected to the GW. Keys are domain names, values are the
<code>DomainModule</code>.</li>
<li><strong>gw_encoders (<code>Mapping[str, torch.nn.Module]</code>):</strong>  mapping for each domain
name to a <code>torch.nn.Module</code> class which role is to encode a
unimodal latent representations into a GW representation (pre fusion).</li>
<li><strong>gw_decoders (<code>Mapping[str, torch.nn.Module]</code>):</strong>  mapping for each domain
name to a <code>torch.nn.Module</code> class which role is to decode a
GW representation into a unimodal latent representations.</li>
<li><strong>workspace_dim (<code>int</code>):</strong>  dimension of the GW.</li>
<li><strong>loss_coefs (<code>BroadcastLossCoefs</code>):</strong>  loss coefs for the losses.</li>
<li><strong>selection_temperature (<code><a href="#GlobalWorkspace.float">float</a></code>):</strong>  temperature value for the RandomSelection
module.</li>
<li><strong>optim_lr (<code><a href="#GlobalWorkspace.float">float</a></code>):</strong>  learning rate</li>
<li><strong>optim_weight_decay (<code><a href="#GlobalWorkspace.float">float</a></code>):</strong>  weight decay</li>
<li><strong>scheduler_args (<code>SchedulerArgs | None</code>):</strong>  optimization scheduler's arguments</li>
<li><strong>learn_logit_scale (<code>bool</code>):</strong>  whether to learn the contrastive learning
contrastive loss when using the default contrastive loss.</li>
<li><strong>contrastive_loss (<code>ContrastiveLossType | None</code>):</strong>  a contrastive loss
function used for alignment. <code>learn_logit_scale</code> will not affect custom
contrastive losses.</li>
</ul>
</div>


                            </div>
                            <div id="GlobalWorkspace.forward" class="classattr">
                                        <input id="GlobalWorkspace.forward-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">forward</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">latent_domains</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n"><a href="#GWPredictions">GWPredictions</a></span>:</span></span>

                <label class="view-source-button" for="GlobalWorkspace.forward-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GlobalWorkspace.forward"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GlobalWorkspace.forward-634"><a href="#GlobalWorkspace.forward-634"><span class="linenos">634</span></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="GlobalWorkspace.forward-635"><a href="#GlobalWorkspace.forward-635"><span class="linenos">635</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GlobalWorkspace.forward-636"><a href="#GlobalWorkspace.forward-636"><span class="linenos">636</span></a>        <span class="n">latent_domains</span><span class="p">:</span> <span class="n">LatentsDomainGroupsT</span><span class="p">,</span>
</span><span id="GlobalWorkspace.forward-637"><a href="#GlobalWorkspace.forward-637"><span class="linenos">637</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GWPredictions</span><span class="p">:</span>
</span><span id="GlobalWorkspace.forward-638"><a href="#GlobalWorkspace.forward-638"><span class="linenos">638</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspace.forward-639"><a href="#GlobalWorkspace.forward-639"><span class="linenos">639</span></a><span class="sd">        Computes demi-cycles, cycles, and translations.</span>
</span><span id="GlobalWorkspace.forward-640"><a href="#GlobalWorkspace.forward-640"><span class="linenos">640</span></a>
</span><span id="GlobalWorkspace.forward-641"><a href="#GlobalWorkspace.forward-641"><span class="linenos">641</span></a><span class="sd">        Args:</span>
</span><span id="GlobalWorkspace.forward-642"><a href="#GlobalWorkspace.forward-642"><span class="linenos">642</span></a><span class="sd">            latent_domains (`LatentsT`): Groups of domains for the computation.</span>
</span><span id="GlobalWorkspace.forward-643"><a href="#GlobalWorkspace.forward-643"><span class="linenos">643</span></a>
</span><span id="GlobalWorkspace.forward-644"><a href="#GlobalWorkspace.forward-644"><span class="linenos">644</span></a><span class="sd">        Returns:</span>
</span><span id="GlobalWorkspace.forward-645"><a href="#GlobalWorkspace.forward-645"><span class="linenos">645</span></a><span class="sd">            `GWPredictions`: the predictions on the batch.</span>
</span><span id="GlobalWorkspace.forward-646"><a href="#GlobalWorkspace.forward-646"><span class="linenos">646</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GlobalWorkspace.forward-647"><a href="#GlobalWorkspace.forward-647"><span class="linenos">647</span></a>        <span class="k">return</span> <span class="n">GWPredictions</span><span class="p">(</span>
</span><span id="GlobalWorkspace.forward-648"><a href="#GlobalWorkspace.forward-648"><span class="linenos">648</span></a>            <span class="n">demi_cycles</span><span class="o">=</span><span class="n">batch_demi_cycles</span><span class="p">(</span>
</span><span id="GlobalWorkspace.forward-649"><a href="#GlobalWorkspace.forward-649"><span class="linenos">649</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_mod</span><span class="p">,</span> <span class="n">latent_domains</span>
</span><span id="GlobalWorkspace.forward-650"><a href="#GlobalWorkspace.forward-650"><span class="linenos">650</span></a>            <span class="p">),</span>
</span><span id="GlobalWorkspace.forward-651"><a href="#GlobalWorkspace.forward-651"><span class="linenos">651</span></a>            <span class="n">cycles</span><span class="o">=</span><span class="n">batch_cycles</span><span class="p">(</span>
</span><span id="GlobalWorkspace.forward-652"><a href="#GlobalWorkspace.forward-652"><span class="linenos">652</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_mod</span><span class="p">,</span> <span class="n">latent_domains</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_mods</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="GlobalWorkspace.forward-653"><a href="#GlobalWorkspace.forward-653"><span class="linenos">653</span></a>            <span class="p">),</span>
</span><span id="GlobalWorkspace.forward-654"><a href="#GlobalWorkspace.forward-654"><span class="linenos">654</span></a>            <span class="n">translations</span><span class="o">=</span><span class="n">batch_translations</span><span class="p">(</span>
</span><span id="GlobalWorkspace.forward-655"><a href="#GlobalWorkspace.forward-655"><span class="linenos">655</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_mod</span><span class="p">,</span> <span class="n">latent_domains</span>
</span><span id="GlobalWorkspace.forward-656"><a href="#GlobalWorkspace.forward-656"><span class="linenos">656</span></a>            <span class="p">),</span>
</span><span id="GlobalWorkspace.forward-657"><a href="#GlobalWorkspace.forward-657"><span class="linenos">657</span></a>            <span class="c1"># TODO: add other combinations</span>
</span><span id="GlobalWorkspace.forward-658"><a href="#GlobalWorkspace.forward-658"><span class="linenos">658</span></a>            <span class="o">**</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">latent_domains</span><span class="p">),</span>
</span><span id="GlobalWorkspace.forward-659"><a href="#GlobalWorkspace.forward-659"><span class="linenos">659</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Computes demi-cycles, cycles, and translations.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>latent_domains (<code>LatentsT</code>):</strong>  Groups of domains for the computation.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p><code><a href="#GWPredictions">GWPredictions</a></code>: the predictions on the batch.</p>
</blockquote>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#GlobalWorkspaceBase">GlobalWorkspaceBase</a></dt>
                                <dd id="GlobalWorkspace.gw_mod" class="variable"><a href="#GlobalWorkspaceBase.gw_mod">gw_mod</a></dd>
                <dd id="GlobalWorkspace.selection_mod" class="variable"><a href="#GlobalWorkspaceBase.selection_mod">selection_mod</a></dd>
                <dd id="GlobalWorkspace.loss_mod" class="variable"><a href="#GlobalWorkspaceBase.loss_mod">loss_mod</a></dd>
                <dd id="GlobalWorkspace.optim_lr" class="variable"><a href="#GlobalWorkspaceBase.optim_lr">optim_lr</a></dd>
                <dd id="GlobalWorkspace.optim_weight_decay" class="variable"><a href="#GlobalWorkspaceBase.optim_weight_decay">optim_weight_decay</a></dd>
                <dd id="GlobalWorkspace.scheduler_args" class="variable"><a href="#GlobalWorkspaceBase.scheduler_args">scheduler_args</a></dd>
                <dd id="GlobalWorkspace.domain_mods" class="variable"><a href="#GlobalWorkspaceBase.domain_mods">domain_mods</a></dd>
                <dd id="GlobalWorkspace.workspace_dim" class="variable"><a href="#GlobalWorkspaceBase.workspace_dim">workspace_dim</a></dd>
                <dd id="GlobalWorkspace.encode_and_fuse" class="function"><a href="#GlobalWorkspaceBase.encode_and_fuse">encode_and_fuse</a></dd>
                <dd id="GlobalWorkspace.encode" class="function"><a href="#GlobalWorkspaceBase.encode">encode</a></dd>
                <dd id="GlobalWorkspace.fuse" class="function"><a href="#GlobalWorkspaceBase.fuse">fuse</a></dd>
                <dd id="GlobalWorkspace.decode" class="function"><a href="#GlobalWorkspaceBase.decode">decode</a></dd>
                <dd id="GlobalWorkspace.batch_gw_states" class="function"><a href="#GlobalWorkspaceBase.batch_gw_states">batch_gw_states</a></dd>
                <dd id="GlobalWorkspace.encode_domain" class="function"><a href="#GlobalWorkspaceBase.encode_domain">encode_domain</a></dd>
                <dd id="GlobalWorkspace.encode_domains" class="function"><a href="#GlobalWorkspaceBase.encode_domains">encode_domains</a></dd>
                <dd id="GlobalWorkspace.decode_domain" class="function"><a href="#GlobalWorkspaceBase.decode_domain">decode_domain</a></dd>
                <dd id="GlobalWorkspace.decode_domains" class="function"><a href="#GlobalWorkspaceBase.decode_domains">decode_domains</a></dd>
                <dd id="GlobalWorkspace.generic_step" class="function"><a href="#GlobalWorkspaceBase.generic_step">generic_step</a></dd>
                <dd id="GlobalWorkspace.validation_step" class="function"><a href="#GlobalWorkspaceBase.validation_step">validation_step</a></dd>
                <dd id="GlobalWorkspace.test_step" class="function"><a href="#GlobalWorkspaceBase.test_step">test_step</a></dd>
                <dd id="GlobalWorkspace.training_step" class="function"><a href="#GlobalWorkspaceBase.training_step">training_step</a></dd>
                <dd id="GlobalWorkspace.predict_step" class="function"><a href="#GlobalWorkspaceBase.predict_step">predict_step</a></dd>
                <dd id="GlobalWorkspace.configure_optimizers" class="function"><a href="#GlobalWorkspaceBase.configure_optimizers">configure_optimizers</a></dd>

            </div>
            <div><dt>lightning.pytorch.core.module.LightningModule</dt>
                                <dd id="GlobalWorkspace.CHECKPOINT_HYPER_PARAMS_KEY" class="variable">CHECKPOINT_HYPER_PARAMS_KEY</dd>
                <dd id="GlobalWorkspace.CHECKPOINT_HYPER_PARAMS_NAME" class="variable">CHECKPOINT_HYPER_PARAMS_NAME</dd>
                <dd id="GlobalWorkspace.CHECKPOINT_HYPER_PARAMS_TYPE" class="variable">CHECKPOINT_HYPER_PARAMS_TYPE</dd>
                <dd id="GlobalWorkspace.optimizers" class="function">optimizers</dd>
                <dd id="GlobalWorkspace.lr_schedulers" class="function">lr_schedulers</dd>
                <dd id="GlobalWorkspace.trainer" class="variable">trainer</dd>
                <dd id="GlobalWorkspace.fabric" class="variable">fabric</dd>
                <dd id="GlobalWorkspace.example_input_array" class="variable">example_input_array</dd>
                <dd id="GlobalWorkspace.current_epoch" class="variable">current_epoch</dd>
                <dd id="GlobalWorkspace.global_step" class="variable">global_step</dd>
                <dd id="GlobalWorkspace.global_rank" class="variable">global_rank</dd>
                <dd id="GlobalWorkspace.local_rank" class="variable">local_rank</dd>
                <dd id="GlobalWorkspace.on_gpu" class="variable">on_gpu</dd>
                <dd id="GlobalWorkspace.automatic_optimization" class="variable">automatic_optimization</dd>
                <dd id="GlobalWorkspace.strict_loading" class="variable">strict_loading</dd>
                <dd id="GlobalWorkspace.logger" class="variable">logger</dd>
                <dd id="GlobalWorkspace.loggers" class="variable">loggers</dd>
                <dd id="GlobalWorkspace.print" class="function">print</dd>
                <dd id="GlobalWorkspace.log" class="function">log</dd>
                <dd id="GlobalWorkspace.log_dict" class="function">log_dict</dd>
                <dd id="GlobalWorkspace.all_gather" class="function">all_gather</dd>
                <dd id="GlobalWorkspace.configure_callbacks" class="function">configure_callbacks</dd>
                <dd id="GlobalWorkspace.manual_backward" class="function">manual_backward</dd>
                <dd id="GlobalWorkspace.backward" class="function">backward</dd>
                <dd id="GlobalWorkspace.toggle_optimizer" class="function">toggle_optimizer</dd>
                <dd id="GlobalWorkspace.untoggle_optimizer" class="function">untoggle_optimizer</dd>
                <dd id="GlobalWorkspace.clip_gradients" class="function">clip_gradients</dd>
                <dd id="GlobalWorkspace.configure_gradient_clipping" class="function">configure_gradient_clipping</dd>
                <dd id="GlobalWorkspace.lr_scheduler_step" class="function">lr_scheduler_step</dd>
                <dd id="GlobalWorkspace.optimizer_step" class="function">optimizer_step</dd>
                <dd id="GlobalWorkspace.optimizer_zero_grad" class="function">optimizer_zero_grad</dd>
                <dd id="GlobalWorkspace.freeze" class="function">freeze</dd>
                <dd id="GlobalWorkspace.unfreeze" class="function">unfreeze</dd>
                <dd id="GlobalWorkspace.to_onnx" class="function">to_onnx</dd>
                <dd id="GlobalWorkspace.to_torchscript" class="function">to_torchscript</dd>
                <dd id="GlobalWorkspace.load_from_checkpoint" class="function">load_from_checkpoint</dd>

            </div>
            <div><dt>lightning.fabric.utilities.device_dtype_mixin._DeviceDtypeModuleMixin</dt>
                                <dd id="GlobalWorkspace.dtype" class="variable">dtype</dd>
                <dd id="GlobalWorkspace.device" class="variable">device</dd>
                <dd id="GlobalWorkspace.to" class="function">to</dd>
                <dd id="GlobalWorkspace.cuda" class="function">cuda</dd>
                <dd id="GlobalWorkspace.cpu" class="function">cpu</dd>
                <dd id="GlobalWorkspace.type" class="function">type</dd>
                <dd id="GlobalWorkspace.float" class="function">float</dd>
                <dd id="GlobalWorkspace.double" class="function">double</dd>
                <dd id="GlobalWorkspace.half" class="function">half</dd>

            </div>
            <div><dt>lightning.pytorch.core.mixins.hparams_mixin.HyperparametersMixin</dt>
                                <dd id="GlobalWorkspace.save_hyperparameters" class="function">save_hyperparameters</dd>
                <dd id="GlobalWorkspace.hparams" class="variable">hparams</dd>
                <dd id="GlobalWorkspace.hparams_initial" class="variable">hparams_initial</dd>

            </div>
            <div><dt>lightning.pytorch.core.hooks.ModelHooks</dt>
                                <dd id="GlobalWorkspace.on_fit_start" class="function">on_fit_start</dd>
                <dd id="GlobalWorkspace.on_fit_end" class="function">on_fit_end</dd>
                <dd id="GlobalWorkspace.on_train_start" class="function">on_train_start</dd>
                <dd id="GlobalWorkspace.on_train_end" class="function">on_train_end</dd>
                <dd id="GlobalWorkspace.on_validation_start" class="function">on_validation_start</dd>
                <dd id="GlobalWorkspace.on_validation_end" class="function">on_validation_end</dd>
                <dd id="GlobalWorkspace.on_test_start" class="function">on_test_start</dd>
                <dd id="GlobalWorkspace.on_test_end" class="function">on_test_end</dd>
                <dd id="GlobalWorkspace.on_predict_start" class="function">on_predict_start</dd>
                <dd id="GlobalWorkspace.on_predict_end" class="function">on_predict_end</dd>
                <dd id="GlobalWorkspace.on_train_batch_start" class="function">on_train_batch_start</dd>
                <dd id="GlobalWorkspace.on_train_batch_end" class="function">on_train_batch_end</dd>
                <dd id="GlobalWorkspace.on_validation_batch_start" class="function">on_validation_batch_start</dd>
                <dd id="GlobalWorkspace.on_validation_batch_end" class="function">on_validation_batch_end</dd>
                <dd id="GlobalWorkspace.on_test_batch_start" class="function">on_test_batch_start</dd>
                <dd id="GlobalWorkspace.on_test_batch_end" class="function">on_test_batch_end</dd>
                <dd id="GlobalWorkspace.on_predict_batch_start" class="function">on_predict_batch_start</dd>
                <dd id="GlobalWorkspace.on_predict_batch_end" class="function">on_predict_batch_end</dd>
                <dd id="GlobalWorkspace.on_validation_model_zero_grad" class="function">on_validation_model_zero_grad</dd>
                <dd id="GlobalWorkspace.on_validation_model_eval" class="function">on_validation_model_eval</dd>
                <dd id="GlobalWorkspace.on_validation_model_train" class="function">on_validation_model_train</dd>
                <dd id="GlobalWorkspace.on_test_model_eval" class="function">on_test_model_eval</dd>
                <dd id="GlobalWorkspace.on_test_model_train" class="function">on_test_model_train</dd>
                <dd id="GlobalWorkspace.on_predict_model_eval" class="function">on_predict_model_eval</dd>
                <dd id="GlobalWorkspace.on_train_epoch_start" class="function">on_train_epoch_start</dd>
                <dd id="GlobalWorkspace.on_train_epoch_end" class="function">on_train_epoch_end</dd>
                <dd id="GlobalWorkspace.on_validation_epoch_start" class="function">on_validation_epoch_start</dd>
                <dd id="GlobalWorkspace.on_validation_epoch_end" class="function">on_validation_epoch_end</dd>
                <dd id="GlobalWorkspace.on_test_epoch_start" class="function">on_test_epoch_start</dd>
                <dd id="GlobalWorkspace.on_test_epoch_end" class="function">on_test_epoch_end</dd>
                <dd id="GlobalWorkspace.on_predict_epoch_start" class="function">on_predict_epoch_start</dd>
                <dd id="GlobalWorkspace.on_predict_epoch_end" class="function">on_predict_epoch_end</dd>
                <dd id="GlobalWorkspace.on_before_zero_grad" class="function">on_before_zero_grad</dd>
                <dd id="GlobalWorkspace.on_before_backward" class="function">on_before_backward</dd>
                <dd id="GlobalWorkspace.on_after_backward" class="function">on_after_backward</dd>
                <dd id="GlobalWorkspace.on_before_optimizer_step" class="function">on_before_optimizer_step</dd>
                <dd id="GlobalWorkspace.configure_sharded_model" class="function">configure_sharded_model</dd>
                <dd id="GlobalWorkspace.configure_model" class="function">configure_model</dd>

            </div>
            <div><dt>lightning.pytorch.core.hooks.DataHooks</dt>
                                <dd id="GlobalWorkspace.prepare_data_per_node" class="variable">prepare_data_per_node</dd>
                <dd id="GlobalWorkspace.allow_zero_length_dataloader_with_multiple_devices" class="variable">allow_zero_length_dataloader_with_multiple_devices</dd>
                <dd id="GlobalWorkspace.prepare_data" class="function">prepare_data</dd>
                <dd id="GlobalWorkspace.setup" class="function">setup</dd>
                <dd id="GlobalWorkspace.teardown" class="function">teardown</dd>
                <dd id="GlobalWorkspace.train_dataloader" class="function">train_dataloader</dd>
                <dd id="GlobalWorkspace.test_dataloader" class="function">test_dataloader</dd>
                <dd id="GlobalWorkspace.val_dataloader" class="function">val_dataloader</dd>
                <dd id="GlobalWorkspace.predict_dataloader" class="function">predict_dataloader</dd>
                <dd id="GlobalWorkspace.transfer_batch_to_device" class="function">transfer_batch_to_device</dd>
                <dd id="GlobalWorkspace.on_before_batch_transfer" class="function">on_before_batch_transfer</dd>
                <dd id="GlobalWorkspace.on_after_batch_transfer" class="function">on_after_batch_transfer</dd>

            </div>
            <div><dt>lightning.pytorch.core.hooks.CheckpointHooks</dt>
                                <dd id="GlobalWorkspace.on_load_checkpoint" class="function">on_load_checkpoint</dd>
                <dd id="GlobalWorkspace.on_save_checkpoint" class="function">on_save_checkpoint</dd>

            </div>
            <div><dt>torch.nn.modules.module.Module</dt>
                                <dd id="GlobalWorkspace.dump_patches" class="variable">dump_patches</dd>
                <dd id="GlobalWorkspace.training" class="variable">training</dd>
                <dd id="GlobalWorkspace.call_super_init" class="variable">call_super_init</dd>
                <dd id="GlobalWorkspace.register_buffer" class="function">register_buffer</dd>
                <dd id="GlobalWorkspace.register_parameter" class="function">register_parameter</dd>
                <dd id="GlobalWorkspace.add_module" class="function">add_module</dd>
                <dd id="GlobalWorkspace.register_module" class="function">register_module</dd>
                <dd id="GlobalWorkspace.get_submodule" class="function">get_submodule</dd>
                <dd id="GlobalWorkspace.get_parameter" class="function">get_parameter</dd>
                <dd id="GlobalWorkspace.get_buffer" class="function">get_buffer</dd>
                <dd id="GlobalWorkspace.get_extra_state" class="function">get_extra_state</dd>
                <dd id="GlobalWorkspace.set_extra_state" class="function">set_extra_state</dd>
                <dd id="GlobalWorkspace.apply" class="function">apply</dd>
                <dd id="GlobalWorkspace.ipu" class="function">ipu</dd>
                <dd id="GlobalWorkspace.xpu" class="function">xpu</dd>
                <dd id="GlobalWorkspace.bfloat16" class="function">bfloat16</dd>
                <dd id="GlobalWorkspace.to_empty" class="function">to_empty</dd>
                <dd id="GlobalWorkspace.register_full_backward_pre_hook" class="function">register_full_backward_pre_hook</dd>
                <dd id="GlobalWorkspace.register_backward_hook" class="function">register_backward_hook</dd>
                <dd id="GlobalWorkspace.register_full_backward_hook" class="function">register_full_backward_hook</dd>
                <dd id="GlobalWorkspace.register_forward_pre_hook" class="function">register_forward_pre_hook</dd>
                <dd id="GlobalWorkspace.register_forward_hook" class="function">register_forward_hook</dd>
                <dd id="GlobalWorkspace.register_state_dict_pre_hook" class="function">register_state_dict_pre_hook</dd>
                <dd id="GlobalWorkspace.state_dict" class="function">state_dict</dd>
                <dd id="GlobalWorkspace.register_load_state_dict_post_hook" class="function">register_load_state_dict_post_hook</dd>
                <dd id="GlobalWorkspace.load_state_dict" class="function">load_state_dict</dd>
                <dd id="GlobalWorkspace.parameters" class="function">parameters</dd>
                <dd id="GlobalWorkspace.named_parameters" class="function">named_parameters</dd>
                <dd id="GlobalWorkspace.buffers" class="function">buffers</dd>
                <dd id="GlobalWorkspace.named_buffers" class="function">named_buffers</dd>
                <dd id="GlobalWorkspace.children" class="function">children</dd>
                <dd id="GlobalWorkspace.named_children" class="function">named_children</dd>
                <dd id="GlobalWorkspace.modules" class="function">modules</dd>
                <dd id="GlobalWorkspace.named_modules" class="function">named_modules</dd>
                <dd id="GlobalWorkspace.train" class="function">train</dd>
                <dd id="GlobalWorkspace.eval" class="function">eval</dd>
                <dd id="GlobalWorkspace.requires_grad_" class="function">requires_grad_</dd>
                <dd id="GlobalWorkspace.zero_grad" class="function">zero_grad</dd>
                <dd id="GlobalWorkspace.share_memory" class="function">share_memory</dd>
                <dd id="GlobalWorkspace.extra_repr" class="function">extra_repr</dd>
                <dd id="GlobalWorkspace.compile" class="function">compile</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="GlobalWorkspaceBayesian">
                            <input id="GlobalWorkspaceBayesian-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">GlobalWorkspaceBayesian</span><wbr>(<span class="base"><a href="#GlobalWorkspaceBase">shimmer.modules.global_workspace.GlobalWorkspaceBase[shimmer.modules.gw_module.GWModuleBayesian, shimmer.modules.selection.FixedSharedSelection, shimmer.modules.losses.GWLossesBayesian]</a></span>):

                <label class="view-source-button" for="GlobalWorkspaceBayesian-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GlobalWorkspaceBayesian"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GlobalWorkspaceBayesian-662"><a href="#GlobalWorkspaceBayesian-662"><span class="linenos">662</span></a><span class="k">class</span> <span class="nc">GlobalWorkspaceBayesian</span><span class="p">(</span>
</span><span id="GlobalWorkspaceBayesian-663"><a href="#GlobalWorkspaceBayesian-663"><span class="linenos">663</span></a>    <span class="n">GlobalWorkspaceBase</span><span class="p">[</span><span class="n">GWModuleBayesian</span><span class="p">,</span> <span class="n">FixedSharedSelection</span><span class="p">,</span> <span class="n">GWLossesBayesian</span><span class="p">]</span>
</span><span id="GlobalWorkspaceBayesian-664"><a href="#GlobalWorkspaceBayesian-664"><span class="linenos">664</span></a><span class="p">):</span>
</span><span id="GlobalWorkspaceBayesian-665"><a href="#GlobalWorkspaceBayesian-665"><span class="linenos">665</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBayesian-666"><a href="#GlobalWorkspaceBayesian-666"><span class="linenos">666</span></a><span class="sd">    A simple 2-domains max GlobalWorkspaceBase with a Bayesian base uncertainty</span>
</span><span id="GlobalWorkspaceBayesian-667"><a href="#GlobalWorkspaceBayesian-667"><span class="linenos">667</span></a><span class="sd">    prediction.</span>
</span><span id="GlobalWorkspaceBayesian-668"><a href="#GlobalWorkspaceBayesian-668"><span class="linenos">668</span></a>
</span><span id="GlobalWorkspaceBayesian-669"><a href="#GlobalWorkspaceBayesian-669"><span class="linenos">669</span></a><span class="sd">    This is used to simplify a Global Workspace instanciation and only overrides the</span>
</span><span id="GlobalWorkspaceBayesian-670"><a href="#GlobalWorkspaceBayesian-670"><span class="linenos">670</span></a><span class="sd">    `__init__` method.</span>
</span><span id="GlobalWorkspaceBayesian-671"><a href="#GlobalWorkspaceBayesian-671"><span class="linenos">671</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBayesian-672"><a href="#GlobalWorkspaceBayesian-672"><span class="linenos">672</span></a>
</span><span id="GlobalWorkspaceBayesian-673"><a href="#GlobalWorkspaceBayesian-673"><span class="linenos">673</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="GlobalWorkspaceBayesian-674"><a href="#GlobalWorkspaceBayesian-674"><span class="linenos">674</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian-675"><a href="#GlobalWorkspaceBayesian-675"><span class="linenos">675</span></a>        <span class="n">domain_mods</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DomainModule</span><span class="p">],</span>
</span><span id="GlobalWorkspaceBayesian-676"><a href="#GlobalWorkspaceBayesian-676"><span class="linenos">676</span></a>        <span class="n">gw_encoders</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Module</span><span class="p">],</span>
</span><span id="GlobalWorkspaceBayesian-677"><a href="#GlobalWorkspaceBayesian-677"><span class="linenos">677</span></a>        <span class="n">gw_decoders</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Module</span><span class="p">],</span>
</span><span id="GlobalWorkspaceBayesian-678"><a href="#GlobalWorkspaceBayesian-678"><span class="linenos">678</span></a>        <span class="n">workspace_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian-679"><a href="#GlobalWorkspaceBayesian-679"><span class="linenos">679</span></a>        <span class="n">loss_coefs</span><span class="p">:</span> <span class="n">BroadcastLossCoefs</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian-680"><a href="#GlobalWorkspaceBayesian-680"><span class="linenos">680</span></a>        <span class="n">sensitivity_selection</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian-681"><a href="#GlobalWorkspaceBayesian-681"><span class="linenos">681</span></a>        <span class="n">sensitivity_precision</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian-682"><a href="#GlobalWorkspaceBayesian-682"><span class="linenos">682</span></a>        <span class="n">optim_lr</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian-683"><a href="#GlobalWorkspaceBayesian-683"><span class="linenos">683</span></a>        <span class="n">optim_weight_decay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian-684"><a href="#GlobalWorkspaceBayesian-684"><span class="linenos">684</span></a>        <span class="n">scheduler_args</span><span class="p">:</span> <span class="n">SchedulerArgs</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian-685"><a href="#GlobalWorkspaceBayesian-685"><span class="linenos">685</span></a>        <span class="n">learn_logit_scale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian-686"><a href="#GlobalWorkspaceBayesian-686"><span class="linenos">686</span></a>        <span class="n">use_normalized_constrastive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian-687"><a href="#GlobalWorkspaceBayesian-687"><span class="linenos">687</span></a>        <span class="n">contrastive_loss</span><span class="p">:</span> <span class="n">ContrastiveLossType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian-688"><a href="#GlobalWorkspaceBayesian-688"><span class="linenos">688</span></a>        <span class="n">precision_softmax_temp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian-689"><a href="#GlobalWorkspaceBayesian-689"><span class="linenos">689</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GlobalWorkspaceBayesian-690"><a href="#GlobalWorkspaceBayesian-690"><span class="linenos">690</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBayesian-691"><a href="#GlobalWorkspaceBayesian-691"><span class="linenos">691</span></a><span class="sd">        Initializes a Global Workspace</span>
</span><span id="GlobalWorkspaceBayesian-692"><a href="#GlobalWorkspaceBayesian-692"><span class="linenos">692</span></a>
</span><span id="GlobalWorkspaceBayesian-693"><a href="#GlobalWorkspaceBayesian-693"><span class="linenos">693</span></a><span class="sd">        Args:</span>
</span><span id="GlobalWorkspaceBayesian-694"><a href="#GlobalWorkspaceBayesian-694"><span class="linenos">694</span></a><span class="sd">            domain_mods (`Mapping[str, DomainModule]`): mapping of the domains</span>
</span><span id="GlobalWorkspaceBayesian-695"><a href="#GlobalWorkspaceBayesian-695"><span class="linenos">695</span></a><span class="sd">                connected to the GW. Keys are domain names, values are the</span>
</span><span id="GlobalWorkspaceBayesian-696"><a href="#GlobalWorkspaceBayesian-696"><span class="linenos">696</span></a><span class="sd">                `DomainModule`.</span>
</span><span id="GlobalWorkspaceBayesian-697"><a href="#GlobalWorkspaceBayesian-697"><span class="linenos">697</span></a><span class="sd">            gw_encoders (`Mapping[str, torch.nn.Module]`): mapping for each domain</span>
</span><span id="GlobalWorkspaceBayesian-698"><a href="#GlobalWorkspaceBayesian-698"><span class="linenos">698</span></a><span class="sd">                name to a `torch.nn.Module` class which role is to encode a</span>
</span><span id="GlobalWorkspaceBayesian-699"><a href="#GlobalWorkspaceBayesian-699"><span class="linenos">699</span></a><span class="sd">                unimodal latent representations into a GW representation (pre fusion).</span>
</span><span id="GlobalWorkspaceBayesian-700"><a href="#GlobalWorkspaceBayesian-700"><span class="linenos">700</span></a><span class="sd">            gw_decoders (`Mapping[str, torch.nn.Module]`): mapping for each domain</span>
</span><span id="GlobalWorkspaceBayesian-701"><a href="#GlobalWorkspaceBayesian-701"><span class="linenos">701</span></a><span class="sd">                name to a `torch.nn.Module` class which role is to decode a</span>
</span><span id="GlobalWorkspaceBayesian-702"><a href="#GlobalWorkspaceBayesian-702"><span class="linenos">702</span></a><span class="sd">                GW representation into a unimodal latent representations.</span>
</span><span id="GlobalWorkspaceBayesian-703"><a href="#GlobalWorkspaceBayesian-703"><span class="linenos">703</span></a><span class="sd">            workspace_dim (`int`): dimension of the GW.</span>
</span><span id="GlobalWorkspaceBayesian-704"><a href="#GlobalWorkspaceBayesian-704"><span class="linenos">704</span></a><span class="sd">            loss_coefs (`LossCoefs`): loss coefficients</span>
</span><span id="GlobalWorkspaceBayesian-705"><a href="#GlobalWorkspaceBayesian-705"><span class="linenos">705</span></a><span class="sd">            sensitivity_selection (`float`): sensivity coef $c&#39;_1$</span>
</span><span id="GlobalWorkspaceBayesian-706"><a href="#GlobalWorkspaceBayesian-706"><span class="linenos">706</span></a><span class="sd">            sensitivity_precision (`float`): sensitivity coef $c&#39;_2$</span>
</span><span id="GlobalWorkspaceBayesian-707"><a href="#GlobalWorkspaceBayesian-707"><span class="linenos">707</span></a><span class="sd">            optim_lr (`float`): learning rate</span>
</span><span id="GlobalWorkspaceBayesian-708"><a href="#GlobalWorkspaceBayesian-708"><span class="linenos">708</span></a><span class="sd">            optim_weight_decay (`float`): weight decay</span>
</span><span id="GlobalWorkspaceBayesian-709"><a href="#GlobalWorkspaceBayesian-709"><span class="linenos">709</span></a><span class="sd">            scheduler_args (`SchedulerArgs | None`): optimization scheduler&#39;s arguments</span>
</span><span id="GlobalWorkspaceBayesian-710"><a href="#GlobalWorkspaceBayesian-710"><span class="linenos">710</span></a><span class="sd">            learn_logit_scale (`bool`): whether to learn the contrastive learning</span>
</span><span id="GlobalWorkspaceBayesian-711"><a href="#GlobalWorkspaceBayesian-711"><span class="linenos">711</span></a><span class="sd">                contrastive loss when using the default contrastive loss.</span>
</span><span id="GlobalWorkspaceBayesian-712"><a href="#GlobalWorkspaceBayesian-712"><span class="linenos">712</span></a><span class="sd">            use_normalized_constrastive (`bool`): whether to use the normalized cont</span>
</span><span id="GlobalWorkspaceBayesian-713"><a href="#GlobalWorkspaceBayesian-713"><span class="linenos">713</span></a><span class="sd">                loss by the precision coefs</span>
</span><span id="GlobalWorkspaceBayesian-714"><a href="#GlobalWorkspaceBayesian-714"><span class="linenos">714</span></a><span class="sd">            contrastive_loss (`ContrastiveLossType | None`): a contrastive loss</span>
</span><span id="GlobalWorkspaceBayesian-715"><a href="#GlobalWorkspaceBayesian-715"><span class="linenos">715</span></a><span class="sd">                function used for alignment. `learn_logit_scale` will not affect custom</span>
</span><span id="GlobalWorkspaceBayesian-716"><a href="#GlobalWorkspaceBayesian-716"><span class="linenos">716</span></a><span class="sd">                contrastive losses.</span>
</span><span id="GlobalWorkspaceBayesian-717"><a href="#GlobalWorkspaceBayesian-717"><span class="linenos">717</span></a><span class="sd">            precision_softmax_temp (`float`): temperature to use in softmax of</span>
</span><span id="GlobalWorkspaceBayesian-718"><a href="#GlobalWorkspaceBayesian-718"><span class="linenos">718</span></a><span class="sd">                precision</span>
</span><span id="GlobalWorkspaceBayesian-719"><a href="#GlobalWorkspaceBayesian-719"><span class="linenos">719</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBayesian-720"><a href="#GlobalWorkspaceBayesian-720"><span class="linenos">720</span></a>        <span class="n">domain_mods</span> <span class="o">=</span> <span class="n">freeze_domain_modules</span><span class="p">(</span><span class="n">domain_mods</span><span class="p">)</span>
</span><span id="GlobalWorkspaceBayesian-721"><a href="#GlobalWorkspaceBayesian-721"><span class="linenos">721</span></a>
</span><span id="GlobalWorkspaceBayesian-722"><a href="#GlobalWorkspaceBayesian-722"><span class="linenos">722</span></a>        <span class="n">gw_mod</span> <span class="o">=</span> <span class="n">GWModuleBayesian</span><span class="p">(</span>
</span><span id="GlobalWorkspaceBayesian-723"><a href="#GlobalWorkspaceBayesian-723"><span class="linenos">723</span></a>            <span class="n">domain_mods</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian-724"><a href="#GlobalWorkspaceBayesian-724"><span class="linenos">724</span></a>            <span class="n">workspace_dim</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian-725"><a href="#GlobalWorkspaceBayesian-725"><span class="linenos">725</span></a>            <span class="n">gw_encoders</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian-726"><a href="#GlobalWorkspaceBayesian-726"><span class="linenos">726</span></a>            <span class="n">gw_decoders</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian-727"><a href="#GlobalWorkspaceBayesian-727"><span class="linenos">727</span></a>            <span class="n">sensitivity_selection</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian-728"><a href="#GlobalWorkspaceBayesian-728"><span class="linenos">728</span></a>            <span class="n">sensitivity_precision</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian-729"><a href="#GlobalWorkspaceBayesian-729"><span class="linenos">729</span></a>            <span class="n">precision_softmax_temp</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian-730"><a href="#GlobalWorkspaceBayesian-730"><span class="linenos">730</span></a>        <span class="p">)</span>
</span><span id="GlobalWorkspaceBayesian-731"><a href="#GlobalWorkspaceBayesian-731"><span class="linenos">731</span></a>
</span><span id="GlobalWorkspaceBayesian-732"><a href="#GlobalWorkspaceBayesian-732"><span class="linenos">732</span></a>        <span class="n">selection_mod</span> <span class="o">=</span> <span class="n">FixedSharedSelection</span><span class="p">()</span>
</span><span id="GlobalWorkspaceBayesian-733"><a href="#GlobalWorkspaceBayesian-733"><span class="linenos">733</span></a>
</span><span id="GlobalWorkspaceBayesian-734"><a href="#GlobalWorkspaceBayesian-734"><span class="linenos">734</span></a>        <span class="n">contrastive_loss</span> <span class="o">=</span> <span class="n">ContrastiveLoss</span><span class="p">(</span>
</span><span id="GlobalWorkspaceBayesian-735"><a href="#GlobalWorkspaceBayesian-735"><span class="linenos">735</span></a>            <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">log</span><span class="p">(),</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="n">learn_logit_scale</span>
</span><span id="GlobalWorkspaceBayesian-736"><a href="#GlobalWorkspaceBayesian-736"><span class="linenos">736</span></a>        <span class="p">)</span>
</span><span id="GlobalWorkspaceBayesian-737"><a href="#GlobalWorkspaceBayesian-737"><span class="linenos">737</span></a>
</span><span id="GlobalWorkspaceBayesian-738"><a href="#GlobalWorkspaceBayesian-738"><span class="linenos">738</span></a>        <span class="n">loss_mod</span> <span class="o">=</span> <span class="n">GWLossesBayesian</span><span class="p">(</span>
</span><span id="GlobalWorkspaceBayesian-739"><a href="#GlobalWorkspaceBayesian-739"><span class="linenos">739</span></a>            <span class="n">gw_mod</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian-740"><a href="#GlobalWorkspaceBayesian-740"><span class="linenos">740</span></a>            <span class="n">selection_mod</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian-741"><a href="#GlobalWorkspaceBayesian-741"><span class="linenos">741</span></a>            <span class="n">domain_mods</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian-742"><a href="#GlobalWorkspaceBayesian-742"><span class="linenos">742</span></a>            <span class="n">loss_coefs</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian-743"><a href="#GlobalWorkspaceBayesian-743"><span class="linenos">743</span></a>            <span class="n">contrastive_loss</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian-744"><a href="#GlobalWorkspaceBayesian-744"><span class="linenos">744</span></a>            <span class="n">use_normalized_constrastive</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian-745"><a href="#GlobalWorkspaceBayesian-745"><span class="linenos">745</span></a>        <span class="p">)</span>
</span><span id="GlobalWorkspaceBayesian-746"><a href="#GlobalWorkspaceBayesian-746"><span class="linenos">746</span></a>
</span><span id="GlobalWorkspaceBayesian-747"><a href="#GlobalWorkspaceBayesian-747"><span class="linenos">747</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="GlobalWorkspaceBayesian-748"><a href="#GlobalWorkspaceBayesian-748"><span class="linenos">748</span></a>            <span class="n">gw_mod</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian-749"><a href="#GlobalWorkspaceBayesian-749"><span class="linenos">749</span></a>            <span class="n">selection_mod</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian-750"><a href="#GlobalWorkspaceBayesian-750"><span class="linenos">750</span></a>            <span class="n">loss_mod</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian-751"><a href="#GlobalWorkspaceBayesian-751"><span class="linenos">751</span></a>            <span class="n">optim_lr</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian-752"><a href="#GlobalWorkspaceBayesian-752"><span class="linenos">752</span></a>            <span class="n">optim_weight_decay</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian-753"><a href="#GlobalWorkspaceBayesian-753"><span class="linenos">753</span></a>            <span class="n">scheduler_args</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian-754"><a href="#GlobalWorkspaceBayesian-754"><span class="linenos">754</span></a>        <span class="p">)</span>
</span><span id="GlobalWorkspaceBayesian-755"><a href="#GlobalWorkspaceBayesian-755"><span class="linenos">755</span></a>
</span><span id="GlobalWorkspaceBayesian-756"><a href="#GlobalWorkspaceBayesian-756"><span class="linenos">756</span></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="GlobalWorkspaceBayesian-757"><a href="#GlobalWorkspaceBayesian-757"><span class="linenos">757</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian-758"><a href="#GlobalWorkspaceBayesian-758"><span class="linenos">758</span></a>        <span class="n">latent_domains</span><span class="p">:</span> <span class="n">LatentsDomainGroupsT</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian-759"><a href="#GlobalWorkspaceBayesian-759"><span class="linenos">759</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GWPredictions</span><span class="p">:</span>
</span><span id="GlobalWorkspaceBayesian-760"><a href="#GlobalWorkspaceBayesian-760"><span class="linenos">760</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBayesian-761"><a href="#GlobalWorkspaceBayesian-761"><span class="linenos">761</span></a><span class="sd">        Computes demi-cycles, cycles, and translations.</span>
</span><span id="GlobalWorkspaceBayesian-762"><a href="#GlobalWorkspaceBayesian-762"><span class="linenos">762</span></a>
</span><span id="GlobalWorkspaceBayesian-763"><a href="#GlobalWorkspaceBayesian-763"><span class="linenos">763</span></a><span class="sd">        Args:</span>
</span><span id="GlobalWorkspaceBayesian-764"><a href="#GlobalWorkspaceBayesian-764"><span class="linenos">764</span></a><span class="sd">            latent_domains (`LatentsT`): Groups of domains for the computation.</span>
</span><span id="GlobalWorkspaceBayesian-765"><a href="#GlobalWorkspaceBayesian-765"><span class="linenos">765</span></a>
</span><span id="GlobalWorkspaceBayesian-766"><a href="#GlobalWorkspaceBayesian-766"><span class="linenos">766</span></a><span class="sd">        Returns:</span>
</span><span id="GlobalWorkspaceBayesian-767"><a href="#GlobalWorkspaceBayesian-767"><span class="linenos">767</span></a><span class="sd">            `GWPredictions`: the predictions on the batch.</span>
</span><span id="GlobalWorkspaceBayesian-768"><a href="#GlobalWorkspaceBayesian-768"><span class="linenos">768</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBayesian-769"><a href="#GlobalWorkspaceBayesian-769"><span class="linenos">769</span></a>        <span class="k">return</span> <span class="n">GWPredictions</span><span class="p">(</span>
</span><span id="GlobalWorkspaceBayesian-770"><a href="#GlobalWorkspaceBayesian-770"><span class="linenos">770</span></a>            <span class="n">demi_cycles</span><span class="o">=</span><span class="n">batch_demi_cycles</span><span class="p">(</span>
</span><span id="GlobalWorkspaceBayesian-771"><a href="#GlobalWorkspaceBayesian-771"><span class="linenos">771</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_mod</span><span class="p">,</span> <span class="n">latent_domains</span>
</span><span id="GlobalWorkspaceBayesian-772"><a href="#GlobalWorkspaceBayesian-772"><span class="linenos">772</span></a>            <span class="p">),</span>
</span><span id="GlobalWorkspaceBayesian-773"><a href="#GlobalWorkspaceBayesian-773"><span class="linenos">773</span></a>            <span class="n">cycles</span><span class="o">=</span><span class="n">batch_cycles</span><span class="p">(</span>
</span><span id="GlobalWorkspaceBayesian-774"><a href="#GlobalWorkspaceBayesian-774"><span class="linenos">774</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_mod</span><span class="p">,</span> <span class="n">latent_domains</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_mods</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="GlobalWorkspaceBayesian-775"><a href="#GlobalWorkspaceBayesian-775"><span class="linenos">775</span></a>            <span class="p">),</span>
</span><span id="GlobalWorkspaceBayesian-776"><a href="#GlobalWorkspaceBayesian-776"><span class="linenos">776</span></a>            <span class="n">translations</span><span class="o">=</span><span class="n">batch_translations</span><span class="p">(</span>
</span><span id="GlobalWorkspaceBayesian-777"><a href="#GlobalWorkspaceBayesian-777"><span class="linenos">777</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_mod</span><span class="p">,</span> <span class="n">latent_domains</span>
</span><span id="GlobalWorkspaceBayesian-778"><a href="#GlobalWorkspaceBayesian-778"><span class="linenos">778</span></a>            <span class="p">),</span>
</span><span id="GlobalWorkspaceBayesian-779"><a href="#GlobalWorkspaceBayesian-779"><span class="linenos">779</span></a>            <span class="o">**</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">latent_domains</span><span class="p">),</span>
</span><span id="GlobalWorkspaceBayesian-780"><a href="#GlobalWorkspaceBayesian-780"><span class="linenos">780</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A simple 2-domains max GlobalWorkspaceBase with a Bayesian base uncertainty
prediction.</p>

<p>This is used to simplify a Global Workspace instanciation and only overrides the
<code><a href="#GlobalWorkspaceBayesian.__init__">__init__</a></code> method.</p>
</div>


                            <div id="GlobalWorkspaceBayesian.__init__" class="classattr">
                                        <input id="GlobalWorkspaceBayesian.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">GlobalWorkspaceBayesian</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">domain_mods</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><a href="domain.html#DomainModule">shimmer.modules.domain.DomainModule</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">gw_encoders</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span>,</span><span class="param">	<span class="n">gw_decoders</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span>,</span><span class="param">	<span class="n">workspace_dim</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">loss_coefs</span><span class="p">:</span> <span class="n"><a href="losses.html#BroadcastLossCoefs">shimmer.modules.losses.BroadcastLossCoefs</a></span>,</span><span class="param">	<span class="n">sensitivity_selection</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">sensitivity_precision</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">optim_lr</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span>,</span><span class="param">	<span class="n">optim_weight_decay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>,</span><span class="param">	<span class="n">scheduler_args</span><span class="p">:</span> <span class="n"><a href="#SchedulerArgs">SchedulerArgs</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">learn_logit_scale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">use_normalized_constrastive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">contrastive_loss</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span> <span class="n"><a href="domain.html#LossOutput">shimmer.modules.domain.LossOutput</a></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">precision_softmax_temp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span></span>)</span>

                <label class="view-source-button" for="GlobalWorkspaceBayesian.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GlobalWorkspaceBayesian.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GlobalWorkspaceBayesian.__init__-673"><a href="#GlobalWorkspaceBayesian.__init__-673"><span class="linenos">673</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="GlobalWorkspaceBayesian.__init__-674"><a href="#GlobalWorkspaceBayesian.__init__-674"><span class="linenos">674</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian.__init__-675"><a href="#GlobalWorkspaceBayesian.__init__-675"><span class="linenos">675</span></a>        <span class="n">domain_mods</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DomainModule</span><span class="p">],</span>
</span><span id="GlobalWorkspaceBayesian.__init__-676"><a href="#GlobalWorkspaceBayesian.__init__-676"><span class="linenos">676</span></a>        <span class="n">gw_encoders</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Module</span><span class="p">],</span>
</span><span id="GlobalWorkspaceBayesian.__init__-677"><a href="#GlobalWorkspaceBayesian.__init__-677"><span class="linenos">677</span></a>        <span class="n">gw_decoders</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Module</span><span class="p">],</span>
</span><span id="GlobalWorkspaceBayesian.__init__-678"><a href="#GlobalWorkspaceBayesian.__init__-678"><span class="linenos">678</span></a>        <span class="n">workspace_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian.__init__-679"><a href="#GlobalWorkspaceBayesian.__init__-679"><span class="linenos">679</span></a>        <span class="n">loss_coefs</span><span class="p">:</span> <span class="n">BroadcastLossCoefs</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian.__init__-680"><a href="#GlobalWorkspaceBayesian.__init__-680"><span class="linenos">680</span></a>        <span class="n">sensitivity_selection</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian.__init__-681"><a href="#GlobalWorkspaceBayesian.__init__-681"><span class="linenos">681</span></a>        <span class="n">sensitivity_precision</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian.__init__-682"><a href="#GlobalWorkspaceBayesian.__init__-682"><span class="linenos">682</span></a>        <span class="n">optim_lr</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian.__init__-683"><a href="#GlobalWorkspaceBayesian.__init__-683"><span class="linenos">683</span></a>        <span class="n">optim_weight_decay</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian.__init__-684"><a href="#GlobalWorkspaceBayesian.__init__-684"><span class="linenos">684</span></a>        <span class="n">scheduler_args</span><span class="p">:</span> <span class="n">SchedulerArgs</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian.__init__-685"><a href="#GlobalWorkspaceBayesian.__init__-685"><span class="linenos">685</span></a>        <span class="n">learn_logit_scale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian.__init__-686"><a href="#GlobalWorkspaceBayesian.__init__-686"><span class="linenos">686</span></a>        <span class="n">use_normalized_constrastive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian.__init__-687"><a href="#GlobalWorkspaceBayesian.__init__-687"><span class="linenos">687</span></a>        <span class="n">contrastive_loss</span><span class="p">:</span> <span class="n">ContrastiveLossType</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian.__init__-688"><a href="#GlobalWorkspaceBayesian.__init__-688"><span class="linenos">688</span></a>        <span class="n">precision_softmax_temp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian.__init__-689"><a href="#GlobalWorkspaceBayesian.__init__-689"><span class="linenos">689</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GlobalWorkspaceBayesian.__init__-690"><a href="#GlobalWorkspaceBayesian.__init__-690"><span class="linenos">690</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBayesian.__init__-691"><a href="#GlobalWorkspaceBayesian.__init__-691"><span class="linenos">691</span></a><span class="sd">        Initializes a Global Workspace</span>
</span><span id="GlobalWorkspaceBayesian.__init__-692"><a href="#GlobalWorkspaceBayesian.__init__-692"><span class="linenos">692</span></a>
</span><span id="GlobalWorkspaceBayesian.__init__-693"><a href="#GlobalWorkspaceBayesian.__init__-693"><span class="linenos">693</span></a><span class="sd">        Args:</span>
</span><span id="GlobalWorkspaceBayesian.__init__-694"><a href="#GlobalWorkspaceBayesian.__init__-694"><span class="linenos">694</span></a><span class="sd">            domain_mods (`Mapping[str, DomainModule]`): mapping of the domains</span>
</span><span id="GlobalWorkspaceBayesian.__init__-695"><a href="#GlobalWorkspaceBayesian.__init__-695"><span class="linenos">695</span></a><span class="sd">                connected to the GW. Keys are domain names, values are the</span>
</span><span id="GlobalWorkspaceBayesian.__init__-696"><a href="#GlobalWorkspaceBayesian.__init__-696"><span class="linenos">696</span></a><span class="sd">                `DomainModule`.</span>
</span><span id="GlobalWorkspaceBayesian.__init__-697"><a href="#GlobalWorkspaceBayesian.__init__-697"><span class="linenos">697</span></a><span class="sd">            gw_encoders (`Mapping[str, torch.nn.Module]`): mapping for each domain</span>
</span><span id="GlobalWorkspaceBayesian.__init__-698"><a href="#GlobalWorkspaceBayesian.__init__-698"><span class="linenos">698</span></a><span class="sd">                name to a `torch.nn.Module` class which role is to encode a</span>
</span><span id="GlobalWorkspaceBayesian.__init__-699"><a href="#GlobalWorkspaceBayesian.__init__-699"><span class="linenos">699</span></a><span class="sd">                unimodal latent representations into a GW representation (pre fusion).</span>
</span><span id="GlobalWorkspaceBayesian.__init__-700"><a href="#GlobalWorkspaceBayesian.__init__-700"><span class="linenos">700</span></a><span class="sd">            gw_decoders (`Mapping[str, torch.nn.Module]`): mapping for each domain</span>
</span><span id="GlobalWorkspaceBayesian.__init__-701"><a href="#GlobalWorkspaceBayesian.__init__-701"><span class="linenos">701</span></a><span class="sd">                name to a `torch.nn.Module` class which role is to decode a</span>
</span><span id="GlobalWorkspaceBayesian.__init__-702"><a href="#GlobalWorkspaceBayesian.__init__-702"><span class="linenos">702</span></a><span class="sd">                GW representation into a unimodal latent representations.</span>
</span><span id="GlobalWorkspaceBayesian.__init__-703"><a href="#GlobalWorkspaceBayesian.__init__-703"><span class="linenos">703</span></a><span class="sd">            workspace_dim (`int`): dimension of the GW.</span>
</span><span id="GlobalWorkspaceBayesian.__init__-704"><a href="#GlobalWorkspaceBayesian.__init__-704"><span class="linenos">704</span></a><span class="sd">            loss_coefs (`LossCoefs`): loss coefficients</span>
</span><span id="GlobalWorkspaceBayesian.__init__-705"><a href="#GlobalWorkspaceBayesian.__init__-705"><span class="linenos">705</span></a><span class="sd">            sensitivity_selection (`float`): sensivity coef $c&#39;_1$</span>
</span><span id="GlobalWorkspaceBayesian.__init__-706"><a href="#GlobalWorkspaceBayesian.__init__-706"><span class="linenos">706</span></a><span class="sd">            sensitivity_precision (`float`): sensitivity coef $c&#39;_2$</span>
</span><span id="GlobalWorkspaceBayesian.__init__-707"><a href="#GlobalWorkspaceBayesian.__init__-707"><span class="linenos">707</span></a><span class="sd">            optim_lr (`float`): learning rate</span>
</span><span id="GlobalWorkspaceBayesian.__init__-708"><a href="#GlobalWorkspaceBayesian.__init__-708"><span class="linenos">708</span></a><span class="sd">            optim_weight_decay (`float`): weight decay</span>
</span><span id="GlobalWorkspaceBayesian.__init__-709"><a href="#GlobalWorkspaceBayesian.__init__-709"><span class="linenos">709</span></a><span class="sd">            scheduler_args (`SchedulerArgs | None`): optimization scheduler&#39;s arguments</span>
</span><span id="GlobalWorkspaceBayesian.__init__-710"><a href="#GlobalWorkspaceBayesian.__init__-710"><span class="linenos">710</span></a><span class="sd">            learn_logit_scale (`bool`): whether to learn the contrastive learning</span>
</span><span id="GlobalWorkspaceBayesian.__init__-711"><a href="#GlobalWorkspaceBayesian.__init__-711"><span class="linenos">711</span></a><span class="sd">                contrastive loss when using the default contrastive loss.</span>
</span><span id="GlobalWorkspaceBayesian.__init__-712"><a href="#GlobalWorkspaceBayesian.__init__-712"><span class="linenos">712</span></a><span class="sd">            use_normalized_constrastive (`bool`): whether to use the normalized cont</span>
</span><span id="GlobalWorkspaceBayesian.__init__-713"><a href="#GlobalWorkspaceBayesian.__init__-713"><span class="linenos">713</span></a><span class="sd">                loss by the precision coefs</span>
</span><span id="GlobalWorkspaceBayesian.__init__-714"><a href="#GlobalWorkspaceBayesian.__init__-714"><span class="linenos">714</span></a><span class="sd">            contrastive_loss (`ContrastiveLossType | None`): a contrastive loss</span>
</span><span id="GlobalWorkspaceBayesian.__init__-715"><a href="#GlobalWorkspaceBayesian.__init__-715"><span class="linenos">715</span></a><span class="sd">                function used for alignment. `learn_logit_scale` will not affect custom</span>
</span><span id="GlobalWorkspaceBayesian.__init__-716"><a href="#GlobalWorkspaceBayesian.__init__-716"><span class="linenos">716</span></a><span class="sd">                contrastive losses.</span>
</span><span id="GlobalWorkspaceBayesian.__init__-717"><a href="#GlobalWorkspaceBayesian.__init__-717"><span class="linenos">717</span></a><span class="sd">            precision_softmax_temp (`float`): temperature to use in softmax of</span>
</span><span id="GlobalWorkspaceBayesian.__init__-718"><a href="#GlobalWorkspaceBayesian.__init__-718"><span class="linenos">718</span></a><span class="sd">                precision</span>
</span><span id="GlobalWorkspaceBayesian.__init__-719"><a href="#GlobalWorkspaceBayesian.__init__-719"><span class="linenos">719</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBayesian.__init__-720"><a href="#GlobalWorkspaceBayesian.__init__-720"><span class="linenos">720</span></a>        <span class="n">domain_mods</span> <span class="o">=</span> <span class="n">freeze_domain_modules</span><span class="p">(</span><span class="n">domain_mods</span><span class="p">)</span>
</span><span id="GlobalWorkspaceBayesian.__init__-721"><a href="#GlobalWorkspaceBayesian.__init__-721"><span class="linenos">721</span></a>
</span><span id="GlobalWorkspaceBayesian.__init__-722"><a href="#GlobalWorkspaceBayesian.__init__-722"><span class="linenos">722</span></a>        <span class="n">gw_mod</span> <span class="o">=</span> <span class="n">GWModuleBayesian</span><span class="p">(</span>
</span><span id="GlobalWorkspaceBayesian.__init__-723"><a href="#GlobalWorkspaceBayesian.__init__-723"><span class="linenos">723</span></a>            <span class="n">domain_mods</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian.__init__-724"><a href="#GlobalWorkspaceBayesian.__init__-724"><span class="linenos">724</span></a>            <span class="n">workspace_dim</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian.__init__-725"><a href="#GlobalWorkspaceBayesian.__init__-725"><span class="linenos">725</span></a>            <span class="n">gw_encoders</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian.__init__-726"><a href="#GlobalWorkspaceBayesian.__init__-726"><span class="linenos">726</span></a>            <span class="n">gw_decoders</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian.__init__-727"><a href="#GlobalWorkspaceBayesian.__init__-727"><span class="linenos">727</span></a>            <span class="n">sensitivity_selection</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian.__init__-728"><a href="#GlobalWorkspaceBayesian.__init__-728"><span class="linenos">728</span></a>            <span class="n">sensitivity_precision</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian.__init__-729"><a href="#GlobalWorkspaceBayesian.__init__-729"><span class="linenos">729</span></a>            <span class="n">precision_softmax_temp</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian.__init__-730"><a href="#GlobalWorkspaceBayesian.__init__-730"><span class="linenos">730</span></a>        <span class="p">)</span>
</span><span id="GlobalWorkspaceBayesian.__init__-731"><a href="#GlobalWorkspaceBayesian.__init__-731"><span class="linenos">731</span></a>
</span><span id="GlobalWorkspaceBayesian.__init__-732"><a href="#GlobalWorkspaceBayesian.__init__-732"><span class="linenos">732</span></a>        <span class="n">selection_mod</span> <span class="o">=</span> <span class="n">FixedSharedSelection</span><span class="p">()</span>
</span><span id="GlobalWorkspaceBayesian.__init__-733"><a href="#GlobalWorkspaceBayesian.__init__-733"><span class="linenos">733</span></a>
</span><span id="GlobalWorkspaceBayesian.__init__-734"><a href="#GlobalWorkspaceBayesian.__init__-734"><span class="linenos">734</span></a>        <span class="n">contrastive_loss</span> <span class="o">=</span> <span class="n">ContrastiveLoss</span><span class="p">(</span>
</span><span id="GlobalWorkspaceBayesian.__init__-735"><a href="#GlobalWorkspaceBayesian.__init__-735"><span class="linenos">735</span></a>            <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">log</span><span class="p">(),</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="n">learn_logit_scale</span>
</span><span id="GlobalWorkspaceBayesian.__init__-736"><a href="#GlobalWorkspaceBayesian.__init__-736"><span class="linenos">736</span></a>        <span class="p">)</span>
</span><span id="GlobalWorkspaceBayesian.__init__-737"><a href="#GlobalWorkspaceBayesian.__init__-737"><span class="linenos">737</span></a>
</span><span id="GlobalWorkspaceBayesian.__init__-738"><a href="#GlobalWorkspaceBayesian.__init__-738"><span class="linenos">738</span></a>        <span class="n">loss_mod</span> <span class="o">=</span> <span class="n">GWLossesBayesian</span><span class="p">(</span>
</span><span id="GlobalWorkspaceBayesian.__init__-739"><a href="#GlobalWorkspaceBayesian.__init__-739"><span class="linenos">739</span></a>            <span class="n">gw_mod</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian.__init__-740"><a href="#GlobalWorkspaceBayesian.__init__-740"><span class="linenos">740</span></a>            <span class="n">selection_mod</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian.__init__-741"><a href="#GlobalWorkspaceBayesian.__init__-741"><span class="linenos">741</span></a>            <span class="n">domain_mods</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian.__init__-742"><a href="#GlobalWorkspaceBayesian.__init__-742"><span class="linenos">742</span></a>            <span class="n">loss_coefs</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian.__init__-743"><a href="#GlobalWorkspaceBayesian.__init__-743"><span class="linenos">743</span></a>            <span class="n">contrastive_loss</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian.__init__-744"><a href="#GlobalWorkspaceBayesian.__init__-744"><span class="linenos">744</span></a>            <span class="n">use_normalized_constrastive</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian.__init__-745"><a href="#GlobalWorkspaceBayesian.__init__-745"><span class="linenos">745</span></a>        <span class="p">)</span>
</span><span id="GlobalWorkspaceBayesian.__init__-746"><a href="#GlobalWorkspaceBayesian.__init__-746"><span class="linenos">746</span></a>
</span><span id="GlobalWorkspaceBayesian.__init__-747"><a href="#GlobalWorkspaceBayesian.__init__-747"><span class="linenos">747</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="GlobalWorkspaceBayesian.__init__-748"><a href="#GlobalWorkspaceBayesian.__init__-748"><span class="linenos">748</span></a>            <span class="n">gw_mod</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian.__init__-749"><a href="#GlobalWorkspaceBayesian.__init__-749"><span class="linenos">749</span></a>            <span class="n">selection_mod</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian.__init__-750"><a href="#GlobalWorkspaceBayesian.__init__-750"><span class="linenos">750</span></a>            <span class="n">loss_mod</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian.__init__-751"><a href="#GlobalWorkspaceBayesian.__init__-751"><span class="linenos">751</span></a>            <span class="n">optim_lr</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian.__init__-752"><a href="#GlobalWorkspaceBayesian.__init__-752"><span class="linenos">752</span></a>            <span class="n">optim_weight_decay</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian.__init__-753"><a href="#GlobalWorkspaceBayesian.__init__-753"><span class="linenos">753</span></a>            <span class="n">scheduler_args</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian.__init__-754"><a href="#GlobalWorkspaceBayesian.__init__-754"><span class="linenos">754</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initializes a Global Workspace</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>domain_mods (<code>Mapping[str, DomainModule]</code>):</strong>  mapping of the domains
connected to the GW. Keys are domain names, values are the
<code>DomainModule</code>.</li>
<li><strong>gw_encoders (<code>Mapping[str, torch.nn.Module]</code>):</strong>  mapping for each domain
name to a <code>torch.nn.Module</code> class which role is to encode a
unimodal latent representations into a GW representation (pre fusion).</li>
<li><strong>gw_decoders (<code>Mapping[str, torch.nn.Module]</code>):</strong>  mapping for each domain
name to a <code>torch.nn.Module</code> class which role is to decode a
GW representation into a unimodal latent representations.</li>
<li><strong>workspace_dim (<code>int</code>):</strong>  dimension of the GW.</li>
<li><strong>loss_coefs (<code>LossCoefs</code>):</strong>  loss coefficients</li>
<li><strong>sensitivity_selection (<code><a href="#GlobalWorkspaceBayesian.float">float</a></code>):</strong>  sensivity coef $c'_1$</li>
<li><strong>sensitivity_precision (<code><a href="#GlobalWorkspaceBayesian.float">float</a></code>):</strong>  sensitivity coef $c'_2$</li>
<li><strong>optim_lr (<code><a href="#GlobalWorkspaceBayesian.float">float</a></code>):</strong>  learning rate</li>
<li><strong>optim_weight_decay (<code><a href="#GlobalWorkspaceBayesian.float">float</a></code>):</strong>  weight decay</li>
<li><strong>scheduler_args (<code>SchedulerArgs | None</code>):</strong>  optimization scheduler's arguments</li>
<li><strong>learn_logit_scale (<code>bool</code>):</strong>  whether to learn the contrastive learning
contrastive loss when using the default contrastive loss.</li>
<li><strong>use_normalized_constrastive (<code>bool</code>):</strong>  whether to use the normalized cont
loss by the precision coefs</li>
<li><strong>contrastive_loss (<code>ContrastiveLossType | None</code>):</strong>  a contrastive loss
function used for alignment. <code>learn_logit_scale</code> will not affect custom
contrastive losses.</li>
<li><strong>precision_softmax_temp (<code><a href="#GlobalWorkspaceBayesian.float">float</a></code>):</strong>  temperature to use in softmax of
precision</li>
</ul>
</div>


                            </div>
                            <div id="GlobalWorkspaceBayesian.forward" class="classattr">
                                        <input id="GlobalWorkspaceBayesian.forward-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">forward</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">latent_domains</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n"><a href="#GWPredictions">GWPredictions</a></span>:</span></span>

                <label class="view-source-button" for="GlobalWorkspaceBayesian.forward-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GlobalWorkspaceBayesian.forward"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GlobalWorkspaceBayesian.forward-756"><a href="#GlobalWorkspaceBayesian.forward-756"><span class="linenos">756</span></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="GlobalWorkspaceBayesian.forward-757"><a href="#GlobalWorkspaceBayesian.forward-757"><span class="linenos">757</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian.forward-758"><a href="#GlobalWorkspaceBayesian.forward-758"><span class="linenos">758</span></a>        <span class="n">latent_domains</span><span class="p">:</span> <span class="n">LatentsDomainGroupsT</span><span class="p">,</span>
</span><span id="GlobalWorkspaceBayesian.forward-759"><a href="#GlobalWorkspaceBayesian.forward-759"><span class="linenos">759</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GWPredictions</span><span class="p">:</span>
</span><span id="GlobalWorkspaceBayesian.forward-760"><a href="#GlobalWorkspaceBayesian.forward-760"><span class="linenos">760</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBayesian.forward-761"><a href="#GlobalWorkspaceBayesian.forward-761"><span class="linenos">761</span></a><span class="sd">        Computes demi-cycles, cycles, and translations.</span>
</span><span id="GlobalWorkspaceBayesian.forward-762"><a href="#GlobalWorkspaceBayesian.forward-762"><span class="linenos">762</span></a>
</span><span id="GlobalWorkspaceBayesian.forward-763"><a href="#GlobalWorkspaceBayesian.forward-763"><span class="linenos">763</span></a><span class="sd">        Args:</span>
</span><span id="GlobalWorkspaceBayesian.forward-764"><a href="#GlobalWorkspaceBayesian.forward-764"><span class="linenos">764</span></a><span class="sd">            latent_domains (`LatentsT`): Groups of domains for the computation.</span>
</span><span id="GlobalWorkspaceBayesian.forward-765"><a href="#GlobalWorkspaceBayesian.forward-765"><span class="linenos">765</span></a>
</span><span id="GlobalWorkspaceBayesian.forward-766"><a href="#GlobalWorkspaceBayesian.forward-766"><span class="linenos">766</span></a><span class="sd">        Returns:</span>
</span><span id="GlobalWorkspaceBayesian.forward-767"><a href="#GlobalWorkspaceBayesian.forward-767"><span class="linenos">767</span></a><span class="sd">            `GWPredictions`: the predictions on the batch.</span>
</span><span id="GlobalWorkspaceBayesian.forward-768"><a href="#GlobalWorkspaceBayesian.forward-768"><span class="linenos">768</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GlobalWorkspaceBayesian.forward-769"><a href="#GlobalWorkspaceBayesian.forward-769"><span class="linenos">769</span></a>        <span class="k">return</span> <span class="n">GWPredictions</span><span class="p">(</span>
</span><span id="GlobalWorkspaceBayesian.forward-770"><a href="#GlobalWorkspaceBayesian.forward-770"><span class="linenos">770</span></a>            <span class="n">demi_cycles</span><span class="o">=</span><span class="n">batch_demi_cycles</span><span class="p">(</span>
</span><span id="GlobalWorkspaceBayesian.forward-771"><a href="#GlobalWorkspaceBayesian.forward-771"><span class="linenos">771</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_mod</span><span class="p">,</span> <span class="n">latent_domains</span>
</span><span id="GlobalWorkspaceBayesian.forward-772"><a href="#GlobalWorkspaceBayesian.forward-772"><span class="linenos">772</span></a>            <span class="p">),</span>
</span><span id="GlobalWorkspaceBayesian.forward-773"><a href="#GlobalWorkspaceBayesian.forward-773"><span class="linenos">773</span></a>            <span class="n">cycles</span><span class="o">=</span><span class="n">batch_cycles</span><span class="p">(</span>
</span><span id="GlobalWorkspaceBayesian.forward-774"><a href="#GlobalWorkspaceBayesian.forward-774"><span class="linenos">774</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_mod</span><span class="p">,</span> <span class="n">latent_domains</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain_mods</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="GlobalWorkspaceBayesian.forward-775"><a href="#GlobalWorkspaceBayesian.forward-775"><span class="linenos">775</span></a>            <span class="p">),</span>
</span><span id="GlobalWorkspaceBayesian.forward-776"><a href="#GlobalWorkspaceBayesian.forward-776"><span class="linenos">776</span></a>            <span class="n">translations</span><span class="o">=</span><span class="n">batch_translations</span><span class="p">(</span>
</span><span id="GlobalWorkspaceBayesian.forward-777"><a href="#GlobalWorkspaceBayesian.forward-777"><span class="linenos">777</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">gw_mod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selection_mod</span><span class="p">,</span> <span class="n">latent_domains</span>
</span><span id="GlobalWorkspaceBayesian.forward-778"><a href="#GlobalWorkspaceBayesian.forward-778"><span class="linenos">778</span></a>            <span class="p">),</span>
</span><span id="GlobalWorkspaceBayesian.forward-779"><a href="#GlobalWorkspaceBayesian.forward-779"><span class="linenos">779</span></a>            <span class="o">**</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">latent_domains</span><span class="p">),</span>
</span><span id="GlobalWorkspaceBayesian.forward-780"><a href="#GlobalWorkspaceBayesian.forward-780"><span class="linenos">780</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Computes demi-cycles, cycles, and translations.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>latent_domains (<code>LatentsT</code>):</strong>  Groups of domains for the computation.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p><code><a href="#GWPredictions">GWPredictions</a></code>: the predictions on the batch.</p>
</blockquote>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#GlobalWorkspaceBase">GlobalWorkspaceBase</a></dt>
                                <dd id="GlobalWorkspaceBayesian.gw_mod" class="variable"><a href="#GlobalWorkspaceBase.gw_mod">gw_mod</a></dd>
                <dd id="GlobalWorkspaceBayesian.selection_mod" class="variable"><a href="#GlobalWorkspaceBase.selection_mod">selection_mod</a></dd>
                <dd id="GlobalWorkspaceBayesian.loss_mod" class="variable"><a href="#GlobalWorkspaceBase.loss_mod">loss_mod</a></dd>
                <dd id="GlobalWorkspaceBayesian.optim_lr" class="variable"><a href="#GlobalWorkspaceBase.optim_lr">optim_lr</a></dd>
                <dd id="GlobalWorkspaceBayesian.optim_weight_decay" class="variable"><a href="#GlobalWorkspaceBase.optim_weight_decay">optim_weight_decay</a></dd>
                <dd id="GlobalWorkspaceBayesian.scheduler_args" class="variable"><a href="#GlobalWorkspaceBase.scheduler_args">scheduler_args</a></dd>
                <dd id="GlobalWorkspaceBayesian.domain_mods" class="variable"><a href="#GlobalWorkspaceBase.domain_mods">domain_mods</a></dd>
                <dd id="GlobalWorkspaceBayesian.workspace_dim" class="variable"><a href="#GlobalWorkspaceBase.workspace_dim">workspace_dim</a></dd>
                <dd id="GlobalWorkspaceBayesian.encode_and_fuse" class="function"><a href="#GlobalWorkspaceBase.encode_and_fuse">encode_and_fuse</a></dd>
                <dd id="GlobalWorkspaceBayesian.encode" class="function"><a href="#GlobalWorkspaceBase.encode">encode</a></dd>
                <dd id="GlobalWorkspaceBayesian.fuse" class="function"><a href="#GlobalWorkspaceBase.fuse">fuse</a></dd>
                <dd id="GlobalWorkspaceBayesian.decode" class="function"><a href="#GlobalWorkspaceBase.decode">decode</a></dd>
                <dd id="GlobalWorkspaceBayesian.batch_gw_states" class="function"><a href="#GlobalWorkspaceBase.batch_gw_states">batch_gw_states</a></dd>
                <dd id="GlobalWorkspaceBayesian.encode_domain" class="function"><a href="#GlobalWorkspaceBase.encode_domain">encode_domain</a></dd>
                <dd id="GlobalWorkspaceBayesian.encode_domains" class="function"><a href="#GlobalWorkspaceBase.encode_domains">encode_domains</a></dd>
                <dd id="GlobalWorkspaceBayesian.decode_domain" class="function"><a href="#GlobalWorkspaceBase.decode_domain">decode_domain</a></dd>
                <dd id="GlobalWorkspaceBayesian.decode_domains" class="function"><a href="#GlobalWorkspaceBase.decode_domains">decode_domains</a></dd>
                <dd id="GlobalWorkspaceBayesian.generic_step" class="function"><a href="#GlobalWorkspaceBase.generic_step">generic_step</a></dd>
                <dd id="GlobalWorkspaceBayesian.validation_step" class="function"><a href="#GlobalWorkspaceBase.validation_step">validation_step</a></dd>
                <dd id="GlobalWorkspaceBayesian.test_step" class="function"><a href="#GlobalWorkspaceBase.test_step">test_step</a></dd>
                <dd id="GlobalWorkspaceBayesian.training_step" class="function"><a href="#GlobalWorkspaceBase.training_step">training_step</a></dd>
                <dd id="GlobalWorkspaceBayesian.predict_step" class="function"><a href="#GlobalWorkspaceBase.predict_step">predict_step</a></dd>
                <dd id="GlobalWorkspaceBayesian.configure_optimizers" class="function"><a href="#GlobalWorkspaceBase.configure_optimizers">configure_optimizers</a></dd>

            </div>
            <div><dt>lightning.pytorch.core.module.LightningModule</dt>
                                <dd id="GlobalWorkspaceBayesian.CHECKPOINT_HYPER_PARAMS_KEY" class="variable">CHECKPOINT_HYPER_PARAMS_KEY</dd>
                <dd id="GlobalWorkspaceBayesian.CHECKPOINT_HYPER_PARAMS_NAME" class="variable">CHECKPOINT_HYPER_PARAMS_NAME</dd>
                <dd id="GlobalWorkspaceBayesian.CHECKPOINT_HYPER_PARAMS_TYPE" class="variable">CHECKPOINT_HYPER_PARAMS_TYPE</dd>
                <dd id="GlobalWorkspaceBayesian.optimizers" class="function">optimizers</dd>
                <dd id="GlobalWorkspaceBayesian.lr_schedulers" class="function">lr_schedulers</dd>
                <dd id="GlobalWorkspaceBayesian.trainer" class="variable">trainer</dd>
                <dd id="GlobalWorkspaceBayesian.fabric" class="variable">fabric</dd>
                <dd id="GlobalWorkspaceBayesian.example_input_array" class="variable">example_input_array</dd>
                <dd id="GlobalWorkspaceBayesian.current_epoch" class="variable">current_epoch</dd>
                <dd id="GlobalWorkspaceBayesian.global_step" class="variable">global_step</dd>
                <dd id="GlobalWorkspaceBayesian.global_rank" class="variable">global_rank</dd>
                <dd id="GlobalWorkspaceBayesian.local_rank" class="variable">local_rank</dd>
                <dd id="GlobalWorkspaceBayesian.on_gpu" class="variable">on_gpu</dd>
                <dd id="GlobalWorkspaceBayesian.automatic_optimization" class="variable">automatic_optimization</dd>
                <dd id="GlobalWorkspaceBayesian.strict_loading" class="variable">strict_loading</dd>
                <dd id="GlobalWorkspaceBayesian.logger" class="variable">logger</dd>
                <dd id="GlobalWorkspaceBayesian.loggers" class="variable">loggers</dd>
                <dd id="GlobalWorkspaceBayesian.print" class="function">print</dd>
                <dd id="GlobalWorkspaceBayesian.log" class="function">log</dd>
                <dd id="GlobalWorkspaceBayesian.log_dict" class="function">log_dict</dd>
                <dd id="GlobalWorkspaceBayesian.all_gather" class="function">all_gather</dd>
                <dd id="GlobalWorkspaceBayesian.configure_callbacks" class="function">configure_callbacks</dd>
                <dd id="GlobalWorkspaceBayesian.manual_backward" class="function">manual_backward</dd>
                <dd id="GlobalWorkspaceBayesian.backward" class="function">backward</dd>
                <dd id="GlobalWorkspaceBayesian.toggle_optimizer" class="function">toggle_optimizer</dd>
                <dd id="GlobalWorkspaceBayesian.untoggle_optimizer" class="function">untoggle_optimizer</dd>
                <dd id="GlobalWorkspaceBayesian.clip_gradients" class="function">clip_gradients</dd>
                <dd id="GlobalWorkspaceBayesian.configure_gradient_clipping" class="function">configure_gradient_clipping</dd>
                <dd id="GlobalWorkspaceBayesian.lr_scheduler_step" class="function">lr_scheduler_step</dd>
                <dd id="GlobalWorkspaceBayesian.optimizer_step" class="function">optimizer_step</dd>
                <dd id="GlobalWorkspaceBayesian.optimizer_zero_grad" class="function">optimizer_zero_grad</dd>
                <dd id="GlobalWorkspaceBayesian.freeze" class="function">freeze</dd>
                <dd id="GlobalWorkspaceBayesian.unfreeze" class="function">unfreeze</dd>
                <dd id="GlobalWorkspaceBayesian.to_onnx" class="function">to_onnx</dd>
                <dd id="GlobalWorkspaceBayesian.to_torchscript" class="function">to_torchscript</dd>
                <dd id="GlobalWorkspaceBayesian.load_from_checkpoint" class="function">load_from_checkpoint</dd>

            </div>
            <div><dt>lightning.fabric.utilities.device_dtype_mixin._DeviceDtypeModuleMixin</dt>
                                <dd id="GlobalWorkspaceBayesian.dtype" class="variable">dtype</dd>
                <dd id="GlobalWorkspaceBayesian.device" class="variable">device</dd>
                <dd id="GlobalWorkspaceBayesian.to" class="function">to</dd>
                <dd id="GlobalWorkspaceBayesian.cuda" class="function">cuda</dd>
                <dd id="GlobalWorkspaceBayesian.cpu" class="function">cpu</dd>
                <dd id="GlobalWorkspaceBayesian.type" class="function">type</dd>
                <dd id="GlobalWorkspaceBayesian.float" class="function">float</dd>
                <dd id="GlobalWorkspaceBayesian.double" class="function">double</dd>
                <dd id="GlobalWorkspaceBayesian.half" class="function">half</dd>

            </div>
            <div><dt>lightning.pytorch.core.mixins.hparams_mixin.HyperparametersMixin</dt>
                                <dd id="GlobalWorkspaceBayesian.save_hyperparameters" class="function">save_hyperparameters</dd>
                <dd id="GlobalWorkspaceBayesian.hparams" class="variable">hparams</dd>
                <dd id="GlobalWorkspaceBayesian.hparams_initial" class="variable">hparams_initial</dd>

            </div>
            <div><dt>lightning.pytorch.core.hooks.ModelHooks</dt>
                                <dd id="GlobalWorkspaceBayesian.on_fit_start" class="function">on_fit_start</dd>
                <dd id="GlobalWorkspaceBayesian.on_fit_end" class="function">on_fit_end</dd>
                <dd id="GlobalWorkspaceBayesian.on_train_start" class="function">on_train_start</dd>
                <dd id="GlobalWorkspaceBayesian.on_train_end" class="function">on_train_end</dd>
                <dd id="GlobalWorkspaceBayesian.on_validation_start" class="function">on_validation_start</dd>
                <dd id="GlobalWorkspaceBayesian.on_validation_end" class="function">on_validation_end</dd>
                <dd id="GlobalWorkspaceBayesian.on_test_start" class="function">on_test_start</dd>
                <dd id="GlobalWorkspaceBayesian.on_test_end" class="function">on_test_end</dd>
                <dd id="GlobalWorkspaceBayesian.on_predict_start" class="function">on_predict_start</dd>
                <dd id="GlobalWorkspaceBayesian.on_predict_end" class="function">on_predict_end</dd>
                <dd id="GlobalWorkspaceBayesian.on_train_batch_start" class="function">on_train_batch_start</dd>
                <dd id="GlobalWorkspaceBayesian.on_train_batch_end" class="function">on_train_batch_end</dd>
                <dd id="GlobalWorkspaceBayesian.on_validation_batch_start" class="function">on_validation_batch_start</dd>
                <dd id="GlobalWorkspaceBayesian.on_validation_batch_end" class="function">on_validation_batch_end</dd>
                <dd id="GlobalWorkspaceBayesian.on_test_batch_start" class="function">on_test_batch_start</dd>
                <dd id="GlobalWorkspaceBayesian.on_test_batch_end" class="function">on_test_batch_end</dd>
                <dd id="GlobalWorkspaceBayesian.on_predict_batch_start" class="function">on_predict_batch_start</dd>
                <dd id="GlobalWorkspaceBayesian.on_predict_batch_end" class="function">on_predict_batch_end</dd>
                <dd id="GlobalWorkspaceBayesian.on_validation_model_zero_grad" class="function">on_validation_model_zero_grad</dd>
                <dd id="GlobalWorkspaceBayesian.on_validation_model_eval" class="function">on_validation_model_eval</dd>
                <dd id="GlobalWorkspaceBayesian.on_validation_model_train" class="function">on_validation_model_train</dd>
                <dd id="GlobalWorkspaceBayesian.on_test_model_eval" class="function">on_test_model_eval</dd>
                <dd id="GlobalWorkspaceBayesian.on_test_model_train" class="function">on_test_model_train</dd>
                <dd id="GlobalWorkspaceBayesian.on_predict_model_eval" class="function">on_predict_model_eval</dd>
                <dd id="GlobalWorkspaceBayesian.on_train_epoch_start" class="function">on_train_epoch_start</dd>
                <dd id="GlobalWorkspaceBayesian.on_train_epoch_end" class="function">on_train_epoch_end</dd>
                <dd id="GlobalWorkspaceBayesian.on_validation_epoch_start" class="function">on_validation_epoch_start</dd>
                <dd id="GlobalWorkspaceBayesian.on_validation_epoch_end" class="function">on_validation_epoch_end</dd>
                <dd id="GlobalWorkspaceBayesian.on_test_epoch_start" class="function">on_test_epoch_start</dd>
                <dd id="GlobalWorkspaceBayesian.on_test_epoch_end" class="function">on_test_epoch_end</dd>
                <dd id="GlobalWorkspaceBayesian.on_predict_epoch_start" class="function">on_predict_epoch_start</dd>
                <dd id="GlobalWorkspaceBayesian.on_predict_epoch_end" class="function">on_predict_epoch_end</dd>
                <dd id="GlobalWorkspaceBayesian.on_before_zero_grad" class="function">on_before_zero_grad</dd>
                <dd id="GlobalWorkspaceBayesian.on_before_backward" class="function">on_before_backward</dd>
                <dd id="GlobalWorkspaceBayesian.on_after_backward" class="function">on_after_backward</dd>
                <dd id="GlobalWorkspaceBayesian.on_before_optimizer_step" class="function">on_before_optimizer_step</dd>
                <dd id="GlobalWorkspaceBayesian.configure_sharded_model" class="function">configure_sharded_model</dd>
                <dd id="GlobalWorkspaceBayesian.configure_model" class="function">configure_model</dd>

            </div>
            <div><dt>lightning.pytorch.core.hooks.DataHooks</dt>
                                <dd id="GlobalWorkspaceBayesian.prepare_data_per_node" class="variable">prepare_data_per_node</dd>
                <dd id="GlobalWorkspaceBayesian.allow_zero_length_dataloader_with_multiple_devices" class="variable">allow_zero_length_dataloader_with_multiple_devices</dd>
                <dd id="GlobalWorkspaceBayesian.prepare_data" class="function">prepare_data</dd>
                <dd id="GlobalWorkspaceBayesian.setup" class="function">setup</dd>
                <dd id="GlobalWorkspaceBayesian.teardown" class="function">teardown</dd>
                <dd id="GlobalWorkspaceBayesian.train_dataloader" class="function">train_dataloader</dd>
                <dd id="GlobalWorkspaceBayesian.test_dataloader" class="function">test_dataloader</dd>
                <dd id="GlobalWorkspaceBayesian.val_dataloader" class="function">val_dataloader</dd>
                <dd id="GlobalWorkspaceBayesian.predict_dataloader" class="function">predict_dataloader</dd>
                <dd id="GlobalWorkspaceBayesian.transfer_batch_to_device" class="function">transfer_batch_to_device</dd>
                <dd id="GlobalWorkspaceBayesian.on_before_batch_transfer" class="function">on_before_batch_transfer</dd>
                <dd id="GlobalWorkspaceBayesian.on_after_batch_transfer" class="function">on_after_batch_transfer</dd>

            </div>
            <div><dt>lightning.pytorch.core.hooks.CheckpointHooks</dt>
                                <dd id="GlobalWorkspaceBayesian.on_load_checkpoint" class="function">on_load_checkpoint</dd>
                <dd id="GlobalWorkspaceBayesian.on_save_checkpoint" class="function">on_save_checkpoint</dd>

            </div>
            <div><dt>torch.nn.modules.module.Module</dt>
                                <dd id="GlobalWorkspaceBayesian.dump_patches" class="variable">dump_patches</dd>
                <dd id="GlobalWorkspaceBayesian.training" class="variable">training</dd>
                <dd id="GlobalWorkspaceBayesian.call_super_init" class="variable">call_super_init</dd>
                <dd id="GlobalWorkspaceBayesian.register_buffer" class="function">register_buffer</dd>
                <dd id="GlobalWorkspaceBayesian.register_parameter" class="function">register_parameter</dd>
                <dd id="GlobalWorkspaceBayesian.add_module" class="function">add_module</dd>
                <dd id="GlobalWorkspaceBayesian.register_module" class="function">register_module</dd>
                <dd id="GlobalWorkspaceBayesian.get_submodule" class="function">get_submodule</dd>
                <dd id="GlobalWorkspaceBayesian.get_parameter" class="function">get_parameter</dd>
                <dd id="GlobalWorkspaceBayesian.get_buffer" class="function">get_buffer</dd>
                <dd id="GlobalWorkspaceBayesian.get_extra_state" class="function">get_extra_state</dd>
                <dd id="GlobalWorkspaceBayesian.set_extra_state" class="function">set_extra_state</dd>
                <dd id="GlobalWorkspaceBayesian.apply" class="function">apply</dd>
                <dd id="GlobalWorkspaceBayesian.ipu" class="function">ipu</dd>
                <dd id="GlobalWorkspaceBayesian.xpu" class="function">xpu</dd>
                <dd id="GlobalWorkspaceBayesian.bfloat16" class="function">bfloat16</dd>
                <dd id="GlobalWorkspaceBayesian.to_empty" class="function">to_empty</dd>
                <dd id="GlobalWorkspaceBayesian.register_full_backward_pre_hook" class="function">register_full_backward_pre_hook</dd>
                <dd id="GlobalWorkspaceBayesian.register_backward_hook" class="function">register_backward_hook</dd>
                <dd id="GlobalWorkspaceBayesian.register_full_backward_hook" class="function">register_full_backward_hook</dd>
                <dd id="GlobalWorkspaceBayesian.register_forward_pre_hook" class="function">register_forward_pre_hook</dd>
                <dd id="GlobalWorkspaceBayesian.register_forward_hook" class="function">register_forward_hook</dd>
                <dd id="GlobalWorkspaceBayesian.register_state_dict_pre_hook" class="function">register_state_dict_pre_hook</dd>
                <dd id="GlobalWorkspaceBayesian.state_dict" class="function">state_dict</dd>
                <dd id="GlobalWorkspaceBayesian.register_load_state_dict_post_hook" class="function">register_load_state_dict_post_hook</dd>
                <dd id="GlobalWorkspaceBayesian.load_state_dict" class="function">load_state_dict</dd>
                <dd id="GlobalWorkspaceBayesian.parameters" class="function">parameters</dd>
                <dd id="GlobalWorkspaceBayesian.named_parameters" class="function">named_parameters</dd>
                <dd id="GlobalWorkspaceBayesian.buffers" class="function">buffers</dd>
                <dd id="GlobalWorkspaceBayesian.named_buffers" class="function">named_buffers</dd>
                <dd id="GlobalWorkspaceBayesian.children" class="function">children</dd>
                <dd id="GlobalWorkspaceBayesian.named_children" class="function">named_children</dd>
                <dd id="GlobalWorkspaceBayesian.modules" class="function">modules</dd>
                <dd id="GlobalWorkspaceBayesian.named_modules" class="function">named_modules</dd>
                <dd id="GlobalWorkspaceBayesian.train" class="function">train</dd>
                <dd id="GlobalWorkspaceBayesian.eval" class="function">eval</dd>
                <dd id="GlobalWorkspaceBayesian.requires_grad_" class="function">requires_grad_</dd>
                <dd id="GlobalWorkspaceBayesian.zero_grad" class="function">zero_grad</dd>
                <dd id="GlobalWorkspaceBayesian.share_memory" class="function">share_memory</dd>
                <dd id="GlobalWorkspaceBayesian.extra_repr" class="function">extra_repr</dd>
                <dd id="GlobalWorkspaceBayesian.compile" class="function">compile</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="pretrained_global_workspace">
                            <input id="pretrained_global_workspace-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pretrained_global_workspace</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">checkpoint_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>,</span><span class="param">	<span class="n">domain_mods</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><a href="domain.html#DomainModule">shimmer.modules.domain.DomainModule</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">gw_encoders</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span>,</span><span class="param">	<span class="n">gw_decoders</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span>,</span><span class="param">	<span class="n">workspace_dim</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">loss_coefs</span><span class="p">:</span> <span class="n"><a href="losses.html#LossCoefs">shimmer.modules.losses.LossCoefs</a></span>,</span><span class="param">	<span class="n">contrastive_fn</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">],</span> <span class="n"><a href="domain.html#LossOutput">shimmer.modules.domain.LossOutput</a></span><span class="p">]</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">) -> <span class="n"><a href="#GlobalWorkspace2Domains">GlobalWorkspace2Domains</a></span>:</span></span>

                <label class="view-source-button" for="pretrained_global_workspace-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#pretrained_global_workspace"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="pretrained_global_workspace-783"><a href="#pretrained_global_workspace-783"><span class="linenos">783</span></a><span class="k">def</span> <span class="nf">pretrained_global_workspace</span><span class="p">(</span>
</span><span id="pretrained_global_workspace-784"><a href="#pretrained_global_workspace-784"><span class="linenos">784</span></a>    <span class="n">checkpoint_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
</span><span id="pretrained_global_workspace-785"><a href="#pretrained_global_workspace-785"><span class="linenos">785</span></a>    <span class="n">domain_mods</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DomainModule</span><span class="p">],</span>
</span><span id="pretrained_global_workspace-786"><a href="#pretrained_global_workspace-786"><span class="linenos">786</span></a>    <span class="n">gw_encoders</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Module</span><span class="p">],</span>
</span><span id="pretrained_global_workspace-787"><a href="#pretrained_global_workspace-787"><span class="linenos">787</span></a>    <span class="n">gw_decoders</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Module</span><span class="p">],</span>
</span><span id="pretrained_global_workspace-788"><a href="#pretrained_global_workspace-788"><span class="linenos">788</span></a>    <span class="n">workspace_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="pretrained_global_workspace-789"><a href="#pretrained_global_workspace-789"><span class="linenos">789</span></a>    <span class="n">loss_coefs</span><span class="p">:</span> <span class="n">LossCoefs</span><span class="p">,</span>
</span><span id="pretrained_global_workspace-790"><a href="#pretrained_global_workspace-790"><span class="linenos">790</span></a>    <span class="n">contrastive_fn</span><span class="p">:</span> <span class="n">ContrastiveLossType</span><span class="p">,</span>
</span><span id="pretrained_global_workspace-791"><a href="#pretrained_global_workspace-791"><span class="linenos">791</span></a>    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="pretrained_global_workspace-792"><a href="#pretrained_global_workspace-792"><span class="linenos">792</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GlobalWorkspace2Domains</span><span class="p">:</span>
</span><span id="pretrained_global_workspace-793"><a href="#pretrained_global_workspace-793"><span class="linenos">793</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="pretrained_global_workspace-794"><a href="#pretrained_global_workspace-794"><span class="linenos">794</span></a><span class="sd">    Load a `GlobalWorkspace` flavor of `GlobalWorkspaceBase` from a checkpoint.</span>
</span><span id="pretrained_global_workspace-795"><a href="#pretrained_global_workspace-795"><span class="linenos">795</span></a>
</span><span id="pretrained_global_workspace-796"><a href="#pretrained_global_workspace-796"><span class="linenos">796</span></a><span class="sd">    Args:</span>
</span><span id="pretrained_global_workspace-797"><a href="#pretrained_global_workspace-797"><span class="linenos">797</span></a><span class="sd">        checkpoint_path (`str | Path`): path to checkpoint</span>
</span><span id="pretrained_global_workspace-798"><a href="#pretrained_global_workspace-798"><span class="linenos">798</span></a><span class="sd">        domain_mods (`Mapping[str, DomainModule]`): mapping of the domains</span>
</span><span id="pretrained_global_workspace-799"><a href="#pretrained_global_workspace-799"><span class="linenos">799</span></a><span class="sd">            connected to the GW. Keys are domain names, values are the</span>
</span><span id="pretrained_global_workspace-800"><a href="#pretrained_global_workspace-800"><span class="linenos">800</span></a><span class="sd">            `DomainModule`.</span>
</span><span id="pretrained_global_workspace-801"><a href="#pretrained_global_workspace-801"><span class="linenos">801</span></a><span class="sd">        gw_encoders (`Mapping[str, torch.nn.Module]`): mapping for each domain</span>
</span><span id="pretrained_global_workspace-802"><a href="#pretrained_global_workspace-802"><span class="linenos">802</span></a><span class="sd">            name to a `torch.nn.Module` class which role is to encode a</span>
</span><span id="pretrained_global_workspace-803"><a href="#pretrained_global_workspace-803"><span class="linenos">803</span></a><span class="sd">            unimodal latent representations into a GW representation (pre fusion).</span>
</span><span id="pretrained_global_workspace-804"><a href="#pretrained_global_workspace-804"><span class="linenos">804</span></a><span class="sd">        gw_decoders (`Mapping[str, torch.nn.Module]`): mapping for each domain</span>
</span><span id="pretrained_global_workspace-805"><a href="#pretrained_global_workspace-805"><span class="linenos">805</span></a><span class="sd">            name to a `torch.nn.Module` class which role is to decode a</span>
</span><span id="pretrained_global_workspace-806"><a href="#pretrained_global_workspace-806"><span class="linenos">806</span></a><span class="sd">            GW representation into a unimodal latent representations.</span>
</span><span id="pretrained_global_workspace-807"><a href="#pretrained_global_workspace-807"><span class="linenos">807</span></a><span class="sd">        workspace_dim (`int`): dimension of the GW.</span>
</span><span id="pretrained_global_workspace-808"><a href="#pretrained_global_workspace-808"><span class="linenos">808</span></a><span class="sd">        loss_coefs (`LossCoefs`): loss coefficients</span>
</span><span id="pretrained_global_workspace-809"><a href="#pretrained_global_workspace-809"><span class="linenos">809</span></a><span class="sd">        contrastive_loss (`ContrastiveLossType`): a contrastive loss</span>
</span><span id="pretrained_global_workspace-810"><a href="#pretrained_global_workspace-810"><span class="linenos">810</span></a><span class="sd">            function used for alignment. `learn_logit_scale` will not affect custom</span>
</span><span id="pretrained_global_workspace-811"><a href="#pretrained_global_workspace-811"><span class="linenos">811</span></a><span class="sd">            contrastive losses.</span>
</span><span id="pretrained_global_workspace-812"><a href="#pretrained_global_workspace-812"><span class="linenos">812</span></a><span class="sd">        **kwargs: additional arguments to pass to</span>
</span><span id="pretrained_global_workspace-813"><a href="#pretrained_global_workspace-813"><span class="linenos">813</span></a><span class="sd">            `GlobalWorkspace.load_from_checkpoint`.</span>
</span><span id="pretrained_global_workspace-814"><a href="#pretrained_global_workspace-814"><span class="linenos">814</span></a>
</span><span id="pretrained_global_workspace-815"><a href="#pretrained_global_workspace-815"><span class="linenos">815</span></a><span class="sd">    Returns:</span>
</span><span id="pretrained_global_workspace-816"><a href="#pretrained_global_workspace-816"><span class="linenos">816</span></a><span class="sd">        `GlobalWorkspace`: the pretrained `GlobalWorkspace`.</span>
</span><span id="pretrained_global_workspace-817"><a href="#pretrained_global_workspace-817"><span class="linenos">817</span></a>
</span><span id="pretrained_global_workspace-818"><a href="#pretrained_global_workspace-818"><span class="linenos">818</span></a><span class="sd">    Raises:</span>
</span><span id="pretrained_global_workspace-819"><a href="#pretrained_global_workspace-819"><span class="linenos">819</span></a><span class="sd">        `TypeError`: if loaded type is not `GlobalWorkspace`.</span>
</span><span id="pretrained_global_workspace-820"><a href="#pretrained_global_workspace-820"><span class="linenos">820</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="pretrained_global_workspace-821"><a href="#pretrained_global_workspace-821"><span class="linenos">821</span></a>    <span class="n">domain_mods</span> <span class="o">=</span> <span class="n">freeze_domain_modules</span><span class="p">(</span><span class="n">domain_mods</span><span class="p">)</span>
</span><span id="pretrained_global_workspace-822"><a href="#pretrained_global_workspace-822"><span class="linenos">822</span></a>    <span class="n">gw_mod</span> <span class="o">=</span> <span class="n">GWModule</span><span class="p">(</span><span class="n">domain_mods</span><span class="p">,</span> <span class="n">workspace_dim</span><span class="p">,</span> <span class="n">gw_encoders</span><span class="p">,</span> <span class="n">gw_decoders</span><span class="p">)</span>
</span><span id="pretrained_global_workspace-823"><a href="#pretrained_global_workspace-823"><span class="linenos">823</span></a>    <span class="n">selection_mod</span> <span class="o">=</span> <span class="n">SingleDomainSelection</span><span class="p">()</span>
</span><span id="pretrained_global_workspace-824"><a href="#pretrained_global_workspace-824"><span class="linenos">824</span></a>    <span class="n">loss_mod</span> <span class="o">=</span> <span class="n">GWLosses2Domains</span><span class="p">(</span>
</span><span id="pretrained_global_workspace-825"><a href="#pretrained_global_workspace-825"><span class="linenos">825</span></a>        <span class="n">gw_mod</span><span class="p">,</span> <span class="n">selection_mod</span><span class="p">,</span> <span class="n">domain_mods</span><span class="p">,</span> <span class="n">loss_coefs</span><span class="p">,</span> <span class="n">contrastive_fn</span>
</span><span id="pretrained_global_workspace-826"><a href="#pretrained_global_workspace-826"><span class="linenos">826</span></a>    <span class="p">)</span>
</span><span id="pretrained_global_workspace-827"><a href="#pretrained_global_workspace-827"><span class="linenos">827</span></a>
</span><span id="pretrained_global_workspace-828"><a href="#pretrained_global_workspace-828"><span class="linenos">828</span></a>    <span class="n">gw</span> <span class="o">=</span> <span class="n">GlobalWorkspace2Domains</span><span class="o">.</span><span class="n">load_from_checkpoint</span><span class="p">(</span>
</span><span id="pretrained_global_workspace-829"><a href="#pretrained_global_workspace-829"><span class="linenos">829</span></a>        <span class="n">checkpoint_path</span><span class="p">,</span>
</span><span id="pretrained_global_workspace-830"><a href="#pretrained_global_workspace-830"><span class="linenos">830</span></a>        <span class="n">gw_mod</span><span class="o">=</span><span class="n">gw_mod</span><span class="p">,</span>
</span><span id="pretrained_global_workspace-831"><a href="#pretrained_global_workspace-831"><span class="linenos">831</span></a>        <span class="n">selection_mid</span><span class="o">=</span><span class="n">selection_mod</span><span class="p">,</span>
</span><span id="pretrained_global_workspace-832"><a href="#pretrained_global_workspace-832"><span class="linenos">832</span></a>        <span class="n">loss_coefs</span><span class="o">=</span><span class="n">loss_coefs</span><span class="p">,</span>
</span><span id="pretrained_global_workspace-833"><a href="#pretrained_global_workspace-833"><span class="linenos">833</span></a>        <span class="n">loss_mod</span><span class="o">=</span><span class="n">loss_mod</span><span class="p">,</span>
</span><span id="pretrained_global_workspace-834"><a href="#pretrained_global_workspace-834"><span class="linenos">834</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
</span><span id="pretrained_global_workspace-835"><a href="#pretrained_global_workspace-835"><span class="linenos">835</span></a>    <span class="p">)</span>
</span><span id="pretrained_global_workspace-836"><a href="#pretrained_global_workspace-836"><span class="linenos">836</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gw</span><span class="p">,</span> <span class="n">GlobalWorkspace2Domains</span><span class="p">):</span>
</span><span id="pretrained_global_workspace-837"><a href="#pretrained_global_workspace-837"><span class="linenos">837</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;model should be of type GlobalWorkspace&quot;</span><span class="p">)</span>
</span><span id="pretrained_global_workspace-838"><a href="#pretrained_global_workspace-838"><span class="linenos">838</span></a>    <span class="k">return</span> <span class="n">gw</span>
</span></pre></div>


            <div class="docstring"><p>Load a <code><a href="#GlobalWorkspace">GlobalWorkspace</a></code> flavor of <code><a href="#GlobalWorkspaceBase">GlobalWorkspaceBase</a></code> from a checkpoint.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>checkpoint_path (<code>str | Path</code>):</strong>  path to checkpoint</li>
<li><strong>domain_mods (<code>Mapping[str, DomainModule]</code>):</strong>  mapping of the domains
connected to the GW. Keys are domain names, values are the
<code>DomainModule</code>.</li>
<li><strong>gw_encoders (<code>Mapping[str, torch.nn.Module]</code>):</strong>  mapping for each domain
name to a <code>torch.nn.Module</code> class which role is to encode a
unimodal latent representations into a GW representation (pre fusion).</li>
<li><strong>gw_decoders (<code>Mapping[str, torch.nn.Module]</code>):</strong>  mapping for each domain
name to a <code>torch.nn.Module</code> class which role is to decode a
GW representation into a unimodal latent representations.</li>
<li><strong>workspace_dim (<code>int</code>):</strong>  dimension of the GW.</li>
<li><strong>loss_coefs (<code>LossCoefs</code>):</strong>  loss coefficients</li>
<li><strong>contrastive_loss (<code>ContrastiveLossType</code>):</strong>  a contrastive loss
function used for alignment. <code>learn_logit_scale</code> will not affect custom
contrastive losses.</li>
<li><strong>**kwargs:</strong>  additional arguments to pass to
<code><a href="#GlobalWorkspace.load_from_checkpoint">GlobalWorkspace.load_from_checkpoint</a></code>.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p><code><a href="#GlobalWorkspace">GlobalWorkspace</a></code>: the pretrained <code><a href="#GlobalWorkspace">GlobalWorkspace</a></code>.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong><code>TypeError</code>:</strong>  if loaded type is not <code><a href="#GlobalWorkspace">GlobalWorkspace</a></code>.</li>
</ul>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>